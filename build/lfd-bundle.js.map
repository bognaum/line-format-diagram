{"version":3,"file":"lfd-bundle.js","mappings":";;;;;;AAAA,YAAY,8BAA2B;AACvC;AACA;;;;;;;;;;;;;;;;ACFqC;AACoB;AACX;AACA;AACQ;AACtD;AACA;AACA;AACe;AACf;AACA;AACA,EAAE,yDAAQ;AACV;AACA;AACA,gCAAgC;AAChC,gCAAgC;AAChC,gCAAgC;AAChC,gCAAgC;AAChC;AACA,wBAAwB;AACxB,wBAAwB;AACxB;AACA;AACA;AACA;AACA,QAAQ,+BAA+B,EAAE,iDAAgB;AACzD;AACA,MAAM,6DAAa;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,gEAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,cAAc,0CAAS;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,+BAA+B,EAAE,iDAAgB;AACzD;AACA;AACA;AACA,EAAE,yDAAY;AACd;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,YAAY,gEAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;ACjHkC;AAClC;AASE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,YAAY;AAC9C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,kDAAI;AACxB;AACA;AACA;AACA,IAAI;AACJ;AACA,EAAE;AACF;AACA;AACA,aAAa,kDAAI,EAAE,OAAO;AAC1B;AACA,aAAa,kDAAI,EAAE,OAAO;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC/Fe;AACf;AACA;AACA;AACA;AACA,uBAAuB;AACvB,uBAAuB;AACvB,uBAAuB;AACvB,uBAAuB;AACvB,uBAAuB;AACvB,uBAAuB;AACvB;AACA,uBAAuB;AACvB,uBAAuB;AACvB;AACA,uBAAuB;AACvB,uBAAuB;AACvB,uBAAuB;AACvB,kBAAkB;AAClB,kBAAkB;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AC9T4C;AAC0B;AACtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,EAAE,4FAAsB;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA,mBAAmB;AACnB;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,2CAA2C;AAC3D;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACe,2BAA2B,4FAAsB;AAChE;AACA;AACA,EAAE,4DAAQ;AACV;AACA;AACA,kBAAkB;AAClB;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACvHe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C;AAC3C;AACA,2BAA2B,OAAO;AAClC;AACA;AACA,qCAAqC,eAAe;AACpD;AACA;AACA;AACA;AACA,uCAAuC,eAAe;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;AClI2C;AACA;AAC3C;AACA,iEAAe;AACf;AACA,YAAY;AACZ,YAAY;AACZ,CAAC;;;;;;;;;;;ACPD,iEAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,EAAC;AACF;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA,EAAE;AACF;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAiD,UAAU;AAC3D;AACA,MAAM;AACN;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH,iDAAiD,OAAO,KAAK,UAAU;AACvE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2DAA2D,MAAM;AACjE,oDAAoD,MAAM,eAAe,MAAM;AAC/E,GAAG;AACH;AACA;;;;;;;;;;;;;ACjS6C;AACQ;AACrD;AACe;AACf;AACA;AACA;AACA;AACA,EAAE,iEAAM;AACR;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC;AAClC,kCAAkC;AAClC,kCAAkC;AAClC,kCAAkC;AAClC,kCAAkC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,qDAAY;AAC/B;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,iEAAiE,GAAG;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,gBAAgB;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,QAAQ,IAAI,OAAO;AACjC;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,4BAA4B,kBAAkB,GAAG,kBAAkB;AACnE;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oBAAoB,YAAY;AAChC,qBAAqB,YAAY,mCAAmC,IAAI;AACxE,qBAAqB,YAAY;AACjC,qBAAqB,YAAY;AACjC;AACA;AACA;AACA,kBAAkB,6BAA6B;AAC/C,kBAAkB,6BAA6B;AAC/C,kBAAkB,6BAA6B;AAC/C,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ,uBAAuB;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACjP0C;AAC1C;AACe;AACf;AACA;AACA,YAAY,eAAe;AAC3B,YAAY,gBAAgB;AAC5B,YAAY,iBAAiB;AAC7B,aAAa,kBAAkB;AAC/B,UAAU,mBAAmB,cAAc;AAC3C,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU,cAAc;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU,cAAc;AACxB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,8BAA8B;AAClC,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,uBAAuB;AAC3B;AACA,YAAY,kDAAS;AACrB,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AC3He;AACf;AACA;AACA,UAAU,YAAY;AACtB,UAAU,UAAU;AACpB,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;;;;;;;;;;ACtBe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2CAA2C;AAC3C;AACA,2BAA2B,OAAO;AAClC;AACA;AACA,qCAAqC,eAAe;AACpD;AACA;AACA;AACA;AACA,uCAAuC,eAAe;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACpFe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,2CAA2C;AAC3C;AACA,2BAA2B,OAAO;AAClC;AACA;AACA,qCAAqC,eAAe;AACpD;AACA;AACA;AACA;AACA,uCAAuC,eAAe;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;ACvJgC;AACoB;;AAErC;AACf;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF,mDAAmD,eAAe;;AAElE,QAAQ,kBAAkB;AAC1B;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,SAAS;;AAET;AACA;;AAEA;;AAEA;AACA;;AAEA,IAAI;;AAEJ;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;;AAEJ;;AAEA;AACA,8CAA8C;AAC9C;;AAEA;AACA;AACA;AACA,KAAK;;AAEL,yBAAyB,OAAO,QAAQ,cAAc,EAAE,WAAW;AACnE,cAAc,aAAa;AAC3B,sBAAsB,WAAW;AACjC,2BAA2B,YAAY;AACvC;AACA;AACA;AACA;AACA;AACA,UAAU,OAAO;AACjB,UAAU,OAAO;AACjB,UAAU,OAAO;AACjB,UAAU,WAAW;AACrB;AACA;AACA,gCAAgC,IAAI;AACpC,gCAAgC,aAAa;AAC7C;AACA;;AAEA;AACA,iBAAiB,OAAO,UAAU,WAAW;AAC7C;AACA,iCAAiC,cAAc;AAC/C,iCAAiC,aAAa;AAC9C;;AAEA;AACA,iBAAiB,OAAO,YAAY,WAAW;AAC/C,oCAAoC,aAAa;AACjD;AACA,WAAW,cAAc;AACzB;;AAEA;AACA,iBAAiB,OAAO,UAAU,WAAW;AAC7C;AACA,iCAAiC,cAAc;AAC/C,iCAAiC,aAAa;AAC9C;;AAEA;AACA;AACA;AACA;AACA,cAAc,OAAO;AACrB,iCAAiC,IAAI;AACrC;;AAEA;AACA;;AAEA,6BAA6B,oBAAoB;AACjD;AACA,4BAA4B,OAAO,wBAAwB,IAAI;AAC/D;;AAEA;AACA;AACA,iBAAiB,OAAO,aAAa,WAAW;AAChD;AACA,kCAAkC,aAAa;AAC/C,kCAAkC,WAAW;AAC7C,kCAAkC,aAAa;AAC/C,kCAAkC,WAAW;AAC7C;AACA,UAAU,QAAQ;AAClB;;AAEA,MAAM;AACN;AACA,MAAM;AACN;AACA;;AAEA;;AAEA;AACA;AACA,oBAAoB,OAAO,iBAAiB,WAAW;AACvD,oCAAoC,aAAa;;AAEjD,qBAAqB,OAAO,cAAc,WAAW;AACrD;AACA,iCAAiC,aAAa;AAC9C,iCAAiC,eAAe;AAChD;;AAEA,sBAAsB,OAAO,YAAY,WAAW;AACpD;AACA,kCAAkC,aAAa;AAC/C,kCAAkC,eAAe;AACjD;AACA;;AAEA;AACA;AACA,qBAAqB,OAAO;AAC5B,4CAA4C,WAAW;AACvD;AACA,KAAK;;AAEL;AACA;AACA;AACA,aAAa,OAAO;AACpB,aAAa,OAAO;AACpB,aAAa,OAAO;AACpB,aAAa,WAAW;AACxB;AACA;AACA,0CAA0C,eAAe,IAAI;AAC7D,mCAAmC,aAAa;AAChD,mCAAmC,eAAe;AAClD;AACA;AACA,YAAY,iBAAiB;AAC7B;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,oBAAoB,MAAM,OAAO;AACjC;AACA;AACA;AACA;AACA;AACA,kCAAkC,QAAQ;AAC1C,wBAAwB,OAAO;AAC/B,wCAAwC,iBAAiB;AACzD;AACA;AACA;;AAEA;AACA,mBAAmB,gBAAgB,IAAI,gBAAgB;AACvD;;;;;;;;;;;;;;;AC5P4C;AACS;AACW;AAChB;AAChD;AACe;AACf,mCAAmC;AACnC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,2BAA2B,uDAAU;AACrC;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,oBAAoB;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,yDAAY;AACb;AACA,6CAA6C,YAAY;AACzD;AACA,EAAE;AACF,6CAA6C,YAAY;AACzD;AACA,EAAE;AACF,4CAA4C,YAAY;AACxD;AACA,EAAE,EAAE;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,YAAY;AACzD;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,QAAQ,SAAS;AACjB;AACA;AACA;AACA;AACA,sEAAsE,OAAO;AAC7E;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wBAAwB,iBAAiB;AACzC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAU,4CAAW;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,mBAAmB,4CAAW;AAC9B,gBAAgB,GAAG,wCAAwC;AAC3D,iBAAiB,GAAG,yBAAyB,GAAG,qCAAqC;AACrF,qBAAqB,GAAG,kBAAkB;AAC1C,qBAAqB,GAAG,kBAAkB;AAC1C,UAAU;AACV;AACA,iBAAiB,GAAG,yBAAyB,GAAG,mCAAmC;AACnF,qBAAqB,GAAG;AACxB,qBAAqB,GAAG;AACxB;AACA,qBAAqB,GAAG;AACxB,qBAAqB,GAAG;AACxB;AACA,qBAAqB,GAAG;AACxB,qBAAqB,GAAG;AACxB;AACA,qBAAqB,GAAG;AACxB,qBAAqB,GAAG;AACxB;AACA,2BAA2B;AAC3B;AACA;AACA,4CAA4C,oBAAoB;AAChE,oBAAoB,OAAO,SAAS,OAAO;AAC3C,wBAAwB,GAAG;AAC3B;AACA,4CAA4C,oBAAoB;AAChE,oBAAoB,OAAO,SAAS,OAAO;AAC3C,wBAAwB,GAAG;AAC3B;AACA;AACA;AACA,oBAAoB,GAAG;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,GAAG;AACnB;AACA,gBAAgB,GAAG;AACnB,iBAAiB,GAAG;AACpB,4BAA4B;AAC5B,2BAA2B,GAAG;AAC9B,YAAY;AACZ,sBAAsB,GAAG;AACzB,2BAA2B,GAAG;AAC9B;AACA,6BAA6B;AAC7B,sBAAsB,GAAG;AACzB;AACA,4BAA4B;AAC5B;AACA,kCAAkC;AAClC,kBAAkB,GAAG;AACrB;AACA;AACA;AACA;AACA;AACA;AACA,mCAAmC,GAAG;AACtC;AACA,WAAW,oBAAoB;AAC/B;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA,mCAAmC,GAAG;AACtC;AACA,WAAW,oBAAoB;AAC/B;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA,mCAAmC,GAAG;AACtC;AACA;AACA,MAAM,SAAS;AACf;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,MAAM,SAAS;AACf;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA,mCAAmC,GAAG;AACtC;AACA;AACA,MAAM,SAAS;AACf;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,MAAM,SAAS;AACf;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA,mCAAmC,GAAG;AACtC;AACA;AACA,MAAM,SAAS;AACf;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,MAAM,SAAS;AACf;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA,mCAAmC,GAAG;AACtC;AACA;AACA,MAAM,SAAS;AACf;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,MAAM,SAAS;AACf;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA,mCAAmC,GAAG;AACtC;AACA;AACA,MAAM,SAAS;AACf;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,MAAM,SAAS;AACf;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA,mCAAmC,GAAG;AACtC;AACA;AACA,MAAM,SAAS;AACf;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,MAAM,SAAS;AACf;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA,mCAAmC,GAAG;AACtC;AACA;AACA,MAAM,SAAS;AACf;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,MAAM,SAAS;AACf;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA,mCAAmC,GAAG;AACtC;AACA;AACA,MAAM,SAAS;AACf;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA,MAAM,SAAS;AACf;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA,mCAAmC,GAAG;AACtC;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA,mCAAmC,GAAG;AACtC;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA,mCAAmC,GAAG;AACtC;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA,mCAAmC,GAAG;AACtC,GAAG;AACH;AACA;AACA;AACA,mCAAmC,GAAG;AACtC;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ,2BAA2B;AAC3B,GAAG;AACH;AACA,mCAAmC,GAAG;AACtC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ,2BAA2B;AAC3B,GAAG;AACH;AACA,mCAAmC,GAAG;AACtC;AACA;AACA,IAAI;AACJ;AACA;AACA,YAAY,qBAAqB;AACjC,MAAM,iDAAgB;AACtB;AACA;AACA;AACA;AACA,OAAO;AACP;AACA,gBAAgB,gEAAO;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;AChgBe;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBAAsB;AACtB;AACA,WAAW;AACX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCAAkC,OAAO;AACzC;;;;;UC/EA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;UENA;UACA;UACA;UACA","sources":["webpack://LineFormatDiagram/./wp-enter-point.js","webpack://LineFormatDiagram/./lfd.js","webpack://LineFormatDiagram/./lib.js","webpack://LineFormatDiagram/./NodeClass.js","webpack://LineFormatDiagram/./json-err-hl/json-err-hl.js","webpack://LineFormatDiagram/./json-err-hl/CSS/themes.scss.js","webpack://LineFormatDiagram/./json-err-hl/syntax-highlight-framework/syntax-hl-fk.js","webpack://LineFormatDiagram/./json-err-hl/syntax-highlight-framework/describeAPI.js","webpack://LineFormatDiagram/./json-err-hl/syntax-highlight-framework/Highlighter.js","webpack://LineFormatDiagram/./json-err-hl/syntax-highlight-framework/ParseContext.js","webpack://LineFormatDiagram/./json-err-hl/syntax-highlight-framework/ModelNode.js","webpack://LineFormatDiagram/./json-err-hl/syntax-highlight-framework/CSS/highlighter.scss.js","webpack://LineFormatDiagram/./CSS/lfd.scss.js","webpack://LineFormatDiagram/./buildDiagram.js","webpack://LineFormatDiagram/./Editor/DiagramEditor.js","webpack://LineFormatDiagram/./Editor/getSelArgs.js","webpack://LineFormatDiagram/webpack/bootstrap","webpack://LineFormatDiagram/webpack/runtime/define property getters","webpack://LineFormatDiagram/webpack/runtime/hasOwnProperty shorthand","webpack://LineFormatDiagram/webpack/runtime/make namespace object","webpack://LineFormatDiagram/webpack/before-startup","webpack://LineFormatDiagram/webpack/startup","webpack://LineFormatDiagram/webpack/after-startup"],"sourcesContent":["const LFD = require(\"./lfd.js\").default;\r\n\r\nmodule.exports = LFD;","import * as lib      from \"./lib.js\";\r\nimport JsonEHl       from \"./json-err-hl/json-err-hl.js\";\r\nimport setStyle      from \"./CSS/lfd.scss.js\";\r\nimport buildDiagram  from \"./buildDiagram.js\";\r\nimport DiagramEditor from \"./Editor/DiagramEditor.js\";\r\n\r\nconst version = \"7.0.2-alpha\";\r\n\r\nexport default class LineFormatDiagram {\r\n\tconstructor (clPref=\"line-format-diagram\") {\r\n\t\tthis.clPref = clPref;\r\n\t\tsetStyle(clPref);\r\n\t}\r\n\r\n\tbuild              (...args) { return build             (this, ...args); }\r\n\tbuildByTextContent (...args) { return buildByTextContent(this, ...args); }\r\n\tgetBuilded         (...args) { return getBuilded        (this, ...args); }\r\n\tedit               (...args) { return edit              (this, ...args); }\r\n\r\n\tget        version () {return version;}\r\n\tstatic get version () {return version;}\r\n}\r\n\r\nfunction edit(self, elem) {\r\n\tconst template = elem.textContent;\r\n\tconst {object :tOb, error :jsonError} = lib.tryParseJSON(template);\r\n\tif (tOb)\r\n\t\tnew DiagramEditor(self.clPref, elem, tOb);\r\n\t\t// return editDiagram(self, elem, tOb);\r\n\telse if (jsonError) {\r\n\t\telem.classList.remove(\"executing\", \"executed\", \"exec-error\");\r\n\t\telem.classList.add(\"exec-error\");\r\n\t\tconst \r\n\t\t\tfirstLN = parseInt(elem.dataset.lineNum) || 1,\r\n\t\t\tjson = template,\r\n\t\t\thl = new JsonEHl(\"e-s-json-err-hl\"),\r\n\t\t\tcodeField = hl.getHighlighted(template, firstLN);\r\n\t\telem.innerHTML = \"\";\r\n\t\telem.appendChild(codeField);\r\n\t\thl.scrollToFirstError(codeField);\r\n\t\tconsole.error(`(!) \\n`, elem, \"\\n\", jsonError);\r\n\t\treturn;\r\n\t} else {\r\n\t\tthrow new Error();\r\n\t}\r\n}\r\n\r\nfunction getBuilded(self, templ) {\r\n\tconst elem = lib.eHTML(`<pre class=\"\"><pre>`);\r\n\treturn build(self, elem, templ);\r\n}\r\n\r\nfunction buildByTextContent(self, elem) {\r\n\treturn build(self, elem, elem.textContent);\r\n}\r\n\r\nfunction build (self, elem, template) {\r\n\tif (! (elem instanceof HTMLElement))\r\n\t\tthrow new Error([\r\n\t\t\t\"(!) build(). Argument #1 must be a HTMLElement.\",\r\n\t\t\t\"\",\r\n\t\t\telem + \" given.\",\r\n\t\t\t\"\"\r\n\t\t].join(\"\\n\"));\r\n\r\n\tif ([\"executing\", \"executed\", \"exec-error\"].some((v) => elem.classList.contains(v)))\r\n\t\tthrow new Error([\r\n\t\t\t\"(!) Line format diagram. Already handled.\", \r\n\t\t\t\"\",\r\n\t\t\telem\r\n\t\t].join(\"\\n\"));\r\n\r\n\telem.dataset.fileTreeDiagramVersion = version;\r\n\t// elem.classList.add(self.clPref);\r\n\telem.classList.add(\"executing\");\r\n\r\n\tif (typeof template != \"string\")\r\n\t\tthrow new Error([\r\n\t\t\t\"(!) build(). Argument #2 must be a string.\",\r\n\t\t\t\"\",\r\n\t\t\ttemplate + \" given.\",\r\n\t\t\t\"\"\r\n\t\t].join(\"\\n\"));\r\n\r\n\r\n\t\r\n\r\n\tconst {object :tOb, error :jsonError} = lib.tryParseJSON(template);\r\n\r\n\tif (tOb) {\r\n\r\n\t\tbuildDiagram(self, elem, tOb);\r\n\t\telem.dataset.eSchemeVersion = self.version;\r\n\r\n\t\telem.classList.remove(\"executing\", \"executed\", \"exec-error\");\r\n\t\telem.classList.add(\"executed\");\r\n\t} else if (jsonError) {\r\n\t\telem.classList.remove(\"executing\", \"executed\", \"exec-error\");\r\n\t\telem.classList.add(\"exec-error\");\r\n\t\tconst \r\n\t\t\tfirstLN = parseInt(elem.dataset.lineNum) || 1,\r\n\t\t\tjson = template,\r\n\t\t\thl = new JsonEHl(\"e-s-json-err-hl\"),\r\n\t\t\tcodeField = hl.getHighlighted(template, firstLN);\r\n\t\telem.innerHTML = \"\";\r\n\t\telem.appendChild(codeField);\r\n\t\thl.scrollToFirstError(codeField);\r\n\t\tconsole.error(`(!) \\n`, elem, \"\\n\", jsonError);\r\n\t\treturn;\r\n\t} else {\r\n\t\tthrow new Error();\r\n\t}\r\n\treturn tOb;\r\n}\r\n","import Node from \"./NodeClass.js\";\r\n\r\nexport {\r\n\tforEachRecur,\r\n\ttryParseJSON,\r\n\tfromJson,\r\n\teHTML,\r\n\teHTMLDF,\r\n\tgetPart,\r\n\tisPart,\r\n};\r\n\r\nfunction getPart(self, el) {\r\n\treturn recur(el);\r\n\tfunction recur(el) {\r\n\t\tif (isPart(self, el)) \r\n\t\t\treturn el;\r\n\t\tif (el.parentElement)\r\n\t\t\treturn recur(el.parentElement);\r\n\t}\r\n}\r\n\r\nfunction isPart(self, el) {\r\n\treturn el.classList?.contains(`${self.clPref}-part`);\r\n}\r\n\r\nfunction setStatusMark(el, className) {\r\n\tconst classes = [\"executing\", \"executed\", \"exec-error\"];\r\n\tif (classes.includes(className)) {\r\n\t\tel.classList.remove(...classes);\r\n\t\tel.classList.add(className);\r\n\t} else {\r\n\t\tthrow new Error(\"Invalid className of diagram status: \"+slassName);\r\n\t}\r\n}\r\n\r\n\r\nfunction forEachRecur(preCb, ob, postCb) {\r\n\tif (ob instanceof Array) \r\n\t\tfor (let v of ob)\r\n\t\t\t\tforEachRecur(preCb, v, postCb);\r\n\telse if (typeof ob == \"object\") {\r\n\t\tif (preCb)\r\n\t\t\tpreCb(ob);\r\n\t\tforEachRecur(preCb, ob.ch, postCb);\r\n\t\tif (postCb)\r\n\t\t\tpostCb(ob);\r\n\t}\r\n}\r\n\r\nfunction tryParseJSON (json) {\r\n\ttry {\r\n\t\tconst object = fromJson(json)\r\n\t\treturn {object};\r\n\t} catch (err) {\r\n\t\treturn {\r\n\t\t\ttext: json,\r\n\t\t\terror: err,\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction fromJson(json) {\r\n\tconst ob =  JSON.parse(json, function(k, v) {\r\n\t\tif (typeof (k * 1) == \"number\" && typeof v == \"object\" && \"ch\" in v) {\r\n\t\t\tconst node = new Node(v);\r\n\t\t\tif (node.ch instanceof Array)\r\n\t\t\t\tnode.ch.forEach(v => v.parent = node);\r\n\t\t\treturn node;\r\n\t\t} else\r\n\t\t\treturn v;\r\n\t});\r\n\r\n\tif (typeof ob == \"string\")\r\n\t\treturn new Node({ch: ob});\r\n\telse if (ob instanceof Array)\r\n\t\treturn new Node({ch: ob});\r\n\telse \r\n\t\treturn ob;\r\n}\r\n\r\n\r\nfunction eHTML(code, shell=null) {\r\n\tconst _shell = \r\n\t\t! shell                  ? document.createElement(\"div\") :\r\n\t\ttypeof shell == \"string\" ? document.createElement(shell) :\r\n\t\ttypeof shell == \"object\" ? shell :\r\n\t\t\tnull;\r\n\t_shell.innerHTML = code;\r\n\treturn _shell.children[0];\r\n}\r\n\r\nfunction eHTMLDF(code) {\r\n\tconst _shell = document.createElement(\"template\");\r\n\treturn _shell.innerHTML = code, _shell.content;\r\n}","export default class Node {\r\n\tconstructor (ob) {\r\n\t\tObject.assign(this, ob);\r\n\t}\r\n\t\r\n\tsplit        (a, b) { return split       (this, a, b);}\r\n\tjoin         (a, b) { return join        (this, a, b);}\r\n\twrap         (a, b) { return wrap        (this, a, b);}\r\n\tsubdivide    (a, b) { return subdivide   (this, a, b);}\r\n\twrapSubdiv   (a, b) { return wrapSubdiv  (this, a, b);}\r\n\tunwrap       (    ) { return unwrap      (this      );}\r\n\r\n\tisStr        (    ) { return isStr       (this      );}\r\n\tisArr        (    ) { return isArr       (this      );}\r\n\r\n\ttoJSON       (    ) { return toJSON      (this      );}\r\n\tgetSerial    (    ) { return getSerial   (this      );}\r\n\tgetBySerial  (sN  ) { return getBySerial (this, sN  );}\r\n\tget chIndex () { return getChIndex(this); }\r\n\tget clone   () { return getClone  (this); }\r\n}\r\n\r\nfunction unwrap (self) {\r\n\tif (self.parent) {\r\n\t\tif (isArr(self.ch)) {\r\n\t\t\treturn () => {\r\n\t\t\t\tself.parent.ch.splice(self.chIndex, 1, ...self.ch);\r\n\t\t\t\tinitChildren(self.parent);\r\n\t\t\t}\r\n\t\t} else if (isStr(self.ch) && self.parent && self.parent.ch.length == 1) {\r\n\t\t\treturn () => {\r\n\t\t\t\tself.parent.ch = self.ch;\r\n\t\t\t\tinitChildren(self.parent);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction join (self, a, b) {\r\n\tif (isArr(self.ch)) {\r\n\t\tconst joined = self.ch.slice(a, b);\r\n\t\tif (isArr(...joined.map(v => v.ch))) {\r\n\t\t\treturn () => {\r\n\t\t\t\tconst \r\n\t\t\t\t\tstartPoint = joined[0].chIndex,\r\n\t\t\t\t\tpasted = new Node({\r\n\t\t\t\t\t\ttd: \"J\",\r\n\t\t\t\t\t\tparent: self,\r\n\t\t\t\t\t\tch: [],\r\n\t\t\t\t\t});\r\n\t\t\t\tfor (let v of joined)\r\n\t\t\t\t\tpasted.ch.push(...v.ch);\r\n\t\t\t\tfor (let v of pasted.ch) \r\n\t\t\t\t\tv.parent = pasted;\r\n\t\t\t\tself.ch.splice(startPoint, joined.length, pasted);\r\n\t\t\t}\r\n\t\t} else if (isStr(...joined.map(v => v.ch))) {\r\n\t\t\treturn () => {\r\n\t\t\t\tconst \r\n\t\t\t\t\tstartPoint = joined[0].chIndex,\r\n\t\t\t\t\tpastedStr = joined.reduce((a,v) => a += v.ch, \"\"),\r\n\t\t\t\t\tpastedNode = new Node({\r\n\t\t\t\t\t\ttd: \"J\",\r\n\t\t\t\t\t\tch: pastedStr,\r\n\t\t\t\t\t\tparent: self,\r\n\t\t\t\t\t});\r\n\t\t\t\tself.ch.splice(startPoint, joined.length, pastedNode);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t/*const \r\n\t\tn = self.chIndex + 1,\r\n\t\tright = self.parent.ch[n];\r\n\tif (right)\r\n\t\tif (isArr(self, right) || isStr(self, right)) {\r\n\t\t\tself.ch = self.ch.concat(right.ch);\r\n\t\t\tself.parent.ch.splice(n, 1);\r\n\t\t}*/\r\n\r\n}\r\n\r\n\r\nfunction split (self, a, b) {\r\n\tif (self.parent) \r\n\t\treturn () => {\r\n\t\t\tconst \r\n\t\t\t\tparts = [\r\n\t\t\t\t\tself.ch.slice(0, a),\r\n\t\t\t\t\tself.ch.slice(a, b),\r\n\t\t\t\t\tself.ch.slice(b   ),\r\n\t\t\t\t],\r\n\t\t\t\ttds = [self.td || \"X\", \"S\", self.td || \"X\"],\r\n\t\t\t\tnewChildren = [];\r\n\r\n\t\t\tfor (let p of parts) {\r\n\t\t\t\tconst td = tds.shift();\r\n\t\t\t\tif (p.length) \r\n\t\t\t\t\tnewChildren.push(new self.constructor ({\r\n\t\t\t\t\t\t\ttd,\r\n\t\t\t\t\t\t\tch: p,\r\n\t\t\t\t\t\t\tparent: self.parent,\r\n\t\t\t\t\t\t}));\r\n\t\t\t}\r\n\t\t\t\t\r\n\r\n\t\t\tself.parent.ch.splice(self.chIndex, 1, ...newChildren);\r\n\t\t}\r\n}\r\n\r\nfunction subdivide(self, a, b) {\r\n\tconst \r\n\t\tparts = [\r\n\t\t\tself.ch.slice(0, a),\r\n\t\t\tself.ch.slice(a, b),\r\n\t\t\tself.ch.slice(b   ),\r\n\t\t],\r\n\t\ttds = [\"sd\",\"sd\",\"sd\"],\r\n\t\tnewChildren = [];\r\n\r\n\treturn () => {\r\n\t\tfor (let part of parts) {\r\n\t\t\tconst td = tds.shift();\r\n\t\t\tif (part.length)\r\n\t\t\t\tnewChildren.push(new self.constructor ({\r\n\t\t\t\t\t\ttd,\r\n\t\t\t\t\t\tch: part,\r\n\t\t\t\t\t\tparent: self,\r\n\t\t\t\t\t}));\r\n\t\t}\r\n\r\n\t\tself.ch = newChildren;\r\n\t}\r\n\t\t\r\n}\r\n\r\nfunction wrap(self, a, b) {\r\n\tconst \r\n\t\tparts = [\r\n\t\t\tself.ch.slice(0, a),\r\n\t\t\tself.ch.slice(a, b),\r\n\t\t\tself.ch.slice(b   ),\r\n\t\t],\r\n\t\ttds = [\"X\",\"W\",\"X\"],\r\n\t\tnewChildren = [];\r\n\r\n\tif (isStr(self.ch)) {\r\n\t\treturn () => {\r\n\t\t\tself.ch = [\r\n\t\t\t\tnew self.constructor({\r\n\t\t\t\t\ttd: \"in\",\r\n\t\t\t\t\tch: self.ch,\r\n\t\t\t\t\tparent: self,\r\n\t\t\t\t})\r\n\t\t\t];\r\n\t\t\tinitChildren(self);\r\n\t\t}\r\n\t} else if (isArr(self.ch)) {\r\n\t\treturn () => {\r\n\t\t\tconst wrNode = new Node({\r\n\t\t\t\ttd: \"Wr\",\r\n\t\t\t\tch: parts[1],\r\n\t\t\t\tparent: self,\r\n\t\t\t});\r\n\t\t\tinitChildren(wrNode);\r\n\t\t\tnewChildren.push(...parts[0], wrNode, ...parts[2]);\r\n\t\t\tself.ch = newChildren;\r\n\t\t}\r\n\t} else {\r\n\t\tthrow new Error();\r\n\t}\r\n}\r\n\r\n\r\nfunction wrapSubdiv(self, a, b) {\r\n\tconst \r\n\t\tparts = [\r\n\t\t\tself.ch.slice(0, a),\r\n\t\t\tself.ch.slice(a, b),\r\n\t\t\tself.ch.slice(b   ),\r\n\t\t],\r\n\t\ttds = [\"X\",\"W\",\"X\"],\r\n\t\tnewChildren = [];\r\n\r\n\tif (isStr(self.ch)) {\r\n\t\treturn () => {\r\n\t\t\tfor (let str of parts) {\r\n\t\t\t\tconst td = tds.shift();\r\n\t\t\t\tif (str.length)\r\n\t\t\t\t\tnewChildren.push(new self.constructor ({\r\n\t\t\t\t\t\t\ttd,\r\n\t\t\t\t\t\t\tch: str,\r\n\t\t\t\t\t\t\tparent: self,\r\n\t\t\t\t\t\t}));\r\n\t\t\t}\r\n\r\n\t\t\tself.ch = newChildren;\r\n\t\t}\r\n\t} else if (isArr(self.ch)) {\r\n\t\treturn () => {\r\n\t\t\tconst wrNode = new Node({\r\n\t\t\t\ttd: \"Wr\",\r\n\t\t\t\tch: parts[1],\r\n\t\t\t\tparent: self,\r\n\t\t\t});\r\n\t\t\tinitChildren(wrNode);\r\n\t\t\tnewChildren.push(...parts[0], wrNode, ...parts[2]);\r\n\t\t\tself.ch = newChildren;\r\n\t\t}\r\n\t} else {\r\n\t\tthrow new Error();\r\n\t}\r\n}\r\n\r\nfunction getChIndex (self) {\r\n\tif (self.parent) \r\n\t\tfor (let [k,v] of self.parent.ch.entries()) \r\n\t\t\tif (v == self)\r\n\t\t\t\treturn k;\r\n\r\n\treturn null;\r\n}\r\n\r\nfunction getRoot(self) {\r\n\treturn self.parent ? getRoot(self.parent) : self;\r\n}\r\n\r\nfunction isStr(...args) {\r\n\tfor (let a of args) \r\n\t\tif (! (typeof a == \"string\"))\r\n\t\t\treturn false;\r\n\treturn true;\r\n}\r\n\r\nfunction isArr(...args) {\r\n\tfor (let a of args) \r\n\t\tif (! (a instanceof Array))\r\n\t\t\treturn false;\r\n\treturn true;\r\n}\r\n\r\nfunction toJSON(self) {\r\n\tconst ob = Object.assign({}, self);\r\n\tdelete ob.parent;\r\n\tdelete ob.serialN;\r\n\tdelete ob.topDescr;\r\n\tdelete ob.bottomDescr;\r\n\r\n\treturn ob;\r\n}\r\n\r\nfunction getClone(self) {\r\n\tconst  clone = new Node(self);\r\n\tdelete clone.parent;\r\n\tdelete clone.serialN;\r\n\tdelete clone.topDescr;\r\n\tdelete clone.bottomDescr;\r\n\r\n\tif(typeof self.ch == \"object\") {\r\n\t\tclone.ch = self.ch.map(getClone);\r\n\t\tclone.ch.forEach(v => v.parent = clone);\r\n\t}\r\n\r\n\treturn clone;\r\n}\r\n\r\nfunction checkToParent(self) {\r\n\tconst root = getRoot(self);\r\n\tforEachRecur((node) => {\r\n\t\tif (node.ch)\r\n\t\t\tfor (let v of node.ch) {\r\n\t\t\t\tif (! v.parent)\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\tif (v.parent != node)\r\n\t\t\t\t\tdebugger;\r\n\t\t\t}\r\n\t});\r\n}\r\n\r\nfunction getBySerial(self, serialN) {\r\n\tconst root = getRoot(self);\r\n\tlet node, sN = 0;\r\n\tforEachRecur((v) => {\r\n\t\tif (serialN == sN) \r\n\t\t\tnode = v;\r\n\r\n\t\tsN ++;\r\n\t}, root);\r\n\treturn node;\r\n}\r\n\r\nfunction getSerial(self) {\r\n\tconst root = getRoot(self);\r\n\tlet serialN, sN = 0;\r\n\tforEachRecur((v) => {\r\n\t\tif (v == self)\r\n\t\t\tserialN = sN;\r\n\t\telse\r\n\t\t\tsN ++;\r\n\t}, root);\r\n\treturn serialN;\r\n}\r\n\r\nfunction forEachRecur(preCb, ob, postCb) {\r\n\tif (ob instanceof Array) \r\n\t\tfor (let v of ob)\r\n\t\t\t\tforEachRecur(preCb, v, postCb);\r\n\telse if (typeof ob == \"object\") {\r\n\t\tif (preCb)\r\n\t\t\tpreCb(ob);\r\n\t\tforEachRecur(preCb, ob.ch, postCb);\r\n\t\tif (postCb)\r\n\t\t\tpostCb(ob);\r\n\t}\r\n}\r\n\r\nfunction initChildren(self) {\r\n\tif (isArr(self))\r\n\t\tself.ch.forEach(v => v.parent = self);\r\n}","import setStyle from \"./CSS/themes.scss.js\";\r\nimport SyntaxHlFk from \"./syntax-highlight-framework/syntax-hl-fk.js\";\r\n\r\nconst version = \"1.1.5\";\r\n\r\nconst {\r\n\ttoken,\r\n\tnToken,\r\n\tspToken,\r\n\trule,\r\n\tdomain,\r\n\tseq,\r\n\talter,\r\n\tq,\r\n\tnot,\r\n\tspWrap,\r\n\terror,\r\n\tdeb,\r\n} = SyntaxHlFk.describeAPI;\r\n\r\nconst\r\n\t__main_ = rule(function(pc) {\r\n\t\treturn seq(\r\n\t\t\tspWrap(r.subject.catch(\"Main. Expected subject.\")),\r\n\t\t\terror(\"Main. Unexpected symbol after end of code.\").q(\"*\")\r\n\t\t)(pc);\r\n\t}),\r\n\tlist = rule(function(pc) {\r\n\t\treturn token(\"[\").in(\"list__open\")\r\n\t\t\t.break(\r\n\t\t\t\tseq(\r\n\t\t\t\t\tspWrap(r.subject.q(\"*/\", spWrap(token(\",\").in(\"list__coma\")))),\r\n\t\t\t\t\ttoken(\"]\").in(\"list__close\")\r\n\t\t\t\t\t\t.catch(\"List. Expected closing bracket ' ] '.\"),\r\n\t\t\t\t)\r\n\t\t\t).msg(\"List.\")(pc);\r\n\t\t\t\r\n\t}),\r\n\tdict = rule(function(pc) {\r\n\t\treturn spToken(\"{\")\r\n\t\t\t.break(\r\n\t\t\t\talter(\r\n\t\t\t\t\tspToken(\"}\"),\r\n\t\t\t\t\tseq(\r\n\t\t\t\t\t\tseq(\r\n\t\t\t\t\t\t\td.string_n.catch(\"Dict. Expected string name of field.\"),\r\n\t\t\t\t\t\t\tspToken(\":\").catch(\"Dict. Expected colon ' : '.\"),\r\n\t\t\t\t\t\t\tr.subject.catch(\"Dict. Expected subject - (null | boll | number | string | list | dict).\")\r\n\t\t\t\t\t\t).q(\"*/\", spToken(\",\")),\r\n\t\t\t\t\t\tspToken(\"}\").catch(\"Dict. Expected closing curly ' } ' or coma ' , '.\"),\r\n\t\t\t\t\t),\r\n\t\t\t\t)\r\n\t\t\t).msg(\"Dict.\")(pc);\r\n\t}),\r\n\td = {\r\n\t\tstring_v : domain(\"string_v\" , function(pc) {\r\n\t\t\treturn r.string(pc);\r\n\t\t}),\r\n\t\tstring_n : domain(\"string_n\" , function(pc) {\r\n\t\t\treturn r.string(pc);\r\n\t\t}),\r\n\t\tslashed : domain(\"slashed\", function(pc) {\r\n\t\t\treturn token(\r\n\t\t\t\t'\\\\\"'         ,\r\n\t\t\t\t\"\\\\\\\\\"        , \r\n\t\t\t\t\"\\\\/\"         , \r\n\t\t\t\t\"\\\\b\"         ,\r\n\t\t\t\t\"\\\\f\"         ,\r\n\t\t\t\t\"\\\\n\"         ,\r\n\t\t\t\t\"\\\\r\"         ,\r\n\t\t\t\t\"\\\\t\"         ,\r\n\t\t\t\t/\\\\u\\d\\d\\d\\d/y,\r\n\t\t\t)(pc);\r\n\t\t}),\r\n\t\tnumber          : domain(\"number\", function(pc) {\r\n\t\t\treturn token(/\\b\\d+\\.|\\.\\d+\\b|\\b\\d+\\.?\\d*\\b/y)(pc);\r\n\t\t}),\r\n\t\tbool            : domain(\"bool\", function(pc) {\r\n\t\t\treturn token(/\\btrue\\b|\\bfalse\\b/y)(pc);\r\n\t\t}),\r\n\t\t_null           : domain(\"_null\", function(pc) {\r\n\t\t\treturn token(/\\bnull\\b/y)(pc);\r\n\t\t}),\r\n\t},\r\n\tr = {\r\n\t\tsubject         : rule(function(pc) {\r\n\t\t\treturn alter(\r\n\t\t\t\td._null,\r\n\t\t\t\td.bool,\r\n\t\t\t\td.number,\r\n\t\t\t\td.string_v,\r\n\t\t\t\tlist,\r\n\t\t\t\tdict\r\n\t\t\t)(pc);\r\n\t\t}),\r\n\t\tstring        : rule(function(pc) {\r\n\t\t\treturn seq(\r\n\t\t\t\ttoken('\"'),\r\n\t\t\t\tq(alter(d.slashed, nToken('\"', \"\\n\", \"\\\\\")), \"*\"),\r\n\t\t\t\ttoken('\"').catch(\"String: invalid symbol\"),\r\n\t\t\t)(pc);\r\n\t\t}),\r\n\t\tspace           : rule(function(pc) {\r\n\t\t\treturn token(/\\s+/y)(pc);\r\n\t\t}),\r\n\t};\r\n\r\nexport default class JsonErrHlter extends SyntaxHlFk.Highlighter {\r\n\tconstructor (clPref=\"json-err-hl\") {\r\n\t\tsuper(__main_, clPref);\r\n\t\tsetStyle(clPref);\r\n\t}\r\n\r\n\tget version () { return version; }\r\n\r\n\tgetHighlighted (\r\n\t\ttempl, firstLineNum=1, cssClasses=\"calm-clarified-theme\") {\r\n\t\treturn super.getHighlighted(templ, firstLineNum, cssClasses);\r\n\t}\r\n}\r\n","export default function setStyle(clPref) {\r\n\r\n\tconst cssCode = `.json-err-hl.calm-theme {\r\n  background-color: #222;\r\n}\r\n.json-err-hl.calm-theme .json-err-hl__line-text {\r\n  color: #eee;\r\n}\r\n.json-err-hl.calm-theme .json-err-hl__line-text .string {\r\n  color: #ddc;\r\n}\r\n.json-err-hl.calm-theme .json-err-hl__line-text .string_v {\r\n  color: #ddc;\r\n}\r\n.json-err-hl.calm-theme .json-err-hl__line-text .string_n {\r\n  color: #78a;\r\n}\r\n.json-err-hl.calm-theme .json-err-hl__line-text .slashed {\r\n  color: #f90;\r\n}\r\n.json-err-hl.calm-theme .json-err-hl__line-text .number {\r\n  color: #f90;\r\n}\r\n.json-err-hl.calm-theme .json-err-hl__line-text .bool {\r\n  color: #f90;\r\n}\r\n.json-err-hl.calm-theme .json-err-hl__line-text ._null {\r\n  color: #98f;\r\n}\r\n\r\n.json-err-hl.calm-clarified-theme .json-err-hl__line .json-err-hl__line-number {\r\n  background-color: #444;\r\n}\r\n.json-err-hl.calm-clarified-theme .json-err-hl__line-text {\r\n  color: #eee;\r\n}\r\n.json-err-hl.calm-clarified-theme .json-err-hl__line-text .string {\r\n  color: #ddc;\r\n}\r\n.json-err-hl.calm-clarified-theme .json-err-hl__line-text .string_v {\r\n  color: #ddc;\r\n}\r\n.json-err-hl.calm-clarified-theme .json-err-hl__line-text .string_n {\r\n  color: #78a;\r\n}\r\n.json-err-hl.calm-clarified-theme .json-err-hl__line-text .bool {\r\n  color: #fb6;\r\n}\r\n.json-err-hl.calm-clarified-theme .json-err-hl__line-text .number {\r\n  color: #fb6;\r\n}\r\n.json-err-hl.calm-clarified-theme .json-err-hl__line-text .slashed {\r\n  color: #fb6;\r\n}\r\n.json-err-hl.calm-clarified-theme .json-err-hl__line-text ._null {\r\n  color: #98f;\r\n}\r\n\r\n.json-err-hl.monokai-theme {\r\n  background-color: #333;\r\n}\r\n.json-err-hl.monokai-theme .json-err-hl__line-text .string_n {\r\n  color: #3bd;\r\n}\r\n.json-err-hl.monokai-theme .json-err-hl__line-text .string {\r\n  color: #da5;\r\n}\r\n.json-err-hl.monokai-theme .json-err-hl__line-text .string_v {\r\n  color: #da5;\r\n}\r\n.json-err-hl.monokai-theme .json-err-hl__line-text .slashed {\r\n  color: #98f;\r\n}\r\n.json-err-hl.monokai-theme .json-err-hl__line-text .number {\r\n  color: #98f;\r\n}\r\n.json-err-hl.monokai-theme .json-err-hl__line-text .bool {\r\n  color: #98f;\r\n}\r\n.json-err-hl.monokai-theme .json-err-hl__line-text ._null {\r\n  color: #e48;\r\n}\r\n\r\n.json-err-hl.monokai-clarified-theme .json-err-hl__line-text .string_n {\r\n  color: #3bd;\r\n}\r\n.json-err-hl.monokai-clarified-theme .json-err-hl__line-text .string {\r\n  color: #da5;\r\n}\r\n.json-err-hl.monokai-clarified-theme .json-err-hl__line-text .string_v {\r\n  color: #da5;\r\n}\r\n.json-err-hl.monokai-clarified-theme .json-err-hl__line-text .slashed {\r\n  color: #98f;\r\n}\r\n.json-err-hl.monokai-clarified-theme .json-err-hl__line-text .number {\r\n  color: #98f;\r\n}\r\n.json-err-hl.monokai-clarified-theme .json-err-hl__line-text .bool {\r\n  color: #98f;\r\n}\r\n.json-err-hl.monokai-clarified-theme .json-err-hl__line-text ._null {\r\n  color: #e48;\r\n}\r\n\r\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJmaWxlOi8vL0Q6L0dpdEh1Yi1teS9qc29uLWVyci1obC9jc3MvdGhlbWVzLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBRUE7RUFDQzs7QUFDQTtFQUNDOztBQUNBO0VBQWM7O0FBQ2Q7RUFBYzs7QUFDZDtFQUFjOztBQUNkO0VBQWM7O0FBQ2Q7RUFBYzs7QUFDZDtFQUFjOztBQUNkO0VBQWM7OztBQU1mO0VBQ0M7O0FBR0Q7RUFDQzs7QUFDQTtFQUFnQjs7QUFDaEI7RUFBZ0I7O0FBQ2hCO0VBQWdCOztBQUNoQjtFQUFnQjs7QUFDaEI7RUFBZ0I7O0FBQ2hCO0VBQWdCOztBQUNoQjtFQUFnQjs7O0FBSWxCO0VBQ0M7O0FBR0M7RUFBYzs7QUFDZDtFQUFjOztBQUNkO0VBQWM7O0FBQ2Q7RUFBYzs7QUFDZDtFQUFjOztBQUNkO0VBQWM7O0FBQ2Q7RUFBYzs7O0FBUWQ7RUFBYzs7QUFDZDtFQUFjOztBQUNkO0VBQWM7O0FBQ2Q7RUFBYzs7QUFDZDtFQUFjOztBQUNkO0VBQWM7O0FBQ2Q7RUFBYyIsImZpbGUiOiJ0aGVtZXMuc2Nzcy5qcyJ9 */`.replaceAll(/\\bjson-err-hl/g, clPref);\r\n\r\n\tconst styleClassName = `${clPref}__theme-style`;\r\n\r\n\tconst styleAlreadyExists = [].some.call(\r\n\t\tdocument.querySelectorAll(`style.${styleClassName}`), \r\n\t\t(v) => v.textContent === cssCode\r\n\t);\r\n\r\n\tif (! styleAlreadyExists) {\r\n\t\tconst style = eHTML(`<style class=\"${styleClassName}\"></style>`);\r\n\t\tstyle.textContent = cssCode;\r\n\t\tdocument.head.appendChild(style);\r\n\t}\r\n}\r\n\r\n\r\nfunction eHTML(code, shell=null) {\r\n\tconst _shell = \r\n\t\t! shell                  ? document.createElement(\"div\") :\r\n\t\ttypeof shell == \"string\" ? document.createElement(shell) :\r\n\t\ttypeof shell == \"object\" ? shell :\r\n\t\t\tnull;\r\n\t_shell.innerHTML = code;\r\n\treturn _shell.children[0];\r\n}","import describeAPI from \"./describeAPI.js\";\r\nimport Highlighter from \"./Highlighter.js\";\r\n\r\nexport default {\r\n\tversion: \"5.3.1\",\r\n\tdescribeAPI,\r\n\tHighlighter,\r\n};","export  default {\r\n\ttoken,\r\n\tnToken,\r\n\tspToken,\r\n\trule,\r\n\tdomain,\r\n\tseq,\r\n\talter,\r\n\tq,\r\n\tnot,\r\n\tspWrap,\r\n\terror,\r\n\tdeb,\r\n};\r\n\r\nconst Analyzer_proto = {\r\n\tq : function (quanto, sepCallb=undefined) {\r\n\t\tif (quanto == \"*/\" || quanto == \"+/\")\r\n\t\t\tchekToAnalyzer(\"analyzer.q\", 2, sepCallb);\r\n\t\treturn q(this, quanto, sepCallb);\r\n\t},\r\n\tin : function (name) {\r\n\t\treturn domain(name, this);\r\n\t},\r\n\tand : function (callb) {\r\n\t\tchekToAnalyzer(\"analyzer.and\", 1, callb);\r\n\t\treturn seq(this, callb);\r\n\t},\r\n\tor : function (callb) {\r\n\t\tchekToAnalyzer(\"analyzer.or\", 1, callb);\r\n\t\treturn alter(this, callb);\r\n\t},\r\n\tbreak : function (...args) {\r\n\t\tfor (let [k, callb] of args.entries())\r\n\t\t\tchekToAnalyzer(\"analyzer.break\", k + 1, callb);\r\n\t\tlet message = \"\";\r\n\t\tconst _break_ = (pc) => {\r\n\t\t\tif(this(pc)) {\r\n\t\t\t\tseq(...args).or(undefinedError(message))(pc);\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tObject.setPrototypeOf(_break_, Analyzer_proto);\r\n\t\t_break_.msg = function(msg) {\r\n\t\t\tmessage = msg;\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\treturn _break_;\r\n\t},\r\n\tcatch : function (msg) {\r\n\t\tconst _catch_ = (pc) => {\r\n\t\t\treturn alter(\r\n\t\t\t\tthis,\r\n\t\t\t\terror(msg)\r\n\t\t\t)(pc);\r\n\t\t}\r\n\t\tObject.setPrototypeOf(_catch_, Analyzer_proto);\r\n\t\treturn _catch_;\r\n\t},\r\n\tdeb : function (i0=0, i1=0) {\r\n\t\treturn deb(this, i0, i1);\r\n\t},\r\n};\r\n\r\nObject.setPrototypeOf(Analyzer_proto, Function);\r\n\r\nfunction seq(...callbs) {\r\n\tfor (let [k, callb] of callbs.entries())\r\n\t\tchekToAnalyzer(\"seq\", k + 1, callb);\r\n\tfunction _seq_(pc) {\r\n\t\tconst hpc = pc.createHypo();\r\n\t\tfor (let [k, callb] of callbs.entries()) {\r\n\t\t\tconst res = callb(hpc);\r\n\t\t\tif (res || pc.errC.eFlag) \r\n\t\t\t\tcontinue;\r\n\t\t\telse \r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t\tpc.acceptHypo(hpc);\r\n\t\treturn true;\r\n\t}\r\n\tObject.setPrototypeOf(_seq_, Analyzer_proto);\r\n\treturn _seq_;\r\n}\r\n\r\nfunction alter(...callbs) {\r\n\tfor (let [k, callb] of callbs.entries())\r\n\t\tchekToAnalyzer(\"alter\", k + 1, callb);\r\n\tfunction _alter_(pc) {\r\n\t\tlet res;\r\n\t\tfor (let [k, callb] of callbs.entries()) {\r\n\t\t\tconst res = callb(pc);\r\n\t\t\tif (res)\r\n\t\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tObject.setPrototypeOf(_alter_, Analyzer_proto);\r\n\treturn _alter_;\r\n}\r\n\r\nfunction q(callb, quanto, callb2=undefined) {\r\n\tchekToAnalyzer(\"q\", 1, callb);\r\n\tlet _q_;\r\n\tif (quanto == \"*\") {\r\n\t\t_q_ = function _q_zero_or_many_(pc) {\r\n\t\t\twhile (pc.text[pc.i]) {\r\n\t\t\t\tlet i0 = pc.i, status;\r\n\t\t\t\tstatus = callb(pc);\r\n\t\t\t\tif (status) {\r\n\t\t\t\t\tif (i0 != pc.i) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Not strict variant. Mismatches allowed throw error message in console.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tconsole.error(`(!)`, `i0 == pc.i`, \r\n\t\t\t\t\t\t\t\"\\n\\tpc.i :\", pc.i, \"\\n\\tpc.monitor :\", pc.monitor); \r\n\t\t\t\t\t\tpc.i ++;\r\n\t\t\t\t\t\treturn true;\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Strict variant. Mismatches forbidden. Script will stoped.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\t// console.error(`(!)`, `i0 == pc.i`, pc); debugger; throw new Error();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else \r\n\t\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t} else if (quanto == \"+\") {\r\n\t\t_q_ = function _q_one_or_many_(pc) {\r\n\t\t\treturn callb(pc) && q(callb, \"*\")(pc);\r\n\t\t}\r\n\t} else if (quanto == \"?\") {\r\n\t\t_q_ = function _q_zero_or_one_(pc) {\r\n\t\t\treturn callb(pc) || true;\r\n\t\t}\r\n\t} else if (quanto == \"*/\") {\r\n\t\tchekToAnalyzer(\"q\", 3, callb2);\r\n\t\t_q_ = function _q_zero_or_many_sep_(pc) {\r\n\t\t\tseq(\r\n\t\t\t\tcallb,\r\n\t\t\t\tseq(callb2, callb).q(\"*\")\r\n\t\t\t)(pc);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t} else if (quanto == \"+/\") {\r\n\t\tchekToAnalyzer(\"q\", 3, callb2);\r\n\t\t_q_ = function _q_one_or_many_sep_(pc) {\r\n\t\t\treturn seq(\r\n\t\t\t\t\tcallb,\r\n\t\t\t\t\tseq(callb2, callb).q(\"*\")\r\n\t\t\t\t)(pc);\r\n\t\t}\r\n\t} else {\r\n\t\tconsole.error(`(!)`, `Invalid quantifier`, `'${quanto}'`); debugger; throw new Error();\r\n\t}\r\n\r\n\tObject.setPrototypeOf(_q_, Analyzer_proto);\r\n\treturn _q_;\r\n}\r\n\r\nfunction not(callb) {\r\n\tchekToAnalyzer(\"not\", 1, callb);\r\n\tconst _not_ = function _not_(pc) {\r\n\t\tconst hpc = pc.createHypo();\r\n\t\tconst res = callb(hpc);\r\n\t\tif (! res) {\r\n\t\t\tpc.match(pc.text[pc.i]);\r\n\t\t\treturn true;\r\n\t\t} else \r\n\t\t\treturn false;\r\n\t}\r\n\tObject.setPrototypeOf(_not_, Analyzer_proto);\r\n\treturn _not_;\r\n}\r\n\r\nfunction domain(name, callb, msg=null) {\r\n\tconst _domain_ = function _domain_(pc) {\r\n\t\tconst\r\n\t\t\tchpc = pc.createChildHypo(name),\r\n\t\t\tstatus = callb(chpc)\r\n\t\tif (msg) \r\n\t\t\tchpc.msg = msg;\r\n\t\tif (status || pc.errC.eFlag) \r\n\t\t\tpc.acceptChildHypo(chpc);\r\n\t\treturn !! status;\r\n\t}\r\n\t_domain_.msg = function (text) {\r\n\t\treturn domain(name, callb, text);\r\n\t}\r\n\t_domain_.as = function(otherName, msg=null) {\r\n\t\treturn domain(otherName, callb);\r\n\t}\r\n\tObject.setPrototypeOf(_domain_, Analyzer_proto);\r\n\treturn _domain_;\r\n}\r\n\r\nfunction rule(callb) {\r\n\tconst _rule_ = function _rule_(pc) {\r\n\t\tconst \r\n\t\t\thpc    = pc.createHypo(),\r\n\t\t\tstatus = callb(hpc);\r\n\t\tif (status || pc.errC.eFlag) \r\n\t\t\tpc.acceptHypo(hpc);\r\n\t\treturn !! status;\r\n\t}\r\n\tObject.setPrototypeOf(_rule_, Analyzer_proto);\r\n\treturn _rule_;\r\n}\r\n\r\nfunction token(...templs) {\r\n\tconst _token_ = function _token_(pc) {\r\n\t\treturn pc.match(...templs);\r\n\t}\r\n\tObject.setPrototypeOf(_token_, Analyzer_proto);\r\n\treturn _token_;\r\n}\r\n\r\nfunction nToken(...templs) {\r\n\tconst _notToken_ = function _notToken_(pc) {\r\n\t\treturn pc.notMatch(...templs);\r\n\t}\r\n\tObject.setPrototypeOf(_notToken_, Analyzer_proto);\r\n\treturn _notToken_;\r\n}\r\n\r\nfunction spToken(...templs) {\r\n\tconst _space_wrapped_token_ = function(pc) {\r\n\t\treturn seq(token(/\\s+/y).q(\"*\"), token(...templs), token(/\\s+/y).q(\"*\"),)(pc);\r\n\t}\r\n\tObject.setPrototypeOf(_space_wrapped_token_, Analyzer_proto);\r\n\treturn _space_wrapped_token_;\r\n}\r\n\r\nfunction spWrap(callb) {\r\n\tchekToAnalyzer(\"spWrap\", 1, callb);\r\n\tconst _space_wrapped_ = function(pc) {\r\n\t\treturn seq(token(/\\s+/y).q(\"*\"), callb, token(/\\s+/y).q(\"*\"),)(pc);\r\n\t}\r\n\tObject.setPrototypeOf(_space_wrapped_, Analyzer_proto);\r\n\treturn _space_wrapped_;\r\n}\r\n\r\nfunction error(msg) {\r\n\tconst _error_ = function(pc) {\r\n\t\tdomain(\"error\", token(/\\s*.*/y), msg)(pc);\r\n\t\tpc.errC.eFlag = true;\r\n\t\tdomain(\"after-error\", token(/\\s+|\\S+/y), msg).q(\"*\")(pc);\r\n\t\treturn true;\r\n\t}\r\n\tObject.setPrototypeOf(_error_, Analyzer_proto);\r\n\treturn _error_;\r\n}\r\n\r\nfunction undefinedError(msg) {\r\n\tconst _undefined_error_ = function(pc) {\r\n\t\treturn error(\"Undefined error. \"+msg)(pc);\r\n\t}\r\n\tObject.setPrototypeOf(_undefined_error_, Analyzer_proto);\r\n\treturn _undefined_error_;\r\n}\r\n\r\nfunction deb(callb, a=0, b=0) {\r\n\tchekToAnalyzer(\"deb\", 1, callb);\r\n\tfunction _deb_(pc) {\r\n\t\tb = b || pc.text.length;\r\n\t\tif (a <= pc.i && pc.i <= b) {\r\n\t\t\tdebugger;\r\n\t\t\tconst res = callb(pc);\r\n\t\t\tconsole.log(`res`, res);\r\n\t\t\tdebugger;\r\n\t\t\treturn res;\r\n\t\t}\r\n\t}\r\n\tObject.setPrototypeOf(_deb_, Analyzer_proto);\r\n\treturn _deb_;\r\n}\r\n\r\nfunction chekToAnalyzer(fName, argN, callb) {\r\n\tif (! callb || callb instanceof Analyzer_proto) {\r\n\t\tconsole.error(`Argument`, argN, `(from 1) of function '${fName}()' is not Analiser. There is: \\n`, callb?.toString ? callb.toString() : callb);\r\n\t\tthrow new Error(`Invalid callback. \\n\\tArgument ${argN} of function '${fName}()' is not Analiser. \\n`);\r\n\t} else\r\n\t\treturn true;\r\n}","import ParseContext from \"./ParseContext.js\";\r\nimport setCSS       from \"./CSS/highlighter.scss.js\";\r\n\r\nexport default class HighlightAPI {\r\n\r\n\tconstructor (mainRule, clPref=\"syntax-hl-fk\") {\r\n\t\tthis.mainRule = mainRule;\r\n\t\tthis.clPref   = clPref  ;\r\n\t\tsetCSS(this.clPref);\r\n\t}\r\n\r\n\t/**\r\n\t * getHighlighted       (template, firstLineNum, cssClasses)\r\n\t * highlightTextContent (el)\r\n\t * scrollToFirstError   (el)\r\n\t * highlight            (el, template, firstLineNum)\r\n\t * setMainRule          (rule)\r\n\t */\r\n\r\n\tgetHighlighted       (...args) { return getHighlighted       (this, ...args); }\r\n\thighlightTextContent (...args) { return highlightTextContent (this, ...args); }\r\n\tscrollToFirstError   (...args) { return scrollToFirstError   (this, ...args); }\r\n\thighlight            (...args) { return highlight            (this, ...args); }\r\n\tsetMainRule          (...args) { return setMainRule          (this, ...args); }\r\n}\r\n\r\n\r\nfunction getHighlighted(self, text, firstLineNum=1, cssClasses=\"\") {\r\n\tconst el = document.createElement(\"div\");\r\n\tif (typeof cssClasses == \"string\")\r\n\t\tel.className += \" \" + cssClasses;\r\n\telse if (cssClasses instanceof Array) \r\n\t\tel.classList.add(...cssClasses);\r\n\telse \r\n\t\tthrow new Error([\r\n\t\t\t\"(!) getHighlighted(). \",\r\n\t\t\t\"Argument #3 must be a string, an array of strings, or undefined.\",\r\n\t\t\t\"\",\r\n\t\t\tcssClasses+\" given.\",\r\n\t\t\t\"\"\r\n\t\t].join(\"\\n\"));\r\n\thighlight(self, el, text, firstLineNum);\r\n\treturn el;\r\n}\r\n\r\nfunction highlightTextContent(self, el) {\r\n\treturn highlight(self, el, el.textContent, getFirstLineNum(el));\r\n}\r\n\r\nfunction scrollToFirstError(self, el) {\r\n\tconst errEl = el.querySelector(\".error\");\r\n\tif (errEl) {\r\n\t\t// errEl.scrollIntoView();\r\n\t\tconst \r\n\t\t\ttop = errEl.getBoundingClientRect().top - el.getBoundingClientRect().top,\r\n\t\t\tvpH = el.clientHeight,\r\n\t\t\tdeltaScroll = top - vpH / 2;\r\n\t\tel.scrollTop = deltaScroll;\r\n\t}\r\n}\r\n\r\nfunction highlight(self, contentEl, text, firstLineNum=1) {\r\n\tif (! (contentEl instanceof HTMLElement))\r\n\t\tthrow new Error([\r\n\t\t\t\"(!) highlight(). Argument #1 must be a HTMLElement.\",\r\n\t\t\t\"\",\r\n\t\t\tcontentEl + \" given.\",\r\n\t\t\t\"\"\r\n\t\t].join(\"\\n\"));\r\n\r\n\tif ([\"executing\", \"executed\", \"exec-error\"].some((v) => contentEl.classList.contains(v)))\r\n\t\tthrow new Error([\r\n\t\t\t\"(!) Highlighter. Already handled.\", \r\n\t\t\t\"\",\r\n\t\t\tcontentEl\r\n\t\t].join(\"\\n\"));\r\n\t\r\n\tcontentEl.classList.add(self.clPref);\r\n\tcontentEl.classList.add(\"executing\");\r\n\tcontentEl.innerHTML = \"\";\r\n\r\n\tif (typeof text != \"string\")\r\n\t\tthrow new Error([\r\n\t\t\t\"(!) highlight(). Argument #2 must be a string.\",\r\n\t\t\t\"\",\r\n\t\t\ttext + \" given.\",\r\n\t\t\t\"\"\r\n\t\t].join(\"\\n\"));\r\n\r\n\ttry {\r\n\t\tconst\r\n\t\t\tmodel    = _buildModel(self, text),\r\n\t\t\tcontents = _renderToHighlight(self, model, firstLineNum);\r\n\t\tcontents.forEach((lineOb) => lineOb.appendTo(contentEl));\r\n\t\tcontentEl.classList.remove(\"executing\");\r\n\t\tcontentEl.classList.add(\"executed\");\r\n\t} catch (e) {\r\n\t\tconsole.error(`(!)-CATCHED`, e);\r\n\t\tconst lines = text.split(\"\\n\");\r\n\t\tlines.forEach((line, i, a) => {\r\n\t\t\tlet lineOb = _makeLine(self, firstLineNum + i);\r\n\t\t\tlet m = line.match(/^(\\s*)(.*)/);\r\n\t\t\t[lineOb.indent.textContent, lineOb.content.textContent] = [m[1], m[2]];\r\n\t\t\tif (i < a.length - 1)\r\n\t\t\t\tlineOb.setEol();\r\n\t\t\tlineOb.appendTo(contentEl);\r\n\t\t});\r\n\t\tcontentEl.classList.remove(\"executing\");\r\n\t\tcontentEl.classList.add(\"exec-error\");\r\n\t}\r\n}\r\n\r\nfunction setMainRule(self, rule) {\r\n\tself.mainRule = rule;\r\n}\r\n\r\nfunction _buildModel(self, text) {\r\n\tconst mSlot = [];\r\n\tself.mainRule(new ParseContext({\r\n\t\ttext, \r\n\t\ti: 0, \r\n\t\tmSlot, \r\n\t\tdStack: []\r\n\t}));\r\n\treturn mSlot;\r\n}\r\n\r\nfunction _renderToHighlight (self, model, firstLineNum=1) {\r\n\tconst content = [], nodeStack = [];\r\n\tlet lNum = firstLineNum, indentZoneFlag = true, lastLine;\r\n\tnodeStack.last = () => nodeStack[nodeStack.length - 1];\r\n\tcontent.push(lastLine = _makeLine(self, lNum ++));\r\n\trecur(model);\r\n\treturn content;\r\n\tfunction recur(sb) {\r\n\t\tif (sb instanceof Array) {\r\n\t\t\tsb.forEach(recur);\r\n\t\t} else if (typeof sb == \"object\") {\r\n\t\t\tsb.parent = nodeStack.last() || null;\r\n\r\n\t\t\tnodeStack.push(sb);\r\n\t\t\trecur(sb.ch);\r\n\t\t\tnodeStack.pop();\r\n\r\n\t\t} else if (typeof sb == \"string\") {\r\n\t\t\tif (sb == \"\\n\") {\r\n\t\t\t\tlastLine.setEol();\r\n\t\t\t\tcontent.push(lastLine = _makeLine(self, lNum ++));\r\n\t\t\t\tindentZoneFlag = true;\r\n\t\t\t} else if (indentZoneFlag && sb.match(/^\\s+$/)) {\r\n\t\t\t\tlastLine.indent.innerHTML += sb;\r\n\t\t\t} else {\r\n\t\t\t\tlet _sb = sb;\r\n\t\t\t\tif (indentZoneFlag) {\r\n\t\t\t\t\tconst m = sb.match(/^(\\s*)(.*)/);\r\n\t\t\t\t\tif (! m)\r\n\t\t\t\t\t\tthrow new Error(`sb not matched with /^(\\\\s+)(.*)/. sb = ${sb}`)\r\n\t\t\t\t\tconst\r\n\t\t\t\t\t\tindent = m[1],\r\n\t\t\t\t\t\ttheText = m[2];\r\n\t\t\t\t\tlastLine.indent.innerHTML += indent;\r\n\t\t\t\t\t_sb = theText;\r\n\t\t\t\t\tindentZoneFlag = false;\r\n\t\t\t\t}\r\n\t\t\t\tconst \r\n\t\t\t\t\tlastDomainNode = nodeStack.last(),\r\n\t\t\t\t\tclassName = nodeStack.map(v => v.name).filter(v => v).join(\"- \"),\r\n\t\t\t\t\tel = _evaluate(`<span class=\"${className || \"\"}\"></span>`);\r\n\t\t\t\tif (nodeStack.last()?.name == \"error\") {\r\n\t\t\t\t\tlastLine.guter.classList.add(\"error\");\r\n\t\t\t\t\tlastLine.guter.title = nodeStack.last()?.msg;\r\n\t\t\t\t}\r\n\t\t\t\tif (nodeStack.last()?.name == \"after-error\") {\r\n\t\t\t\t\tlastLine.guter.classList.add(\"after-error\");\r\n\t\t\t\t\tlastLine.guter.title = nodeStack.last()?.msg;\r\n\t\t\t\t}\r\n\t\t\t\tlastLine.content.appendChild(el);\r\n\t\t\t\tel.textContent = _sb;\r\n\t\t\t\tel.astNode = nodeStack.last();\r\n\t\t\t\tconst msgStr = nodeStack.reduce((a,v) => {\r\n\t\t\t\t\tif (v.msg) \r\n\t\t\t\t\t\ta += `${v.name} : ${v.msg} \\n`;\r\n\t\t\t\t\treturn a;\r\n\t\t\t\t}, \"\");\r\n\t\t\t\tif (msgStr) {\r\n\t\t\t\t\tel.title = msgStr;\r\n\t\t\t\t\tel.style.cursor = \"pointer\";\r\n\t\t\t\t}\r\n\t\t\t\tif (lastDomainNode) {\r\n\t\t\t\t\tel.dataset.region = `${lastDomainNode.i0}:${lastDomainNode.i1}`;\r\n\t\t\t\t\tel.domain = lastDomainNode;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconsole.error(\"Invalid model node\", sb);\r\n\t\t\tthrow new Error(\"Invalid model node.\")\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction _makeLine(self, num) {\r\n\treturn Object.setPrototypeOf(\r\n\t\t{\r\n\t\t\tline: _evaluate(\r\n\t\t\t\t`<span class=\"${self.clPref}__line\">`+\r\n\t\t\t\t\t`<span class=\"${self.clPref}__line-number\" data-line-number=\"${num}\"></span>`+\r\n\t\t\t\t\t`<span class=\"${self.clPref}__line-indent\"></span>`+\r\n\t\t\t\t\t`<span class=\"${self.clPref}__line-text\"  ></span>`+\r\n\t\t\t\t`</span>`\r\n\t\t\t),\r\n\t\t\teol: null,\r\n\t\t\tget guter  () {return this.line.children[0]},\r\n\t\t\tget indent () {return this.line.children[1]},\r\n\t\t\tget content() {return this.line.children[2]},\r\n\t\t},\r\n\t\t{\r\n\t\t\tappendTo: function(parent) {\r\n\t\t\t\tparent.appendChild(this.line);\r\n\t\t\t\tif (this.eol)\r\n\t\t\t\t\tparent.appendChild(this.eol);\r\n\t\t\t},\r\n\t\t\tsetEol: function() {this.eol = _evaluate(`<span>\\n</span>`);}\r\n\t\t}\r\n\t) \r\n}\r\n\r\nfunction _evaluate (code) {\r\n\tconst shell = document.createElement(\"div\");\r\n\tshell.innerHTML = code;\r\n\treturn shell.children[0];\r\n}\r\n\r\n\r\nfunction getFirstLineNum(el) {\r\n\tconst dln = parseInt(el.dataset.lineNum);\r\n\tif (! dln)\r\n\t\treturn 1;\r\n\telse if (el.nodeName == \"PRE\")\r\n\t\treturn dln + 1;\r\n\telse \r\n\t\treturn dln;\r\n}","import ModelNode    from \"./ModelNode.js\";\r\n\r\nexport default class ParseContext {\r\n\tconstructor(pc) {\r\n\t\tObject.defineProperties(this,{\r\n\t\t\ttext:   {value: pc.text},\r\n\t\t\tmSlot:  {value: pc.mSlot},\r\n\t\t\tdStack: {value: pc.dStack},\r\n\t\t\tlFStack: {value: pc.lFStack},\r\n\t\t\terrC: {value: pc.errC || {eFlag: false}},\r\n\t\t});\r\n\t\tthis.i = pc.i;\r\n\t\tthis.i0 = pc.i0;\r\n\t\tthis.selfMN = pc.selfMN;\r\n\t\tthis.monitor = pc.monitor;\r\n\t\t// this.debugDomain = pc.debugDomain;\r\n\t}\r\n\tmatch (...templs) {\r\n\t\tfor (let t of templs) {\r\n\t\t\tconst {mSubstr, len} = this._getMatchSubstr(t);\r\n\t\t\tif (mSubstr) {\r\n\t\t\t\tthis.i += len;\r\n\t\t\t\tpush(this.mSlot, mSubstr);\r\n\t\t\t\tthis.monitor = this.i+ \" : \"+this.text.substr(this.i, 20)\r\n\t\t\t\treturn mSubstr;\r\n\t\t\t}\r\n\t\t} \r\n\t\treturn \"\";\r\n\t}\r\n\tnotMatch (...templs) {\r\n\t\tfor (let t of templs) {\r\n\t\t\tconst {mSubstr, len} = this._getMatchSubstr(t);\r\n\t\t\tif (mSubstr) \r\n\t\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tconst simbol = this.text[this.i];\r\n\t\tpush(this.mSlot, simbol);\r\n\t\tthis.i += 1;\r\n\t\tthis.monitor = this.i+ \" : \"+this.text.substr(this.i, 20);\r\n\t\treturn simbol;\r\n\t}\r\n\tcreateHypo () {\r\n\t\tconst \r\n\t\t\t{text, i, mSlot, dStack, errC} = this,\r\n\t\t\thpc = {text, i, mSlot: [], dStack, errC};\r\n\t\treturn new ParseContext(hpc);\r\n\t}\r\n\tacceptHypo (hpc) {\r\n\t\tthis.i = hpc.i;\r\n\t\tthis.monitor = hpc.monitor;\r\n\t\t// this.mSlot.push(...hpc.mSlot);\r\n\t\thpc.mSlot.forEach((v) => push(this.mSlot, v));\r\n\t\treturn true;\r\n\t}\r\n\tcreateChildHypo (name) {\r\n\t\tconst \r\n\t\t\t{text, i, dStack, errC} = this,\r\n\t\t\tmSlot = [],\r\n\t\t\tmn = new ModelNode(name, mSlot),\r\n\t\t\thpc = {text, i, i0: i, mSlot, selfMN: mn, dStack, errC};\r\n\t\tmn.i0 = i;\r\n\t\treturn new ParseContext(hpc);\r\n\t}\r\n\tacceptChildHypo (hpc) {\r\n\t\tthis.i = this.i1 = hpc.i;\r\n\t\tpush(this.mSlot, hpc.selfMN);\r\n\t\thpc.selfMN.i1 = hpc.i;\r\n\t\tif (hpc.msg)\r\n\t\t\thpc.selfMN.msg = hpc.msg;\r\n\t\thpc.selfMN = null;\r\n\t\treturn true;\r\n\t}\r\n\t_getMatchSubstr (templ) {\r\n\t\tlet mSubstr = \"\", len;\r\n\t\tif (typeof templ == \"string\") {\r\n\t\t\tlen = templ.length;\r\n\t\t\tconst substr = this.text.substr(this.i, len);\r\n\t\t\tif (substr === templ)\r\n\t\t\t\tmSubstr = substr;\r\n\t\t\t\r\n\t\t} else if (templ instanceof RegExp) {\r\n\t\t\ttempl.lastIndex = this.i;\r\n\t\t\tconst mOb    = this.text.match(templ);\r\n\t\t\tmSubstr =  mOb && mOb[0] || \"\";\r\n\t\t\tlen = mSubstr.length;\r\n\t\t}\r\n\r\n\t\treturn {mSubstr, len};\r\n\t}\r\n}\r\n\r\n\r\n\r\nfunction push(arr, subj) {\r\n\tif (typeof subj == \"string\") {\r\n\t\tlet lines = subj.split(\"\\n\");\r\n\t\tfor (let [k, line] of lines.entries()) {\r\n\t\t\tif (k)\r\n\t\t\t\tarr.push(\"\\n\");\r\n\t\t\tif (line)\r\n\t\t\t\tpushOneLineText(arr, line);\r\n\t\t}\r\n\t} else \r\n\t\tarr.push(subj);\r\n}\r\n\r\nfunction pushOneLineText(arr, subj) {\r\n\tlet i = arr.length - 1;\r\n\tif (\r\n\t\ttypeof arr[i] == \"string\" \r\n\t\t&& typeof subj == \"string\" \r\n\t\t&& arr[i] !== \"\\n\" \r\n\t\t&& subj !== \"\\n\"\r\n\t\t&& (\r\n\t\t\tsubj.match(/^\\s+$/) && arr[i].match(/^\\s+$/) \r\n\t\t\t||\r\n\t\t\t! subj.match(/^\\s+$/) && ! arr[i].match(/^\\s+$/) \r\n\t\t)\r\n\t)\r\n\t\tarr[i] += subj;\r\n\telse\r\n\t\tarr.push(subj);\r\n}","export default class ModelNode {\r\n\tconstructor (name, ch) {\r\n\t\tObject.defineProperties(this,{\r\n\t\t\tname: {value: name},\r\n\t\t\tch  : {value: ch},\r\n\t\t});\r\n\t}\r\n\r\n\tget text () {\r\n\t\tlet res = \"\";\r\n\t\trecur(this.ch);\r\n\t\treturn res;\r\n\t\tfunction recur(sb) {\r\n\t\t\tif (sb instanceof Array) {\r\n\t\t\t\tsb.forEach(recur);\r\n\t\t\t} else if (typeof sb == \"object\") {\r\n\t\t\t\trecur(sb.ch);\r\n\t\t\t} else {\r\n\t\t\t\tres += sb;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}","export default function setStyle(clPref) {\r\n\r\n\tconst cssCode = `.syntax-hl-fk {\r\n  text-align: left;\r\n  white-space: pre;\r\n  background-color: #444;\r\n  color: #ccc;\r\n  -moz-tab-size: 4;\r\n  tab-size: 4;\r\n  overflow: auto;\r\n  max-height: 500px;\r\n  padding: 20px;\r\n  font-family: consolas, monospace;\r\n}\r\n.syntax-hl-fk *::selection {\r\n  background-color: #000;\r\n  background-color: rgba(120, 120, 120, 0.5);\r\n}\r\n.syntax-hl-fk .syntax-hl-fk__line {\r\n  margin-left: -20px;\r\n}\r\n.syntax-hl-fk .syntax-hl-fk__line > * {\r\n  display: table-cell;\r\n}\r\n.syntax-hl-fk .syntax-hl-fk__line .syntax-hl-fk__line-number {\r\n  width: 50px;\r\n  min-width: 50px;\r\n  max-width: 50px;\r\n  text-align: right;\r\n  background-color: #333;\r\n  padding-right: 10px;\r\n  margin-right: 5px;\r\n  transition: all 0.2s;\r\n}\r\n.syntax-hl-fk .syntax-hl-fk__line .syntax-hl-fk__line-number:before {\r\n  content: attr(data-line-number) \"\";\r\n}\r\n.syntax-hl-fk .syntax-hl-fk__line span.syntax-hl-fk__line-number.error {\r\n  color: #fff;\r\n  background-color: #e48;\r\n}\r\n.syntax-hl-fk .syntax-hl-fk__line .syntax-hl-fk__line-indent {\r\n  padding-left: 5px;\r\n}\r\n.syntax-hl-fk .syntax-hl-fk__line .syntax-hl-fk__line-text {\r\n  padding-left: 20px;\r\n  white-space: pre-wrap;\r\n  word-break: break-word;\r\n}\r\n.syntax-hl-fk .syntax-hl-fk__line .syntax-hl-fk__line-text .error {\r\n  color: #fff;\r\n  background-color: #e48;\r\n  box-shadow: inset 0 0 2px #fff;\r\n}\r\n.syntax-hl-fk .syntax-hl-fk__line .syntax-hl-fk__line-text:before {\r\n  content: \"\";\r\n  margin-left: -20px;\r\n}\r\n\r\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJmaWxlOi8vL0Q6L0dpdEh1Yi1teS9zeW50YXgtaGlnaGxpZ2h0LWZyYW1ld29yay9jc3MvaGlnaGxpZ2h0ZXIuc2NzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQTtFQUNDO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUVBO0VBQ0E7RUFDQTtFQUNBOztBQUNBO0VBQ0M7RUFDQTs7QUFHRDtFQUNDOztBQUNBO0VBQ0M7O0FBRUQ7RUFDQztFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBOztBQUNBO0VBQ0M7O0FBR0Y7RUFDQztFQUFhOztBQUVkO0VBQ0M7O0FBRUQ7RUFDQztFQUNBO0VBQ0E7O0FBQ0E7RUFDQztFQUNBO0VBQ0E7O0FBRUQ7RUFDQztFQUNBIiwiZmlsZSI6ImhpZ2hsaWdodGVyLnNjc3MuanMifQ== */`.replaceAll(/syntax-hl-fk/g, clPref);\r\n\r\n\tconst styleClassName = `${clPref}__theme-style`;\r\n\r\n\tconst styleAlreadyExists = [].some.call(\r\n\t\tdocument.querySelectorAll(`style.${styleClassName}`), \r\n\t\t(v) => v.textContent === cssCode\r\n\t);\r\n\r\n\tif (! styleAlreadyExists) {\r\n\t\tconst style = eHTML(`<style class=\"${styleClassName}\"></style>`);\r\n\t\tstyle.textContent = cssCode;\r\n\t\tdocument.head.appendChild(style);\r\n\t}\r\n}\r\n\r\n\r\nfunction eHTML(code, shell=null) {\r\n\tconst _shell = \r\n\t\t! shell                  ? document.createElement(\"div\") :\r\n\t\ttypeof shell == \"string\" ? document.createElement(shell) :\r\n\t\ttypeof shell == \"object\" ? shell :\r\n\t\t\tnull;\r\n\t_shell.innerHTML = code;\r\n\treturn _shell.children[0];\r\n}","export default function setStyle(clPref) {\r\n\r\n\tconst cssCode = `.line-format-diagram {\n  font-size: 14px;\n  white-space: nowrap;\n  color: #333;\n  margin: 10px 5px;\n  padding: 10px 5px;\n  user-select: none;\n  font-family: consolas, courier, monospace;\n  /*&.executed *{\n  \tdisplay: inline-block;\n  \ttext-align: center;\n  }*/\n  /*&:not(.executed) {\n  \tfont-family: monospace;\n  \twhite-space: pre;\n  \ttext-align: left;\n  }*/\n}\n.line-format-diagram .line-format-diagram-part {\n  display: inline-block;\n  text-align: center;\n  border-right: 1px solid transparent;\n  border-left: 1px solid transparent;\n  margin-right: -1px;\n}\n.line-format-diagram .line-format-diagram-part .line-format-diagram-grid-v-liner {\n  margin: 0 1px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 50px;\n}\n.line-format-diagram .line-format-diagram-part .line-format-diagram-description:hover {\n  user-select: text;\n}\n.line-format-diagram .line-format-diagram-part .line-format-diagram-top-descr .line-format-diagram-h-line {\n  border-top: 1px solid #999;\n  flex-grow: 10;\n}\n.line-format-diagram .line-format-diagram-part .line-format-diagram-top-descr .line-format-diagram-td-block {\n  flex-grow: 1;\n}\n.line-format-diagram .line-format-diagram-part .line-format-diagram-line-text {\n  font-size: 20px;\n  font-weight: bold;\n  color: #333;\n  white-space: pre;\n  background-clip: padding-box;\n  border-left: 1px solid transparent;\n  border-right: 1px solid transparent;\n  margin: -1px;\n  margin-top: 5px;\n  font-family: consolas, courier, monospace;\n  user-select: text;\n}\n.line-format-diagram .line-format-diagram-part .line-format-diagram-bottom-rel-wr {\n  border-left: 1px solid transparent;\n  border-right: 1px solid transparent;\n  border-color: #999;\n  padding: 5px 1px;\n  margin: -1px;\n  display: block;\n}\n.line-format-diagram .line-format-diagram-part .line-format-diagram-bottom-rel-wr .line-format-diagram-bottom-rel {\n  text-align: center;\n  display: block;\n  position: relative;\n  border-bottom: 1px solid #999;\n}\n.line-format-diagram .line-format-diagram-part .line-format-diagram-bottom-rel-wr .line-format-diagram-bottom-rel > .line-format-diagram-rel-line {\n  display: inline-block;\n  position: absolute;\n  width: 10px;\n  border-left: 1px solid #999;\n  border-bottom: 1px solid #999;\n  padding-bottom: calc(5px + .5em);\n}\n.line-format-diagram .line-format-diagram-part .line-format-diagram-bottom-rel-wr .line-format-diagram-bottom-rel > .line-format-diagram-rel-line > .line-format-diagram-bottom-descr {\n  position: absolute;\n  left: 100%;\n  white-space: pre;\n  border: 1px solid #999;\n  text-align: left;\n}\n.line-format-diagram .line-format-diagram-part.show-borders {\n  border-color: #999;\n}\n.line-format-diagram .line-format-diagram-part.show-borders .sps-line-text {\n  border-color: #999;\n}\n.line-format-diagram .line-format-diagram-grid-v-liner + .line-format-diagram-part {\n  margin-left: -1px;\n}\n.line-format-diagram .line-format-diagram-grid-bv-liner {\n  padding: 5px;\n  border: 4px solid transparent;\n  display: block;\n}\n\n.line-format-diagram.top-lines .line-format-diagram-part .line-format-diagram-grid-v-liner {\n  margin-top: 5px;\n  border-top: 1px solid transparent;\n}\n.line-format-diagram.top-lines .line-format-diagram-part .line-format-diagram-top-descr {\n  border-top: 1px solid #999;\n  align-items: flex-start;\n}\n.line-format-diagram.top-lines .line-format-diagram-part .line-format-diagram-top-descr .line-format-diagram-h-line {\n  border: none;\n}\n\n.line-format-diagram.bottom-lines .line-format-diagram-part .line-format-diagram-grid-v-liner {\n  margin-bottom: 5px;\n  border-bottom: 1px solid transparent;\n}\n.line-format-diagram.bottom-lines .line-format-diagram-part .line-format-diagram-top-descr {\n  border-bottom: 1px solid #999;\n  margin-top: -5px;\n  align-items: flex-end;\n}\n.line-format-diagram.bottom-lines .line-format-diagram-part .line-format-diagram-top-descr .line-format-diagram-h-line {\n  border: none;\n}\n\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJmaWxlOi8vL0Q6L0dpdEh1Yi1teS9saW5lLWZvcm1hdC1kaWdyYW0vQ1NTL2xmZC5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQVlBO0VBQ0M7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUtBO0FBQUE7QUFBQTtBQUFBO0FBQUE7O0FBTUE7RUFDQztFQUNBO0VBQ0E7RUFDQTtFQUNBOztBQUNBO0VBQ0M7RUFFQTtFQUNBO0VBQ0E7RUFDQTs7QUFNQTtFQUNDOztBQUtEO0VBQ0M7RUFDQTs7QUFFRDtFQUNDOztBQUdGO0VBQ0M7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFFRDtFQUNDO0VBQ0E7RUFDQSxjQXpFZTtFQTBFZjtFQUNBO0VBQ0E7O0FBQ0E7RUFDQztFQUNBO0VBQ0E7RUFDQTs7QUFDQTtFQUNDO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7QUFDQTtFQUNDO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7O0FBTUw7RUFDQyxjQXJHZ0I7O0FBc0doQjtFQUNDLGNBdkdlOztBQTBHakI7RUFDQzs7QUFFRDtFQUNDLFNBL0d3QjtFQWdIeEI7RUFDQTs7O0FBTUE7RUFDQztFQUNBOztBQUVEO0VBQ0M7RUFDQTs7QUFDQTtFQUNDOzs7QUFTRjtFQUNDO0VBQ0E7O0FBRUQ7RUFDQztFQUNBO0VBQ0E7O0FBQ0E7RUFDQyIsImZpbGUiOiJsZmQuc2Nzcy5qcyJ9 */`.replaceAll(/\\bline-format-diagram/g, clPref);\r\n\r\n\tconst styleClassName = `${clPref}__theme-style`;\r\n\r\n\tconst styleAlreadyExists = [].some.call(\r\n\t\tdocument.querySelectorAll(`style.${styleClassName}`), \r\n\t\t(v) => v.textContent === cssCode\r\n\t);\r\n\r\n\tif (! styleAlreadyExists) {\r\n\t\tconst style = eHTML(`<style class=\"${styleClassName}\"></style>`);\r\n\t\tstyle.textContent = cssCode;\r\n\t\tdocument.head.appendChild(style);\r\n\t}\r\n}\r\n\r\n\r\nfunction eHTML(code, shell=null) {\r\n\tconst _shell = \r\n\t\t! shell                  ? document.createElement(\"div\") :\r\n\t\ttypeof shell == \"string\" ? document.createElement(shell) :\r\n\t\ttypeof shell == \"object\" ? shell :\r\n\t\t\tnull;\r\n\t_shell.innerHTML = code;\r\n\treturn _shell.children[0];\r\n}","import * as lib from \"./lib.js\";\nimport JsonEHl  from \"./json-err-hl/json-err-hl.js\";\n\nexport default function buildDiagram(self, elem, tOb) {\n\telem.classList.add(self.clPref);\n\tconst opts = Object.assign({\n\t\tstyle:  \"\",\n\t\tbdColor: \"\",\n\t\tlineNum: 0,\n\t}, elem.dataset);\n\n\topts.bdColor = opts.bdColor &&= ` border-color: ${opts.bdColor}; `;\n\n\tconst {tLevels, bLevels} = _getLevels(tOb);\n\tconst htmlStr = _getHtmlStr(tOb, opts, tLevels, bLevels, self.clPref) \n\t\t+ _getLinersHtmlStr(bLevels, self.clPref);\n\n\telem.innerHTML = htmlStr;\n}\n\nfunction _getLevels(tOb) {\n\tconst \n\t\ttLevels = [],\n\t\tbLevels = [];\n\n\trecursive(tOb, 0);\n\tif (bLevels.length)\n\t\tbLevels.push(1);\n\treturn {tLevels, bLevels};\n\n\tfunction recursive(tOb, level=0) {\n\t\ttLevels[level] ||= 0;\n\n\t\tif (tOb instanceof Array) {\n\n\t\t\tfor (let node of tOb) \n\t\t\t\trecursive(node, level);\n\n\t\t} else if (tOb.ch) {\n\n\t\t\tconst node = tOb;\n\n\t\t\tif (\"td\" in node) {\n\t\t\t\tconst \n\t\t\t\t\tlines = node.td.split(\"\\n\"),\n\t\t\t\t\tn = lines.length;\n\t\t\t\tif (tLevels[level] < n)\n\t\t\t\t\ttLevels[level] = n;\n\t\t\t\tnode.topDescr = lines.join(\"<br/>\");\n\t\t\t} else {\n\t\t\t\tdelete node.topDescr;\n\t\t\t}\n\n\t\t\tif (node.ch)\n\t\t\t\tif (typeof node.ch != \"string\")\n\t\t\t\t\trecursive(node.ch, level + 1);\n\n\t\t\tif (node.bd) {\n\t\t\t\tif (typeof node.ch == \"string\") {\n\t\t\t\t\tconst \n\t\t\t\t\t\tlines = node.bd.split(\"\\n\"),\n\t\t\t\t\t\tn = lines.length;\n\t\t\t\t\tbLevels.push(n);\n\t\t\t\t\tnode.bottomDescr = lines.join(\"<br/>\");\n\t\t\t\t} else {\n\t\t\t\t\tnode.bottomDescr = null;\n\t\t\t\t\tnode.errors = node.errors || [];\n\t\t\t\t\tnode.errors.push(\"'node.bd' is deleted.\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdelete node.bottomDescr;\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction _getHtmlStr(templ, opts, tLevels, _bLevels, clPref) {\n\tlet \n\t\tbLevels = _bLevels.map(v => v),\n\t\tstr     = \"\",\n\t\tserialN = -1;\n\n\trecursive(templ, 0);\n\treturn str;\n\n\tfunction recursive(templ, level=0, inheritStyle=\"\", partChIndex=0) {\n\t\tif (templ instanceof Array) {\n\t\t\tfor (let [index, node] of templ.entries()) \n\t\t\t\trecursive(node, level, inheritStyle, index);\n\t\t} else if (templ.ch) {\n\n\t\t\tconst node = Object.assign({\n\t\t\t\ttbStyle: \"\",\n\t\t\t\ttdStyle: \"\",\n\t\t\t\tstyle  : \"\",\n\t\t\t\tbbStyle: \"\",\n\t\t\t\tbdStyle: \"\",\n\t\t\t\tclass  : \"\",\n\t\t\t}, templ);\n\n\t\t\tconst hFZ = _getHFZ(tLevels[level]);\n\n\t\t\tlet \n\t\t\t\tlocalBdColor = \"border-color: transparent;\",\n\t\t\t\tshowBdsClass = \"\";\n\n\t\t\tif (\"topDescr\" in node) {\n\t\t\t\tshowBdsClass = \"show-borders\";\n\t\t\t\tlocalBdColor = opts.bdColor;\n\t\t\t} else {}\n\n\t\t\tstr += `<div class=\"${clPref}-part ${showBdsClass} ${node.class}\" ` + \n\t\t\t\t`style=\"${localBdColor}\" ` +\n\t\t\t\t`data-serial-n=\"${++ serialN}\"` +\n\t\t\t\t`data-part-ch-index=\"${partChIndex}\">`;\n\t\t\t\n\t\t\tif (\"topDescr\" in node)\n\t\t\t\tstr += [\n\t\t\t\t\t`<div `,\n\t\t\t\t\t\t`class=\"`,\n\t\t\t\t\t\t\t`${clPref}-top-descr `,\n\t\t\t\t\t\t\t`${clPref}-description `,\n\t\t\t\t\t\t\t`${clPref}-grid-v-liner `,\n\t\t\t\t\t\t\t`${node.class}`,\n\t\t\t\t\t\t`\" `,\n\t\t\t\t\t\t`style=\"`,\n\t\t\t\t\t\t\t`\\n/* Autogenerated*/  ${hFZ}`,\n\t\t\t\t\t\t\t`\\n/*Common bdColor*/  ${opts.bdColor}`,\n\t\t\t\t\t\t`\"`,\n\t\t\t\t\t`>`,\n\n\t\t\t\t\t\t`<div `,\n\t\t\t\t\t\t\t`class=\"${clPref}-h-line ${node.class}\" `,\n\t\t\t\t\t\t\t`style=\"`,\n\t\t\t\t\t\t\t\t`\\n/*Common bdColor*/  ${opts.bdColor} `,\n\t\t\t\t\t\t\t\t`\\n/* Local tbStyle*/  ${node.tbStyle}\"`,\n\t\t\t\t\t\t`></div>`,\n\n\t\t\t\t\t\t`<div `,\n\t\t\t\t\t\t\t`class=\"${clPref}-td-block ${node.class}\" `,\n\t\t\t\t\t\t\t`style=\"/*Local tdStyle*/  ${node.tdStyle}\"`,\n\t\t\t\t\t\t`>`,\n\t\t\t\t\t\t\t\t`${node.topDescr}`,\n\t\t\t\t\t\t`</div>`,\n\n\t\t\t\t\t\t`<div `,\n\t\t\t\t\t\t\t`class=\"${clPref}-h-line ${node.class}\" `,\n\t\t\t\t\t\t\t`style=\"`,\n\t\t\t\t\t\t\t\t`\\n/*Common bdColor*/  ${opts.bdColor} `,\n\t\t\t\t\t\t\t\t`\\n/* Local tbStyle*/  ${node.tbStyle}\"`,\n\t\t\t\t\t\t`></div>`,\n\n\t\t\t\t\t`</div>`,\n\t\t\t\t].join(\"\");\n\t\t\telse \n\t\t\t\tstr += `<div \n\t\t\t\t\tclass=\"${clPref}-grid-v-liner\" \n\t\t\t\t\tstyle=\"/*Autogenerated*/  ${hFZ}\"\n\t\t\t\t></div>`;\n\n\t\t\tif (node.ch)\n\t\t\t\tif (typeof node.ch == \"string\") {\n\n\t\t\t\t\tfor (let i = level + 1; i < tLevels.length; i++) {\n\t\t\t\t\t\tlet hFZ = _getHFZ(tLevels[i]);\n\t\t\t\t\t\tstr += `<div class=\"${clPref}-grid-v-liner\" style=\"${hFZ}\"></div>`; \n\t\t\t\t\t}\n\n\t\t\t\t\tstr += [\n\t\t\t\t\t\t`<div `,\n\t\t\t\t\t\t\t`class=\"${clPref}-line-text ${node.class}\" `,\n\t\t\t\t\t\t\t`style=\"`,\n\t\t\t\t\t\t\t\t`\\n/*  Autogenerated*/  ${localBdColor}`,\n\t\t\t\t\t\t\t\t`\\n/*   Common style*/  ${opts.style}`,\n\t\t\t\t\t\t\t\t`\\n/*Inherited style*/  ${inheritStyle}`,\n\t\t\t\t\t\t\t\t`\\n/*      Own style*/  ${node.style}`,\n\t\t\t\t\t\t\t`\"`,\n\t\t\t\t\t\t`>${node.ch}</div>`\n\t\t\t\t\t].join(\"\");\n\n\t\t\t\t} else if (typeof node.ch == \"object\" && \"length\" in node.ch) {\n\t\t\t\t\trecursive(node.ch, level + 1, inheritStyle+node.style);\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(`(!) \"ch\" must be a string or an array.`);\n\t\t\t\t}\n\n\t\t\tif (node.bottomDescr) {\n\n\t\t\t\tlet strCount = bLevels.shift();\n\t\t\t\tstr += [\n\t\t\t\t\t`<div class=\"${clPref}-bottom-rel-wr ${node.class}\" `,\n\t\t\t\t\t\t`style=\"/*Common bdColor*/  ${opts.bdColor}\">`,\n\n\t\t\t\t\t\t`<div class=\"${clPref}-bottom-rel ${node.class}\" `,\n\t\t\t\t\t\t\t`style=\"`,\n\t\t\t\t\t\t\t\t`\\n/*Common bdColor*/  ${opts.bdColor}`,\n\t\t\t\t\t\t\t\t`\\n/* Local bbStyle*/  ${(node.bbStyle)}`,\n\t\t\t\t\t\t\t`\">`,\n\n\t\t\t\t\t\t\t`<div class=\"${clPref}-rel-line ${node.class}\" `,\n\t\t\t\t\t\t\t\t`style=\"`,\n\t\t\t\t\t\t\t\t\t`\\n/*Common bdColor*/  ${opts.bdColor}`,\n\t\t\t\t\t\t\t\t\t`\\n/* Local bbStyle*/  ${(node.bbStyle)}`,\n\t\t\t\t\t\t\t\t`\">`\n\t\t\t\t].join(\"\");\n\n\t\t\t\tbLevels.forEach((node) => {\n\t\t\t\t\tstr += [\n\t\t\t\t\t\t`<div class=\"${clPref}-grid-bv-liner\" `,\n\t\t\t\t\t\t\t`style=\"/*Autogenerated*/  height: ${node * 1.2}em\"></div>`\n\t\t\t\t\t].join(\"\");\n\t\t\t\t});\n\n\t\t\t\tstr += [\n\t\t\t\t\t\t\t\t`<div `,\n\t\t\t\t\t\t\t\t\t`class=\"`,\n\t\t\t\t\t\t\t\t\t\t`${clPref}-bottom-descr `,\n\t\t\t\t\t\t\t\t\t\t`${clPref}-description `,\n\t\t\t\t\t\t\t\t\t\t`${clPref}-grid-bv-liner `,\n\t\t\t\t\t\t\t\t\t\t`${node.class}`,\n\t\t\t\t\t\t\t\t\t`\" `,\n\t\t\t\t\t\t\t\t\t`style=\"`,\n\t\t\t\t\t\t\t\t\t\t`\\n/*Autogenerated*/  height: ${strCount * 1.2}em; `,\n\t\t\t\t\t\t\t\t\t\t`\\n/*Common bdColor*/  ${opts.bdColor}`,\n\t\t\t\t\t\t\t\t\t\t`\\n/* Local bdStyle*/  ${(node.bdStyle)}`,\n\t\t\t\t\t\t\t\t\t`\"`,\n\t\t\t\t\t\t\t\t`>`,\n\t\t\t\t\t\t\t\t\t`${node.bottomDescr}`,\n\t\t\t\t\t\t\t\t`</div>`,\n\t\t\t\t\t\t\t`</div>`,\n\t\t\t\t\t\t`</div>`,\n\t\t\t\t\t`</div>`,\n\t\t\t\t].join(\"\");\n\t\t\t}\n\n\t\t\t\n\n\t\t\tstr += `</div>`; // .${clPref}-part\n\t\t}\n\t}\n}\nfunction _getLinersHtmlStr(bLevels, clPref) {\n\tlet str = \"\";\n\tfor (let i = bLevels.length - 1; 0 <= i; i --) \n\t\tstr += `<div class=\"${clPref}-grid-bv-liner\" `+\n\t\t\t`style=\"/*Autogenerated*/  height: ${bLevels[i] * 1.3}em\"></div>`;\n\t\n\treturn str;\n}\n\nfunction _getHFZ(lineCount) {\n\treturn `height: ${lineCount * 1.5}em; font-size: 1em; `;\n}","import * as lib          from \"./../lib.js\";\r\nimport buildDiagram      from \"./../buildDiagram.js\";\r\nimport JsonEHl           from \"./../json-err-hl/json-err-hl.js\";\r\nimport getSelArgs        from \"./getSelArgs.js\";\r\n\r\nexport default class DiagramEditor {\r\n\tconstructor (clPref, elem, tOb) { constructor(this, clPref, elem, tOb);}\r\n}\r\n\r\nfunction constructor(self, clPref, elem, tOb) {\r\n\telem.innerHTML = \"\";\r\n\r\n\tself.clPref      = clPref;\r\n\tself.tOb         = tOb;\r\n\t[self.dom, self.domApi, self.updateButtons] = _getAppDom(self); \r\n\tself.editStage   = {\r\n\t\t\ttOb:     tOb.clone,\r\n\t\t\tselArgs: {\r\n\t\t\t\trootNode: null,\r\n\t\t\t\trootPart: null,\r\n\t\t\t\taEl     : null,\r\n\t\t\t\tbEl     : null,\r\n\t\t\t\ta       : null,\r\n\t\t\t\tb       : null,\r\n\t\t\t}\r\n\t\t};\r\n\tself.history   = [];\r\n\tself.history.i = -1;\r\n\r\n\r\n\telem.append(self.dom);\r\n\r\n\teditLoop.commit(self);\r\n\r\n\tdocument.addEventListener(\"selectionchange\", function(ev) {\r\n\t\tconst \r\n\t\t\tclPref = self.clPref,\r\n\t\t\ttOb    = self.editStage.tOb;\r\n\t\tself.editStage.selArgs = getSelArgs(clPref, tOb);\r\n\t\tselectLoop(self);\r\n\t});\r\n\r\n}\r\n\r\neditLoop.commit = commit;\r\n\r\nfunction commit(self) {\r\n\tconst {editStage, history} = self;\r\n\tthis(self);\r\n\r\n\thistory.i ++;\r\n\thistory[history.i] = editStage.tOb.clone;\r\n\thistory.splice(history.i + 1, Infinity);\r\n\tself.updateButtons();\r\n}\r\n\r\nfunction editLoop(self) {\r\n\tbuildDiagram(self, self.domApi.diagram.el, self.editStage.tOb);\r\n\tself.domApi.codeField.el.textContent = _stringify(self.editStage.tOb);\r\n\tself.domApi.diagram.el.querySelectorAll(`.${self.clPref}-td-block`).forEach((v,i,a) => {\r\n\t\tcreateOnEditField(self, v, \"td\");\r\n\t});\r\n\tself.domApi.diagram.el.querySelectorAll(`.${self.clPref}-bottom-descr`).forEach((v,i,a) => {\r\n\t\tcreateOnEditField(self, v, \"bd\");\r\n\t});\r\n\t/*self.domApi.diagram.querySelectorAll(`.${self.clPref}-line-text`).forEach((v,i,a) => {\r\n\t\tcreateOnEditField(self, v, \"ch\");\r\n\t});*/\r\n\tselectLoop(self);\r\n\tself.updateButtons();\r\n}\r\n\r\nfunction selectLoop(self) {\r\n\r\n\tself.domApi.diagram.el.querySelectorAll(`.${self.clPref}-part`).forEach((v) => {\r\n\t\tv.style.boxShadow = \"\";\r\n\t\tv.style.background = \"\";\r\n\t});\r\n\r\n\tself.domApi.diagram.el.querySelectorAll(`*`).forEach((v) => {\r\n\t\tv.style.boxShadow = \"\";\r\n\t\tv.style.background = \"\";\r\n\t});\r\n\r\n\tself.domApi.editPartTextField.el.value = \"\";\r\n\tself.domApi.editPartTextField.el.editedNode = null;\r\n\r\n\tself.domApi.editTdField.el.value = \"\";\r\n\tself.domApi.editTdField.el.editedNode = null;\r\n\r\n\tself.domApi.editBdField.el.value = \"\";\r\n\tself.domApi.editBdField.el.editedNode = null;\r\n\r\n\tconst {r, a, b} = self.editStage.selArgs;\r\n\tconst rootNode = self.editStage.tOb.getBySerial(r);\r\n\tif (rootNode) {\r\n\t\tconst \r\n\t\t\trootSN = rootNode.getSerial(),\r\n\t\t\trootPart = self.domApi.diagram.el.querySelector(`[data-serial-n=\"${rootSN}\"]`);\r\n\r\n\t\tif (rootNode && typeof rootNode.ch == \"string\") {\r\n\t\t\tself.domApi.editPartTextField.el.editedNode = rootNode;\r\n\t\t\tself.domApi.editPartTextField.el.value      = rootNode.ch;\r\n\t\t} else {}\r\n\r\n\t\tif (rootNode?.td) {\r\n\t\t\tself.domApi.editTdField.el.editedNode = rootNode;\r\n\t\t\tself.domApi.editTdField.el.value      = rootNode.td;\r\n\t\t} else {}\r\n\r\n\t\tif (rootNode?.bd) {\r\n\t\t\tself.domApi.editBdField.el.editedNode = rootNode;\r\n\t\t\tself.domApi.editBdField.el.value      = rootNode.bd;\r\n\t\t} else {}\r\n\r\n\r\n\t\tif (rootPart) {\r\n\t\t\trootPart.style.boxShadow = \"inset 0 0 5px #777, 0 0 5px #777\";\r\n\t\t}\r\n\r\n\t\tif (typeof rootNode.ch != \"string\") {\r\n\t\t\tconst selectedNodes = rootNode.ch.slice(a, b);\r\n\t\t\tfor (const node of selectedNodes) {\r\n\t\t\t\tconst part = self.domApi.diagram.el.querySelector(\r\n\t\t\t\t\t`[data-serial-n=\"${node.getSerial()}\"]`);\r\n\t\t\t\tpart.style.background = `\r\n\t\t\t\t\trepeating-linear-gradient(\r\n\t\t\t\t\t\t135deg, \r\n\t\t\t\t\t\trgba(126,126,126,.2) 0, \r\n\t\t\t\t\t\trgba(126,126,126,.2) 5px, \r\n\t\t\t\t\t\ttransparent          5px, \r\n\t\t\t\t\t\ttransparent          10px\r\n\t\t\t\t\t)\r\n\t\t\t\t`;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tself.updateButtons();\r\n}\r\n\r\nfunction createOnEditField(self, el, fieldName) {\r\n\tel.setAttribute(\"contenteditable\", \"true\");\r\n\tel.onfocus = function(ev) {\r\n\t\tthis.oldValue = this.textContent;\r\n\t}\r\n\tel.onblur = function(ev) {\r\n\t\tif (this.oldValue != this.textContent)\r\n\t\t\teditLoop.commit(self);\r\n\t}\r\n\tel.oninput = function(ev) {\r\n\t\tconst \r\n\t\t\tpart = lib.getPart(self, this),\r\n\t\t\tnode = self.editStage.tOb.getBySerial(part.dataset.serialN);\r\n\t\tnode[fieldName] = this.textContent;\r\n\t\tself.domApi.codeField.el.textContent = _stringify(self.editStage.tOb);\r\n\t}\r\n}\r\n\r\nfunction _getAppDom(self) {\r\n\tconst pr = self.clPref;\r\n\tconst dFragment = lib.eHTMLDF(`\r\n\t\t<div class=\"${pr}-edit-panel\" style=\"white-space: normal;\">\r\n\t\t\t<div class=\"${pr}-edit-panel__btn-block ${pr}-history-buttons\" style=\"float: left;\">\r\n\t\t\t\t<button class=\"${pr}-nav-undo\" >&nbsp;⤶ <span class=\"count\"></span></button>\r\n\t\t\t\t<button class=\"${pr}-nav-redo\" >&nbsp;<span class=\"count\"></span> ⤷</button>\r\n\t\t\t\t&nbsp;&nbsp;\r\n\t\t\t</div>\r\n\t\t\t<div class=\"${pr}-edit-panel__btn-block ${pr}-edit-buttons\" style=\"float: right;\">\r\n\t\t\t\t<button class=\"${pr}-edit-td\"        >td</button>\r\n\t\t\t\t<button class=\"${pr}-edit-bd\"        >bd</button>\r\n\t\t\t\t&nbsp;\r\n\t\t\t\t<button class=\"${pr}-edit-split\"     >split</button>\r\n\t\t\t\t<button class=\"${pr}-edit-join\"      >join</button>\r\n\t\t\t\t&nbsp;\r\n\t\t\t\t<button class=\"${pr}-edit-subdivide\" >subdivide</button>\r\n\t\t\t\t<button class=\"${pr}-edit-unwrap\"    >unwrap</button>\r\n\t\t\t\t&nbsp;\r\n\t\t\t\t<button class=\"${pr}-edit-wrap\"      >wrap</button>\r\n\t\t\t\t<button class=\"${pr}-edit-wrap-subdiv\">wrap/subdiv</button>\r\n\t\t\t</div>\r\n\t\t\t<div style=\"clear: both;\"></div>\r\n\t\t\t<br>\r\n\t\t\t<div>\r\n\t\t\t\t<fieldset style=\"display: inline-block; vertical-align: top;\">\r\n\t\t\t\t\t<legend> &nbsp;&nbsp; td &nbsp;&nbsp; </legend>\r\n\t\t\t\t\t<textarea class=\"${pr}-edit-td-field\" rows=\"1\" cols=\"30\"></textarea>\r\n\t\t\t\t</fieldset>\r\n\t\t\t\t<fieldset style=\"display: inline-block; vertical-align: top;\">\r\n\t\t\t\t\t<legend> &nbsp;&nbsp; bd &nbsp;&nbsp; </legend>\r\n\t\t\t\t\t<textarea class=\"${pr}-edit-bd-field\" rows=\"1\" cols=\"30\"></textarea>\r\n\t\t\t\t</fieldset>\r\n\t\t\t</div>\r\n\t\t\t<div>\r\n\t\t\t\t<input class=\"${pr}-edit-part-text-field\" \r\n\t\t\t\t\tstyle=\"\r\n\t\t\t\t\t\twidth: calc(100% - 6px); \r\n\t\t\t\t\t\ttext-align: center;\r\n\t\t\t\t\t\tfont-family: consolas, monospace;\r\n\t\t\t\t\t\">\r\n\t\t\t</div>\r\n\t\t\t<br>\r\n\t\t</div>\r\n\r\n\t\t<div class=\"${pr}-diagram\"></div>\r\n\r\n\t\t<div class=\"${pr}-code-edit-block\">\r\n\t\t\t<div class=\"${pr}-code-edit-panel\">\r\n\t\t\t\t<div style=\"float: left;\">\r\n\t\t\t\t\t<!-- <button class=\"${pr}-apply\">Apply</button>\r\n\t\t\t\t\t&nbsp; -->\r\n\t\t\t\t\t<button class=\"${pr}-discard\">Discard</button>\r\n\t\t\t\t\t<!-- <button class=\"${pr}-new-blank\">New Blank</button> -->\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style=\"float: right;\">\r\n\t\t\t\t\t<button class=\"${pr}-to-clipboard\">To Clipboard</button>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style=\"clear: both;\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div style=\"padding: 5px 100px;\">\r\n\t\t\t\t<pre class=\"${pr}-code-field\" contenteditable=\"true\"></pre>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t`);\r\n\r\n\tconst domApi = {\r\n\t\tnavUndo             : {\r\n\t\t\tel: dFragment.querySelector(`.${pr}-nav-undo`            ),\r\n\t\t\tonclick: function(ev) {\r\n\t\t\t\tconst {editStage, history} = self;\r\n\t\t\t\tif (history[history.i - 1]) {\r\n\t\t\t\t\teditStage.tOb = history[-- history.i].clone;\r\n\t\t\t\t\tself.updateButtons();\r\n\t\t\t\t\teditLoop(self);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tupdateBtn: function() {\r\n\t\t\t\tconst hist = self.history;\r\n\t\t\t\tthis.el.disabled = (hist.i <= 0);\r\n\t\t\t\tthis.el.querySelector(`.count`).textContent = hist.i;\r\n\t\t\t},\r\n\t\t},\r\n\t\tnavRedo             : {\r\n\t\t\tel: dFragment.querySelector(`.${pr}-nav-redo`            ),\r\n\t\t\tonclick: function(ev) {\r\n\t\t\t\tconst {editStage, history} = self;\r\n\t\t\t\tif (history[history.i + 1]) {\r\n\t\t\t\t\teditStage.tOb = history[++ history.i].clone;\r\n\t\t\t\t\tself.updateButtons();\r\n\t\t\t\t\teditLoop(self);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tupdateBtn: function() {\r\n\t\t\t\tconst hist = self.history;\r\n\t\t\t\tthis.el.disabled = (hist.i == hist.length - 1);\r\n\t\t\t\tthis.el.querySelector(`.count`).textContent = \r\n\t\t\t\t\thist.length - 1 - hist.i;\r\n\t\t\t},\r\n\t\t},\r\n\t\teditTd              : {\r\n\t\t\tel: dFragment.querySelector(`.${pr}-edit-td`             ),\r\n\t\t\tonclick: function(ev) {\r\n\t\t\t\tconst \r\n\t\t\t\t\t{r, a, b} = self.editStage.selArgs,\r\n\t\t\t\t\trootNode = self.editStage.tOb.getBySerial(r);\r\n\t\t\t\trootNode.td ? delete rootNode.td : rootNode.td = \"X\";\r\n\t\t\t\teditLoop.commit(self);\r\n\t\t\t},\r\n\t\t\tupdateBtn: function() {\r\n\t\t\t\tconst \r\n\t\t\t\t\t{r, a, b} = self.editStage.selArgs,\r\n\t\t\t\t\trootNode = self.editStage.tOb.getBySerial(r);\r\n\t\t\t\tthis.el.disabled = !rootNode;\r\n\t\t\t},\r\n\t\t},\r\n\t\teditBd              : {\r\n\t\t\tel: dFragment.querySelector(`.${pr}-edit-bd`             ),\r\n\t\t\tonclick: function(ev) {\r\n\t\t\t\tconst \r\n\t\t\t\t\t{r, a, b} = self.editStage.selArgs,\r\n\t\t\t\t\trootNode = self.editStage.tOb.getBySerial(r);\r\n\t\t\t\trootNode.bd ? delete rootNode.bd : rootNode.bd = \"X\";\r\n\t\t\t\teditLoop.commit(self);\r\n\t\t\t},\r\n\t\t\tupdateBtn: function() {\r\n\t\t\t\tconst \r\n\t\t\t\t\t{r, a, b} = self.editStage.selArgs,\r\n\t\t\t\t\trootNode = self.editStage.tOb.getBySerial(r);\r\n\t\t\t\tthis.el.disabled = !(rootNode && typeof rootNode.ch == \"string\");\r\n\t\t\t},\r\n\t\t},\r\n\t\teditSplit           : {\r\n\t\t\tel: dFragment.querySelector(`.${pr}-edit-split`          ),\r\n\t\t\tonclick: function(ev) {\r\n\t\t\t\tconst \r\n\t\t\t\t\t{r, a, b} = self.editStage.selArgs,\r\n\t\t\t\t\trootNode = self.editStage.tOb.getBySerial(r);\r\n\t\t\t\trootNode.split(a, b)();\r\n\t\t\t\teditLoop.commit(self);\r\n\t\t\t},\r\n\t\t\tupdateBtn: function() {\r\n\t\t\t\tconst \r\n\t\t\t\t\t{r, a, b} = self.editStage.selArgs,\r\n\t\t\t\t\trootNode = self.editStage.tOb.getBySerial(r);\r\n\t\t\t\tthis.el.disabled = !rootNode?.split(a, b);\r\n\t\t\t},\r\n\t\t},\r\n\t\teditJoin            : {\r\n\t\t\tel: dFragment.querySelector(`.${pr}-edit-join`           ),\r\n\t\t\tonclick: function(ev) {\r\n\t\t\t\tconst \r\n\t\t\t\t\t{r, a, b} = self.editStage.selArgs,\r\n\t\t\t\t\trootNode = self.editStage.tOb.getBySerial(r);\r\n\t\t\t\trootNode.join(a, b)();\r\n\t\t\t\teditLoop.commit(self);\r\n\t\t\t},\r\n\t\t\tupdateBtn: function() {\r\n\t\t\t\tconst \r\n\t\t\t\t\t{r, a, b} = self.editStage.selArgs,\r\n\t\t\t\t\trootNode = self.editStage.tOb.getBySerial(r);\r\n\t\t\t\tthis.el.disabled = !rootNode?.join(a, b);\r\n\t\t\t},\r\n\t\t},\r\n\t\teditSubdivide            : {\r\n\t\t\tel: dFragment.querySelector(`.${pr}-edit-subdivide`      ),\r\n\t\t\tonclick: function(ev) {\r\n\t\t\t\tconst \r\n\t\t\t\t\t{r, a, b} = self.editStage.selArgs,\r\n\t\t\t\t\trootNode = self.editStage.tOb.getBySerial(r);\r\n\t\t\t\trootNode.subdivide(a, b)();\r\n\t\t\t\teditLoop.commit(self);\r\n\t\t\t},\r\n\t\t\tupdateBtn: function() {\r\n\t\t\t\tconst \r\n\t\t\t\t\t{r, a, b} = self.editStage.selArgs,\r\n\t\t\t\t\trootNode = self.editStage.tOb.getBySerial(r);\r\n\t\t\t\tthis.el.disabled = !rootNode?.subdivide(a, b);\r\n\t\t\t},\r\n\t\t},\r\n\t\teditWrap            : {\r\n\t\t\tel: dFragment.querySelector(`.${pr}-edit-wrap`           ),\r\n\t\t\tonclick: function(ev) {\r\n\t\t\t\tconst \r\n\t\t\t\t\t{r, a, b} = self.editStage.selArgs,\r\n\t\t\t\t\trootNode = self.editStage.tOb.getBySerial(r);\r\n\t\t\t\trootNode.wrap(a, b)();\r\n\t\t\t\teditLoop.commit(self);\r\n\t\t\t},\r\n\t\t\tupdateBtn: function() {\r\n\t\t\t\tconst \r\n\t\t\t\t\t{r, a, b} = self.editStage.selArgs,\r\n\t\t\t\t\trootNode = self.editStage.tOb.getBySerial(r);\r\n\t\t\t\tthis.el.disabled = !rootNode?.wrap(a, b);\r\n\t\t\t},\r\n\t\t},\r\n\t\teditWrapSubdiv            : {\r\n\t\t\tel: dFragment.querySelector(`.${pr}-edit-wrap-subdiv`           ),\r\n\t\t\tonclick: function(ev) {\r\n\t\t\t\tconst \r\n\t\t\t\t\t{r, a, b} = self.editStage.selArgs,\r\n\t\t\t\t\trootNode = self.editStage.tOb.getBySerial(r);\r\n\t\t\t\trootNode.wrapSubdiv(a, b)();\r\n\t\t\t\teditLoop.commit(self);\r\n\t\t\t},\r\n\t\t\tupdateBtn: function() {\r\n\t\t\t\tconst \r\n\t\t\t\t\t{r, a, b} = self.editStage.selArgs,\r\n\t\t\t\t\trootNode = self.editStage.tOb.getBySerial(r);\r\n\t\t\t\tthis.el.disabled = !rootNode?.wrapSubdiv(a, b);\r\n\t\t\t},\r\n\t\t},\r\n\t\teditUnwrap          : {\r\n\t\t\tel: dFragment.querySelector(`.${pr}-edit-unwrap`         ),\r\n\t\t\tonclick: function(ev) {\r\n\t\t\t\tconst \r\n\t\t\t\t\t{r, a, b} = self.editStage.selArgs,\r\n\t\t\t\t\trootNode = self.editStage.tOb.getBySerial(r);\r\n\t\t\t\trootNode.unwrap(a, b)();\r\n\t\t\t\teditLoop.commit(self);\r\n\t\t\t},\r\n\t\t\tupdateBtn: function() {\r\n\t\t\t\tconst \r\n\t\t\t\t\t{r, a, b} = self.editStage.selArgs,\r\n\t\t\t\t\trootNode = self.editStage.tOb.getBySerial(r);\r\n\t\t\t\tthis.el.disabled = !rootNode?.unwrap(a, b);\r\n\t\t\t},\r\n\t\t},\r\n\t\teditTdField   : {\r\n\t\t\tel: dFragment.querySelector(`.${pr}-edit-td-field`),\r\n\t\t\tonfocus: function(ev) {\r\n\t\t\t\tthis.tsartValue = this.value;\r\n\t\t\t},\r\n\t\t\toninput: function(ev) {\r\n\t\t\t\tconst node = this.editedNode;\r\n\t\t\t\tthis.editedNode.td = this.value;\r\n\t\t\t\tself.domApi.codeField.el.textContent = _stringify(self.editStage.tOb);\r\n\t\t\t},\r\n\t\t\tonblur: function(ev) {\r\n\t\t\t\tif (this.tsartValue != this.value)\r\n\t\t\t\t\teditLoop.commit(self);\r\n\t\t\t},\r\n\t\t},\r\n\t\teditPartTextField   : {\r\n\t\t\tel: dFragment.querySelector(`.${pr}-edit-part-text-field`),\r\n\t\t\tonfocus: function(ev) {\r\n\t\t\t\tthis.tsartValue = this.value;\r\n\t\t\t},\r\n\t\t\toninput: function(ev) {\r\n\t\t\t\tconst node = this.editedNode;\r\n\t\t\t\tif (typeof this.editedNode?.ch != \"string\")\r\n\t\t\t\t\tthrow new Error();\r\n\t\t\t\tthis.editedNode.ch = this.value;\r\n\t\t\t\tself.domApi.codeField.el.textContent = _stringify(self.editStage.tOb);\r\n\t\t\t},\r\n\t\t\tonblur: function(ev) {\r\n\t\t\t\tif (this.tsartValue != this.value)\r\n\t\t\t\t\teditLoop.commit(self);\r\n\t\t\t},\r\n\t\t},\r\n\t\teditBdField   : {\r\n\t\t\tel: dFragment.querySelector(`.${pr}-edit-bd-field`),\r\n\t\t\tonfocus: function(ev) {\r\n\t\t\t\tthis.tsartValue = this.value;\r\n\t\t\t},\r\n\t\t\toninput: function(ev) {\r\n\t\t\t\tconst node = this.editedNode;\r\n\t\t\t\tthis.editedNode.bd = this.value;\r\n\t\t\t\tself.domApi.codeField.el.textContent = _stringify(self.editStage.tOb);\r\n\t\t\t},\r\n\t\t\tonblur: function(ev) {\r\n\t\t\t\tif (this.tsartValue != this.value)\r\n\t\t\t\t\teditLoop.commit(self);\r\n\t\t\t},\r\n\t\t},\r\n\t\tdiagram             : {\r\n\t\t\tel: dFragment.querySelector(`.${pr}-diagram`             ),\r\n\t\t},\r\n\t\tdiscard             : {\r\n\t\t\t// Не работает из-за того, что при потере фокуса на <pre> происходит коммит. \r\n\t\t\t// А тогда уже делать discard нет смысла.\r\n\t\t\tel: dFragment.querySelector(`.${pr}-discard`             ),\r\n\t\t\tonclick: function(ev) {\r\n\t\t\t\tconst codeField = self.domApi.codeField;\r\n\t\t\t\t// codeField.el.focus();\r\n\t\t\t\tcodeField.el.textContent = codeField.el.oldValue = _stringify(self.editStage.tOb);\r\n\t\t\t\teditLoop(self);\r\n\t\t\t},\r\n\t\t\tupdateBtn: function() {},\r\n\t\t},\r\n\t\ttoClipboard         : {\r\n\t\t\tel: dFragment.querySelector(`.${pr}-to-clipboard`        ),\r\n\t\t\tonclick: function(ev) {\r\n\t\t\t\tconst str = self.domApi.codeField.el.textContent;\r\n\r\n\t\t\t\tconst tA = document.createElement(\"textarea\");\r\n\t\t\t\ttA.value = str;\r\n\t\t\t\tdocument.body.appendChild(tA);\r\n\t\t\t\ttA.select();\r\n\t\t\t\tdocument.execCommand(\"copy\");\r\n\t\t\t\tdocument.body.removeChild(tA);\r\n\t\t\t},\r\n\t\t\tupdateBtn: function() {},\r\n\t\t},\r\n\t\tcodeField           : {\r\n\t\t\tel: dFragment.querySelector(`.${pr}-code-field`          ),\r\n\t\t\tonfocus: function(ev) {\r\n\t\t\t\tthis.oldValue = this.textContent;\r\n\t\t\t},\r\n\t\t\tonblur : function(ev) {\r\n\t\t\t\tif (this.oldValue != this.textContent) {\r\n\t\t\t\t\tconst {object, error, text} = \r\n\t\t\t\t\t\tlib.tryParseJSON(self.domApi.codeField.el.textContent);\r\n\t\t\t\t\t// editLoop.commit(self);\r\n\t\t\t\t\tif (object) {\r\n\t\t\t\t\t\tself.editStage.tOb = object.clone;\r\n\t\t\t\t\t\teditLoop.commit(self);\r\n\t\t\t\t\t} else if (error) {\r\n\t\t\t\t\t\tconst \r\n\t\t\t\t\t\t\thl = new JsonEHl(\"e-s-json-err-hl\"),\r\n\t\t\t\t\t\t\tcodeField = hl.getHighlighted(text);\r\n\t\t\t\t\t\tself.domApi.diagram.el.innerHTML = \"\";\r\n\t\t\t\t\t\tself.domApi.diagram.el.appendChild(codeField);\r\n\t\t\t\t\t\thl.scrollToFirstError(codeField);\r\n\t\t\t\t\t\tconsole.error(`(!) \\n`, self.domApi.diagram.el, \"\\n\", error);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t},\r\n\t};\r\n\r\n\tfor (const i in domApi) {\r\n\t\tconst \r\n\t\t\tapi = domApi[i],\r\n\t\t\tel  = api.el;\r\n\t\tel.api = api;\r\n\t\tel.onclick = api.onclick;\r\n\t\tel.oninput = api.oninput;\r\n\t\tel.onfocus = api.onfocus;\r\n\t\tel.onblur  = api.onblur ;\r\n\t}\r\n\r\n\treturn [dFragment, domApi, updateButtons];\r\n\r\n\tfunction updateButtons() {\r\n\t\tfor (const i in domApi) \r\n\t\t\tif (domApi[i].updateBtn)\r\n\t\t\t\tdomApi[i].updateBtn();\r\n\t}\r\n}\r\n\r\nfunction _stringify(tOb) {\r\n\treturn JSON.stringify(tOb, null, 4);\r\n}","export default function getSelArgs(clPref, tOb) {\r\n\tconst \r\n\t\tsel = window.getSelection();\r\n\tif (sel.rangeCount) {\r\n\t\tconst\r\n\t\t\trangeA = sel.getRangeAt(0),\r\n\t\t\trangeB = sel.getRangeAt(sel.rangeCount - 1),\r\n\t\t\t{\r\n\t\t\t\tcommonAncestorContainer :rootEl ,\r\n\t\t\t\tstartContainer          :startEl,\r\n\t\t\t} = rangeA,\r\n\t\t\t{\r\n\t\t\t\tendContainer            :endEl  ,\r\n\t\t\t} = rangeB;\r\n\r\n\t\tconst \r\n\t\t\trootPart = getPart(clPref, rootEl),\r\n\t\t\trootNode = rootPart ? tOb.getBySerial(rootPart.dataset.serialN) : null,\r\n\t\t\tr        = parseInt(rootPart?.dataset.serialN || null);\r\n\r\n\t\tif (rootPart) {\r\n\t\t\tlet a, b, aEl, bEl;\r\n\r\n\t\t\tif (startEl == endEl) {\r\n\t\t\t\ta = rangeA.startOffset;\r\n\t\t\t\tb = rangeB.endOffset;\r\n\t\t\t} else {\r\n\t\t\t\taEl = (function () {\r\n\t\t\t\t\tlet el = startEl;\r\n\t\t\t\t\tdo {\r\n\t\t\t\t\t\tif (el.parentElement == rootPart)\r\n\t\t\t\t\t\t\treturn el;\r\n\t\t\t\t\t} while (el = el.parentElement);\r\n\t\t\t\t})();\r\n\t\t\t\tbEl = (function () {\r\n\t\t\t\t\tlet el = endEl;\r\n\t\t\t\t\tdo {\r\n\t\t\t\t\t\tif (el.parentElement == rootPart)\r\n\t\t\t\t\t\t\treturn el;\r\n\t\t\t\t\t} while (el = el.parentElement);\r\n\t\t\t\t})();\r\n\r\n\t\t\t\ta = parseInt(aEl.dataset.partChIndex);\r\n\t\t\t\tb = parseInt(bEl.dataset.partChIndex) + 1;\r\n\t\t\t}\r\n\r\n\t\t\t/*let n = 0;\r\n\t\t\tconsole.groupCollapsed(\"defineSelArgs\");\r\n\t\t\tconsole.log(\"\");\r\n\t\t\tconsole.log(++ n, \"rangeA\"  , rangeA  );\r\n\t\t\tconsole.log(++ n, \"rangeB\"  , rangeB  );\r\n\t\t\tconsole.log(++ n, \"rootPart\", rootPart);\r\n\t\t\tconsole.log(++ n, \"rootNode\", rootNode);\r\n\t\t\tconsole.log(++ n, \"aEl\"     , aEl     );\r\n\t\t\tconsole.log(++ n, \"a\"       , a       );\r\n\t\t\tconsole.log(++ n, \"bEl\"     , bEl     );\r\n\t\t\tconsole.log(++ n, \"b\"       , b       );\r\n\t\t\tconsole.groupEnd();*/\r\n\r\n\t\t\treturn {r, a, b};\r\n\t\t}\r\n\t}\r\n\r\n\treturn {};\r\n}\r\n\r\n\r\nfunction getPart(clPref, el) {\r\n\treturn recur(el);\r\n\tfunction recur(el) {\r\n\t\tif (isPart(clPref, el)) \r\n\t\t\treturn el;\r\n\t\tif (el.parentElement)\r\n\t\t\treturn recur(el.parentElement);\r\n\t}\r\n}\r\n\r\nfunction isPart(clPref, el) {\r\n\treturn el.classList?.contains(`${clPref}-part`);\r\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(0);\n",""],"names":[],"sourceRoot":""}