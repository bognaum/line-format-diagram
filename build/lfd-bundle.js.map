{"version":3,"sources":["webpack://LineFormatDiagram/./wp-enter-point.js","webpack://LineFormatDiagram/./lfd.js","webpack://LineFormatDiagram/./lib.js","webpack://LineFormatDiagram/./NodeClass.js","webpack://LineFormatDiagram/./json-err-hl/json-err-hl.js","webpack://LineFormatDiagram/./json-err-hl/set-style.js","webpack://LineFormatDiagram/./json-err-hl/syntax-highlight-framework/syntax-hl-fk.js","webpack://LineFormatDiagram/./json-err-hl/syntax-highlight-framework/describeAPI.js","webpack://LineFormatDiagram/./json-err-hl/syntax-highlight-framework/Highlighter.js","webpack://LineFormatDiagram/./json-err-hl/syntax-highlight-framework/ParseContext.js","webpack://LineFormatDiagram/./json-err-hl/syntax-highlight-framework/ModelNode.js","webpack://LineFormatDiagram/./set-style.js","webpack://LineFormatDiagram/./buildDiagram.js","webpack://LineFormatDiagram/./DiagramEditor.js","webpack://LineFormatDiagram/./selection-event.js","webpack://LineFormatDiagram/webpack/bootstrap","webpack://LineFormatDiagram/webpack/runtime/define property getters","webpack://LineFormatDiagram/webpack/runtime/hasOwnProperty shorthand","webpack://LineFormatDiagram/webpack/runtime/make namespace object","webpack://LineFormatDiagram/webpack/startup"],"names":[],"mappings":";;;;;;AAAA,YAAY,8BAA2B;;AAEvC,qB;;;;;;;;;;;;;;;;ACFqC;AACoB;AACd;AACG;AACC;;AAE/C;;AAEe;AACf;AACA;AACA,EAAE,sDAAQ;AACV;;AAEA,+BAA+B,0CAA0C;AACzE,+BAA+B,0CAA0C;AACzE,+BAA+B,0CAA0C;AACzE,+BAA+B,0CAA0C;;AAEzE,wBAAwB;AACxB,wBAAwB;AACxB;;AAEA;AACA;AACA,QAAQ,8BAA8B,GAAG,iDAAgB;AACzD;AACA,MAAM,sDAAa;AACnB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,gEAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA,cAAc,0CAAS;AACvB;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AAKA,QAAQ,8BAA8B,GAAG,iDAAgB;;AAEzD;;AAEA,EAAE,yDAAY;AACd;;AAEA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA,YAAY,gEAAO;AACnB;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;;;;;;;;;;;;;;;;;ACjHkC;;AAQhC;;;AAGF;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,UAAU;AACV,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,oBAAoB,kDAAI;AACxB;AACA;AACA;AACA,GAAG;AACH;AACA,EAAE;;AAEF;AACA,aAAa,kDAAI,EAAE,OAAO;AAC1B;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,C;;;;;;;;;;;AC9Ee;AACf;AACA;AACA;;AAEA,sBAAsB;AACtB,sBAAsB;AACtB,sBAAsB;AACtB,sBAAsB;;AAEtB,sBAAsB;AACtB,sBAAsB;;AAEtB,sBAAsB;AACtB,sBAAsB;AACtB,sBAAsB;AACtB,iBAAiB,yBAAyB;AAC1C,iBAAiB,yBAAyB;AAC1C;;AAEA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA,CAAC;AACD;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,CAAC;;AAED;AACA;AACA;;AAEA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,4BAA4B;AAC5B;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,C;;;;;;;;;;;;;ACvQsC;AACgC;;AAEtE;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,GAAG,4FAAsB;;AAE1B;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,EAAE;AACF;AACA,mBAAmB;AACnB;AACA;AACA,eAAe;AACf;AACA;AACA;AACA;AACA;AACA;AACA,gBAAgB,0CAA0C;AAC1D;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA,GAAG;AACH;;AAEe,2BAA2B,4FAAsB;AAChE;AACA;AACA,EAAE,sDAAQ;AACV;;AAEA,iBAAiB,gBAAgB;;AAEjC;AACA;AACA;AACA;AACA;;;;;;;;;;;;ACvHe;;AAEf;AACA;AACA,0BAA0B;AAC1B;AACA,iBAAiB;AACjB;AACA,mBAAmB;AACnB;AACA,mBAAmB;AACnB;AACA,mBAAmB;AACnB;AACA,mBAAmB;AACnB;AACA,mBAAmB;AACnB;AACA,mBAAmB;AACnB;AACA,mBAAmB;;AAEnB;AACA,0BAA0B;;AAE1B;AACA,eAAe;AACf;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB;AACA,iBAAiB;;AAEjB;AACA,0BAA0B;AAC1B;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB;AACA,iBAAiB;AACjB;AACA,iBAAiB;;AAEjB;AACA,eAAe;;AAEf;AACA,eAAe;;AAEf;AACA,eAAe;;AAEf;AACA,eAAe;;AAEf;AACA,eAAe;;AAEf;AACA,eAAe;;AAEf;AACA,eAAe;;AAEf;;AAEA,2BAA2B,OAAO;;AAElC;AACA,qCAAqC,eAAe;AACpD;AACA;;AAEA;AACA,uCAAuC,eAAe;AACtD;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,C;;;;;;;;;;;;;ACzG2C;AACA;;AAE3C,iEAAe;AACf;AACA,YAAY;AACZ,YAAY;AACZ,CAAC,E;;;;;;;;;;;ACPD,iEAAgB;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC,EAAC;;AAEF;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA,EAAE;AACF;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA,EAAE;AACF;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA,2D;AACA;AACA;;AAEA;AACA;AACA;AACA,gDAAgD,UAAU;AAC1D;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF,iDAAiD,OAAO,IAAI,UAAU;AACtE;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,2DAA2D,MAAM;AACjE,oDAAoD,KAAK,gBAAgB,MAAM;AAC/E,EAAE;AACF;AACA,C;;;;;;;;;;;;ACjS6C;;AAE9B;;AAEf;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,iCAAiC,6CAA6C;AAC9E,iCAAiC,6CAA6C;AAC9E,iCAAiC,6CAA6C;AAC9E,iCAAiC,6CAA6C;AAC9E,iCAAiC,6CAA6C;AAC9E;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA,mBAAmB,qDAAY;AAC/B;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;;AAEA;AACA;AACA;;AAEA,GAAG;AACH;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,iEAAiE,GAAG;AACpE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,oCAAoC,gBAAgB;AACpD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,cAAc,OAAO,KAAK,MAAM;AAChC;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,4BAA4B,kBAAkB,GAAG,kBAAkB;AACnE;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,oBAAoB,YAAY;AAChC,qBAAqB,YAAY,mCAAmC,IAAI;AACxE,qBAAqB,YAAY;AACjC,qBAAqB,YAAY;AACjC;AACA;AACA;AACA,kBAAkB,6BAA6B;AAC/C,kBAAkB,6BAA6B;AAC/C,kBAAkB,6BAA6B;AAC/C,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ,uBAAuB;AACvB;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qCAAqC;AACrC;AACA;AACA,iDAAiD;AACjD;AACA,yBAAyB;AACzB;AACA,4BAA4B;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,4BAA4B;AAC5B;AACA,6CAA6C;AAC7C;AACA;AACA,+BAA+B;AAC/B;AACA,0BAA0B;AAC1B;AACA;AACA;AACA,+BAA+B;AAC/B;AACA;AACA;AACA,yCAAyC;AACzC;AACA;AACA,6BAA6B;;AAE7B;;AAEA,2BAA2B,YAAY;;AAEvC;AACA,qCAAqC,eAAe;AACpD;AACA;;AAEA;AACA,2CAA2C,eAAe;AAC1D;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,C;;;;;;;;;;;;ACjT0C;;AAE3B;AACf;AACA;AACA,YAAY,eAAe;AAC3B,YAAY,gBAAgB;AAC5B,YAAY,iBAAiB;AAC7B,aAAa,kBAAkB;AAC/B,UAAU,mBAAmB,cAAc;AAC3C,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS,aAAa;;AAEtB;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,SAAS,aAAa;;AAEtB;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA,IAAI,6BAA6B;AACjC,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,sBAAsB;AAC1B;AACA,YAAY,kDAAS;AACrB,UAAU;AACV;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA,UAAU;AACV;AACA;;;;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,EAAE;AACF;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,C;;;;;;;;;;;AClIe;AACf;AACA;AACA,UAAU,YAAY;AACtB,UAAU,UAAU;AACpB,GAAG;AACH;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,C;;;;;;;;;;;ACtBe;;AAEf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA,IAAI;AACJ;;AAEA;;AAEA;;AAEA;;AAEA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA,0BAA0B;AAC1B;AACA;AACA,sBAAsB;AACtB;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,0BAA0B;AAC1B;AACA;AACA;AACA;AACA;AACA;AACA,uBAAuB;AACvB;AACA;AACA;AACA;AACA,wCAAwC;AACxC;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C;AAC7C;AACA;AACA;AACA;AACA;AACA,+BAA+B;AAC/B;AACA,yBAAyB;AACzB;AACA,2BAA2B;AAC3B;AACA,wBAAwB;AACxB;AACA;AACA;AACA,qBAAqB;;AAErB;AACA;AACA,sCAAsC;;AAEtC;AACA;AACA,4BAA4B;AAC5B;AACA,mBAAmB;;AAEnB;AACA;AACA,yCAAyC;;AAEzC;AACA;AACA;AACA,0BAA0B;AAC1B;AACA,mBAAmB;;AAEnB;;AAEA,2BAA2B,OAAO;;AAElC;AACA,qCAAqC,eAAe;AACpD;AACA;;AAEA;AACA,uCAAuC,eAAe;AACtD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,C;;;;;;;;;;;;;AChJgC;AACoB;;AAErC;AACf;AACA;AACA;AACA;AACA;AACA,EAAE;;AAEF,mDAAmD,cAAc;;AAEjE,QAAQ,iBAAiB;AACzB;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA,SAAS;;AAET;AACA;;AAE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ACA,cAAc;AACd;AACA;AACA,cAAc;AACd;AACA,MAAM;AACN;AACA;AACA;AACA;AACA,GAAG,oBAAoB,GAAG;AAC1B,UAAU,oBAAoB;AAC9B,IAAI,iDAAgB;AACpB;AACA;AACA;AACA,IAAI;AACJ;AACA,cAAc,gEAAO;AACrB;AACA;AACA;AACA;AACA;;AAEA;AACA,GAAG,oBAAoB,GAAG;AAC1B;AACA,GAAG,oBAAoB,GAAG;AAC1B;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;;AAGA;AACA;AACA,C;;;;;;;;;;;;ACvOoC;;AAErB;AACf;AACA;;AAEA;AACA,EAAE;AACF;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA,EAAE;AACF;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ,GAAG;AACH;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ,GAAG;;AAEH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,mCAAmC,YAAY;AAC/C;AACA,EAAE;AACF;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ,mCAAmC,2BAA2B;AAC9D,oCAAoC,8BAA8B;AAClE;AACA;AACA,IAAI;AACJ,gCAAgC,uCAAuC;AACvE,iBAAiB,mCAAmC,YAAY,QAAQ,EAAE;AAC1E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI;AACJ;AACA;AACA;AACA;AACA,mBAAmB,SAAS;AAC5B;AACA;AACA,IAAI;AACJ;AACA;AACA,C;;;;;UC3IA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA,wCAAwC,yCAAyC;WACjF;WACA;WACA,E;;;;;WCPA,wF;;;;;WCAA;WACA;WACA;WACA,sDAAsD,kBAAkB;WACxE;WACA,+CAA+C,cAAc;WAC7D,E;;;;;UCNA;UACA;UACA;UACA","file":"lfd-bundle.js","sourcesContent":["const LFD = require(\"./lfd.js\").default;\r\n\r\nmodule.exports = LFD;","import * as lib      from \"./lib.js\";\r\nimport JsonEHl       from \"./json-err-hl/json-err-hl.js\";\r\nimport setStyle      from \"./set-style.js\";\r\nimport buildDiagram  from \"./buildDiagram.js\";\r\nimport DiagramEditor from \"./DiagramEditor.js\";\r\n\r\nconst version = \"6.0.2\";\r\n\r\nexport default class LineFormatDiagram {\r\n\tconstructor (clPref=\"line-format-diagram\") {\r\n\t\tthis.clPref = clPref;\r\n\t\tsetStyle(clPref);\r\n\t}\r\n\r\n\tbuild              (...args) { return build             (this, ...args); }\r\n\tbuildByTextContent (...args) { return buildByTextContent(this, ...args); }\r\n\tgetBuilded         (...args) { return getBuilded        (this, ...args); }\r\n\tedit               (...args) { return edit              (this, ...args); }\r\n\r\n\tget        version () {return version;}\r\n\tstatic get version () {return version;}\r\n}\r\n\r\nfunction edit(self, elem) {\r\n\tconst template = elem.textContent;\r\n\tconst {object :tOb, error :jsonError} = lib.tryParseJSON(template);\r\n\tif (tOb)\r\n\t\tnew DiagramEditor(self.clPref, elem, tOb);\r\n\t\t// return editDiagram(self, elem, tOb);\r\n\telse if (jsonError) {\r\n\t\telem.classList.remove(\"executing\", \"executed\", \"exec-error\");\r\n\t\telem.classList.add(\"exec-error\");\r\n\t\tconst \r\n\t\t\tfirstLN = parseInt(elem.dataset.lineNum) || 1,\r\n\t\t\tjson = template,\r\n\t\t\thl = new JsonEHl(\"e-s-json-err-hl\"),\r\n\t\t\tcodeField = hl.getHighlighted(template, firstLN);\r\n\t\telem.innerHTML = \"\";\r\n\t\telem.appendChild(codeField);\r\n\t\thl.scrollToFirstError(codeField);\r\n\t\tconsole.error(`(!) \\n`, elem, \"\\n\", jsonError);\r\n\t\treturn;\r\n\t} else {\r\n\t\tthrow new Error();\r\n\t}\r\n}\r\n\r\nfunction getBuilded(self, templ) {\r\n\tconst elem = lib.eHTML(`<pre class=\"\"><pre>`);\r\n\treturn build(self, elem, templ);\r\n}\r\n\r\nfunction buildByTextContent(self, elem) {\r\n\treturn build(self, elem, elem.textContent);\r\n}\r\n\r\nfunction build (self, elem, template) {\r\n\tif (! (elem instanceof HTMLElement))\r\n\t\tthrow new Error([\r\n\t\t\t\"(!) build(). Argument #1 must be a HTMLElement.\",\r\n\t\t\t\"\",\r\n\t\t\telem + \" given.\",\r\n\t\t\t\"\"\r\n\t\t].join(\"\\n\"));\r\n\r\n\tif ([\"executing\", \"executed\", \"exec-error\"].some((v) => elem.classList.contains(v)))\r\n\t\tthrow new Error([\r\n\t\t\t\"(!) Line format diagram. Already handled.\", \r\n\t\t\t\"\",\r\n\t\t\telem\r\n\t\t].join(\"\\n\"));\r\n\r\n\telem.dataset.fileTreeDiagramVersion = version;\r\n\t// elem.classList.add(self.clPref);\r\n\telem.classList.add(\"executing\");\r\n\r\n\tif (typeof template != \"string\")\r\n\t\tthrow new Error([\r\n\t\t\t\"(!) build(). Argument #2 must be a string.\",\r\n\t\t\t\"\",\r\n\t\t\ttemplate + \" given.\",\r\n\t\t\t\"\"\r\n\t\t].join(\"\\n\"));\r\n\r\n\r\n\t\r\n\r\n\tconst {object :tOb, error :jsonError} = lib.tryParseJSON(template);\r\n\r\n\tif (tOb) {\r\n\r\n\t\tbuildDiagram(self, elem, tOb);\r\n\t\telem.dataset.eSchemeVersion = self.version;\r\n\r\n\t\telem.classList.remove(\"executing\", \"executed\", \"exec-error\");\r\n\t\telem.classList.add(\"executed\");\r\n\t} else if (jsonError) {\r\n\t\telem.classList.remove(\"executing\", \"executed\", \"exec-error\");\r\n\t\telem.classList.add(\"exec-error\");\r\n\t\tconst \r\n\t\t\tfirstLN = parseInt(elem.dataset.lineNum) || 1,\r\n\t\t\tjson = template,\r\n\t\t\thl = new JsonEHl(\"e-s-json-err-hl\"),\r\n\t\t\tcodeField = hl.getHighlighted(template, firstLN);\r\n\t\telem.innerHTML = \"\";\r\n\t\telem.appendChild(codeField);\r\n\t\thl.scrollToFirstError(codeField);\r\n\t\tconsole.error(`(!) \\n`, elem, \"\\n\", jsonError);\r\n\t\treturn;\r\n\t} else {\r\n\t\tthrow new Error();\r\n\t}\r\n\treturn tOb;\r\n}\r\n","import Node from \"./NodeClass.js\";\r\n\r\nexport {\r\n\tforEachRecur,\r\n\ttryParseJSON,\r\n\tfromJson,\r\n\teHTML,\r\n\teHTMLDF,\r\n};\r\n\r\n\r\nfunction setStatusMark(el, className) {\r\n\tconst classes = [\"executing\", \"executed\", \"exec-error\"];\r\n\tif (classes.includes(className)) {\r\n\t\tel.classList.remove(...classes);\r\n\t\tel.classList.add(className);\r\n\t} else {\r\n\t\tthrow new Error(\"Invalid className of diagram status: \"+slassName);\r\n\t}\r\n}\r\n\r\n\r\nfunction forEachRecur(preCb, ob, postCb) {\r\n\tif (ob instanceof Array) \r\n\t\tfor (let v of ob)\r\n\t\t\t\tforEachRecur(preCb, v, postCb);\r\n\telse if (typeof ob == \"object\") {\r\n\t\tif (preCb)\r\n\t\t\tpreCb(ob);\r\n\t\tforEachRecur(preCb, ob.ch, postCb);\r\n\t\tif (postCb)\r\n\t\t\tpostCb(ob);\r\n\t}\r\n}\r\n\r\nfunction tryParseJSON (json) {\r\n\ttry {\r\n\t\tconst object = fromJson(json)\r\n\t\treturn {object};\r\n\t} catch (err) {\r\n\t\treturn {\r\n\t\t\ttext: json,\r\n\t\t\terror: err,\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction fromJson(json) {\r\n\tconst ob =  JSON.parse(json, function(k, v) {\r\n\t\tif (typeof (k * 1) == \"number\" && typeof v == \"object\" && \"ch\" in v) {\r\n\t\t\tconst node = new Node(v);\r\n\t\t\tif (node.ch instanceof Array)\r\n\t\t\t\tnode.ch.forEach(v => v.parent = node);\r\n\t\t\treturn node;\r\n\t\t} else\r\n\t\t\treturn v;\r\n\t});\r\n\r\n\tif (ob instanceof Array)\r\n\t\treturn new Node({ch: ob});\r\n\telse \r\n\t\treturn ob;\r\n}\r\n\r\n\r\nfunction eHTML(code, shell=null) {\r\n\tconst _shell = \r\n\t\t! shell                  ? document.createElement(\"div\") :\r\n\t\ttypeof shell == \"string\" ? document.createElement(shell) :\r\n\t\ttypeof shell == \"object\" ? shell :\r\n\t\t\tnull;\r\n\t_shell.innerHTML = code;\r\n\treturn _shell.children[0];\r\n}\r\n\r\nfunction eHTMLDF(code) {\r\n\tconst _shell = document.createElement(\"template\");\r\n\treturn _shell.innerHTML = code, _shell.content;\r\n}","export default class Node {\r\n\tconstructor (ob) {\r\n\t\tObject.assign(this, ob);\r\n\t}\r\n\t\r\n\tsplit        (a, b) { return split       (this, a, b);}\r\n\tsubDiv       (a, b) { return subDiv      (this, a, b);}\r\n\tstrip        (    ) { return strip       (this      );}\r\n\tjoin         (a, b) { return join        (this, a, b);}\r\n\r\n\tisStr        (    ) { return isStr       (this      );}\r\n\tisArr        (    ) { return isArr       (this      );}\r\n\r\n\ttoJSON       (    ) { return toJSON      (this      );}\r\n\tgetSerial    (    ) { return getSerial   (this      );}\r\n\tgetBySerial  (sN  ) { return getBySerial (this, sN  );}\r\n\tget chIndex () { return getChIndex(this); }\r\n\tget clone   () { return getClone  (this); }\r\n}\r\n\r\n/*function wrap (self) {\r\n\tconst wr = new Node({\r\n\t\ttd: \"X\",\r\n\t\tch: self\r\n\t});\r\n\tself.parent.ch.splice(self.chIndex, 1, wr);\r\n}*/\r\nfunction strip (self) {\r\n\tif (isArr(...self.ch))\r\n\t\tself.parent.ch.splice(self.chIndex, 1, self.ch);\r\n}\r\n\r\nfunction join (self, a, b) {\r\n\tif (isArr(self)) {\r\n\t\tconst joined = self.ch.slice(a, b);\r\n\t\tif (isArr(...joined)) {\r\n\t\t\tconst \r\n\t\t\t\tstartPoint = joined[0].chIndex,\r\n\t\t\t\tpasted = [];\r\n\t\t\tfor (let v of joined)\r\n\t\t\t\tpasted.push(...v);\r\n\t\t\tfor (let v of pasted)\r\n\t\t\t\tv.parent = self;\r\n\t\t\tself.ch.splice(startPoint, joined.length, ...pasted);\r\n\t\t} else if (isStr(...joined)) {\r\n\t\t\tconst \r\n\t\t\t\tstartPoint = joined[0].chIndex,\r\n\t\t\t\tpastedStr = joined.reguce((a,v) => a += v.ch, \"\"),\r\n\t\t\t\tpastedNode = new Node({\r\n\t\t\t\t\tch: pastedStr,\r\n\t\t\t\t\tparent: self,\r\n\t\t\t\t});\r\n\t\t\tself.ch.splice(startPoint, joined.length, pastedNode);\r\n\t\t}\r\n\t}\r\n\tconst \r\n\t\tn = self.chIndex + 1,\r\n\t\tright = self.parent.ch[n];\r\n\tif (right)\r\n\t\tif (isArr(self, right) || isStr(self, right)) {\r\n\t\t\tself.ch = self.ch.concat(right.ch);\r\n\t\t\tself.parent.ch.splice(n, 1);\r\n\t\t}\r\n\r\n}\r\n\r\n/*\r\nfunction joinRight (self) {\r\n\tconst \r\n\t\tn = self.chIndex + 1,\r\n\t\tright = self.parent.ch[n];\r\n\tif (right)\r\n\t\tif (isArr(self, right) || isStr(self, right)) {\r\n\t\t\tself.ch = self.ch.concat(right.ch);\r\n\t\t\tself.parent.ch.splice(n, 1);\r\n\t\t}\r\n}\r\nfunction joinLeft (self) {\r\n\tconst \r\n\t\tn = self.chIndex - 1,\r\n\t\tleft = self.parent.ch[n];\r\n\tif (left)\r\n\t\tif (isArr(self, left) || isStr(self, left)) {\r\n\t\t\tself.ch = left.ch.concat(self.ch);\r\n\t\t\tself.parent.ch.splice(n, 1);\r\n\t\t}\r\n}*/\r\n\r\nfunction split (self, a, b) {\r\n\tconst \r\n\t\tparts = [\r\n\t\t\tself.ch.slice(0, a),\r\n\t\t\tself.ch.slice(a, b),\r\n\t\t\tself.ch.slice(b   ),\r\n\t\t],\r\n\t\tnewChildren = [];\r\n\r\n\tfor (let p of parts) \r\n\t\tif (p.length)\r\n\t\t\tnewChildren.push(new self.constructor ({\r\n\t\t\t\t\ttd: \"X\",\r\n\t\t\t\t\tch: p,\r\n\t\t\t\t\tparent: self.parent,\r\n\t\t\t\t}));\r\n\r\n\tself.parent.ch.splice(self.chIndex, 1, ...newChildren);\r\n}\r\n\r\nfunction subDiv (self, a, b) {\r\n\tconst \r\n\t\tstrings = [\r\n\t\t\tself.ch.slice(0, a),\r\n\t\t\tself.ch.slice(a, b),\r\n\t\t\tself.ch.slice(b   ),\r\n\t\t],\r\n\t\tnewChildren = [];\r\n\r\n\tfor (let str of strings) \r\n\t\tif (str.length)\r\n\t\t\tnewChildren.push(new self.constructor ({\r\n\t\t\t\t\ttd: \"X\",\r\n\t\t\t\t\tch: str,\r\n\t\t\t\t\tparent: self,\r\n\t\t\t\t}));\r\n\r\n\tself.ch = newChildren;\r\n}\r\n\r\n/*function detachRight (self, a) {\r\n\tconst \r\n\t\tleft  = self.ch.slice(0, a),\r\n\t\tright = self.ch.slice(a   );\r\n\tif (left.length && right.length) {\r\n\t\tself.ch = left;\r\n\t\tinsertRight(self, new Node({\r\n\t\t\ttd: \"X\",\r\n\t\t\tch: right,\r\n\t\t}));\r\n\t}\r\n}\r\n\r\nfunction detachLeft (self, a) {\r\n\tconst \r\n\t\tleft  = self.ch.slice(0, a),\r\n\t\tright = self.ch.slice(a   );\r\n\tif (left.length && right.length) {\r\n\t\tinsertLeft(self, new Node({\r\n\t\t\ttd: \"X\",\r\n\t\t\tch: left,\r\n\t\t}));\r\n\t\tself.ch = right;\r\n\t}\r\n}*/\r\n\r\n/*function insertRight (self, ...nodes) {\r\n\tself.parent.ch.splice(self.chIndex + 1, 0, ...nodes)\r\n}\r\n\r\nfunction insertLeft (self, ...nodes) {\r\n\tself.parent.ch.splice(self.chIndex, 0, ...nodes)\r\n}*/\r\n\r\nfunction getChIndex (self) {\r\n\tif (self.parent) \r\n\t\tfor (let [k,v] of self.parent.ch.entries()) \r\n\t\t\tif (v == self)\r\n\t\t\t\treturn k;\r\n\r\n\treturn null;\r\n}\r\n\r\nfunction getRoot(self) {\r\n\treturn self.parent ? getRoot(self.parent) : self;\r\n}\r\n\r\nfunction isStr(...args) {\r\n\tfor (let a of args) \r\n\t\tif (! (typeof a == \"string\"))\r\n\t\t\treturn false;\r\n\treturn true;\r\n}\r\n\r\nfunction isArr(...args) {\r\n\tfor (let a of args) \r\n\t\tif (! (a instanceof Array))\r\n\t\t\treturn false;\r\n\treturn true;\r\n}\r\n\r\nfunction toJSON(self) {\r\n\tconst ob = Object.assign({}, self);\r\n\tdelete ob.parent;\r\n\tdelete ob.serialN;\r\n\r\n\treturn ob;\r\n}\r\n\r\nfunction getClone(self) {\r\n\tconst  clone = new Node(self);\r\n\tdelete clone.parent;\r\n\tdelete clone.serialN;\r\n\r\n\tif(typeof self.ch == \"object\") {\r\n\t\tclone.ch = self.ch.map(getClone);\r\n\t\tclone.ch.forEach(v => v.parent = clone);\r\n\t}\r\n\r\n\treturn clone;\r\n}\r\n\r\nfunction checkToParent(self) {\r\n\tconst root = getRoot(self);\r\n\tforEachRecur((node) => {\r\n\t\tif (node.ch)\r\n\t\t\tfor (let v of node.ch) {\r\n\t\t\t\tif (! v.parent)\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\tif (v.parent != node)\r\n\t\t\t\t\tdebugger;\r\n\t\t\t}\r\n\t});\r\n}\r\n\r\nfunction getBySerial(self, serialN) {\r\n\tconst root = getRoot(self);\r\n\tlet node, sN = 0;\r\n\tforEachRecur((v) => {\r\n\t\tif (serialN == sN) \r\n\t\t\tnode = v;\r\n\r\n\t\tsN ++;\r\n\t}, root);\r\n\treturn node;\r\n}\r\n\r\nfunction getSerial(self) {\r\n\tconst root = getRoot(self);\r\n\tlet serialN, sN = 0;\r\n\tforEachRecur((v) => {\r\n\t\tif (v == self)\r\n\t\t\tserialN = sN;\r\n\t\telse\r\n\t\t\tsN ++;\r\n\t}, root);\r\n\treturn serialN;\r\n}\r\n\r\nfunction forEachRecur(preCb, ob, postCb) {\r\n\tif (ob instanceof Array) \r\n\t\tfor (let v of ob)\r\n\t\t\t\tforEachRecur(preCb, v, postCb);\r\n\telse if (typeof ob == \"object\") {\r\n\t\tif (preCb)\r\n\t\t\tpreCb(ob);\r\n\t\tforEachRecur(preCb, ob.ch, postCb);\r\n\t\tif (postCb)\r\n\t\t\tpostCb(ob);\r\n\t}\r\n}\r\n\r\nfunction initChildren(self) {\r\n\tif (isArr(self))\r\n\t\tself.ch.forEach(v => v.parent = self);\r\n}","import setStyle from \"./set-style.js\";\r\nimport SyntaxHlFk from \"./syntax-highlight-framework/syntax-hl-fk.js\";\r\n\r\nconst version = \"1.1.4\";\r\n\r\nconst {\r\n\ttoken,\r\n\tnToken,\r\n\tspToken,\r\n\trule,\r\n\tdomain,\r\n\tseq,\r\n\talter,\r\n\tq,\r\n\tnot,\r\n\tspWrap,\r\n\terror,\r\n\tdeb,\r\n} = SyntaxHlFk.describeAPI;\r\n\r\nconst\r\n\t__main_ = rule(function(pc) {\r\n\t\treturn seq(\r\n\t\t\tspWrap(r.subject.catch(\"Main. Expected subject.\")),\r\n\t\t\terror(\"Main. Unexpected symbol after end of code.\").q(\"*\")\r\n\t\t)(pc);\r\n\t}),\r\n\tlist = rule(function(pc) {\r\n\t\treturn token(\"[\").in(\"list__open\")\r\n\t\t\t.break(\r\n\t\t\t\tseq(\r\n\t\t\t\t\tspWrap(r.subject.q(\"*/\", spWrap(token(\",\").in(\"list__coma\")))),\r\n\t\t\t\t\ttoken(\"]\").in(\"list__close\")\r\n\t\t\t\t\t\t.catch(\"List. Expected closing bracket ' ] '.\"),\r\n\t\t\t\t)\r\n\t\t\t).msg(\"List.\")(pc);\r\n\t\t\t\r\n\t}),\r\n\tdict = rule(function(pc) {\r\n\t\treturn spToken(\"{\")\r\n\t\t\t.break(\r\n\t\t\t\talter(\r\n\t\t\t\t\tspToken(\"}\"),\r\n\t\t\t\t\tseq(\r\n\t\t\t\t\t\tseq(\r\n\t\t\t\t\t\t\td.string_n.catch(\"Dict. Expected string name of field.\"),\r\n\t\t\t\t\t\t\tspToken(\":\").catch(\"Dict. Expected colon ' : '.\"),\r\n\t\t\t\t\t\t\tr.subject.catch(\"Dict. Expected subject - (null | boll | number | string | list | dict).\")\r\n\t\t\t\t\t\t).q(\"*/\", spToken(\",\")),\r\n\t\t\t\t\t\tspToken(\"}\").catch(\"Dict. Expected closing curly ' } ' or coma ' , '.\"),\r\n\t\t\t\t\t),\r\n\t\t\t\t)\r\n\t\t\t).msg(\"Dict.\")(pc);\r\n\t}),\r\n\td = {\r\n\t\tstring_v : domain(\"string_v\" , function(pc) {\r\n\t\t\treturn r.string(pc);\r\n\t\t}),\r\n\t\tstring_n : domain(\"string_n\" , function(pc) {\r\n\t\t\treturn r.string(pc);\r\n\t\t}),\r\n\t\tslashed : domain(\"slashed\", function(pc) {\r\n\t\t\treturn token(\r\n\t\t\t\t'\\\\\"'         ,\r\n\t\t\t\t\"\\\\\\\\\"        , \r\n\t\t\t\t\"\\\\/\"         , \r\n\t\t\t\t\"\\\\b\"         ,\r\n\t\t\t\t\"\\\\f\"         ,\r\n\t\t\t\t\"\\\\n\"         ,\r\n\t\t\t\t\"\\\\r\"         ,\r\n\t\t\t\t\"\\\\t\"         ,\r\n\t\t\t\t/\\\\u\\d\\d\\d\\d/y,\r\n\t\t\t)(pc);\r\n\t\t}),\r\n\t\tnumber          : domain(\"number\", function(pc) {\r\n\t\t\treturn token(/\\b\\d+\\.|\\.\\d+\\b|\\b\\d+\\.?\\d*\\b/y)(pc);\r\n\t\t}),\r\n\t\tbool            : domain(\"bool\", function(pc) {\r\n\t\t\treturn token(/\\btrue\\b|\\bfalse\\b/y)(pc);\r\n\t\t}),\r\n\t\t_null           : domain(\"_null\", function(pc) {\r\n\t\t\treturn token(/\\bnull\\b/y)(pc);\r\n\t\t}),\r\n\t},\r\n\tr = {\r\n\t\tsubject         : rule(function(pc) {\r\n\t\t\treturn alter(\r\n\t\t\t\td._null,\r\n\t\t\t\td.bool,\r\n\t\t\t\td.number,\r\n\t\t\t\td.string_v,\r\n\t\t\t\tlist,\r\n\t\t\t\tdict\r\n\t\t\t)(pc);\r\n\t\t}),\r\n\t\tstring        : rule(function(pc) {\r\n\t\t\treturn seq(\r\n\t\t\t\ttoken('\"'),\r\n\t\t\t\tq(alter(d.slashed, nToken('\"', \"\\n\", \"\\\\\")), \"*\"),\r\n\t\t\t\ttoken('\"').catch(\"String: invalid symbol\"),\r\n\t\t\t)(pc);\r\n\t\t}),\r\n\t\tspace           : rule(function(pc) {\r\n\t\t\treturn token(/\\s+/y)(pc);\r\n\t\t}),\r\n\t};\r\n\r\nexport default class JsonErrHlter extends SyntaxHlFk.Highlighter {\r\n\tconstructor (clPref=\"json-err-hl\") {\r\n\t\tsuper(__main_, clPref);\r\n\t\tsetStyle(clPref);\r\n\t}\r\n\r\n\tget version () { return version; }\r\n\r\n\tgetHighlighted (\r\n\t\ttempl, firstLineNum=1, cssClasses=\"calm-clarified-theme\") {\r\n\t\treturn super.getHighlighted(templ, firstLineNum, cssClasses);\r\n\t}\r\n}\r\n","export default function setStyle(clPref) {\r\n\r\n\tconst cssCode = `\r\n\t.json-err-hl.calm-theme {\r\n\t  background-color: #222; }\r\n\t  .json-err-hl.calm-theme .json-err-hl__line-text {\r\n\t    color: #eee; }\r\n\t    .json-err-hl.calm-theme .json-err-hl__line-text .string {\r\n\t      color: #ddc; }\r\n\t    .json-err-hl.calm-theme .json-err-hl__line-text .string_v {\r\n\t      color: #ddc; }\r\n\t    .json-err-hl.calm-theme .json-err-hl__line-text .string_n {\r\n\t      color: #78a; }\r\n\t    .json-err-hl.calm-theme .json-err-hl__line-text .slashed {\r\n\t      color: #f90; }\r\n\t    .json-err-hl.calm-theme .json-err-hl__line-text .number {\r\n\t      color: #f90; }\r\n\t    .json-err-hl.calm-theme .json-err-hl__line-text .bool {\r\n\t      color: #f90; }\r\n\t    .json-err-hl.calm-theme .json-err-hl__line-text ._null {\r\n\t      color: #98f; }\r\n\r\n\t.json-err-hl.calm-clarified-theme .json-err-hl__line .json-err-hl__line-number {\r\n\t  background-color: #444; }\r\n\r\n\t.json-err-hl.calm-clarified-theme .json-err-hl__line-text {\r\n\t  color: #eee; }\r\n\t  .json-err-hl.calm-clarified-theme .json-err-hl__line-text .string {\r\n\t    color: #ddc; }\r\n\t  .json-err-hl.calm-clarified-theme .json-err-hl__line-text .string_v {\r\n\t    color: #ddc; }\r\n\t  .json-err-hl.calm-clarified-theme .json-err-hl__line-text .string_n {\r\n\t    color: #78a; }\r\n\t  .json-err-hl.calm-clarified-theme .json-err-hl__line-text .bool {\r\n\t    color: #fb6; }\r\n\t  .json-err-hl.calm-clarified-theme .json-err-hl__line-text .number {\r\n\t    color: #fb6; }\r\n\t  .json-err-hl.calm-clarified-theme .json-err-hl__line-text .slashed {\r\n\t    color: #fb6; }\r\n\t  .json-err-hl.calm-clarified-theme .json-err-hl__line-text ._null {\r\n\t    color: #98f; }\r\n\r\n\t.json-err-hl.monokai-theme {\r\n\t  background-color: #333; }\r\n\t  .json-err-hl.monokai-theme .json-err-hl__line-text .string_n {\r\n\t    color: #3bd; }\r\n\t  .json-err-hl.monokai-theme .json-err-hl__line-text .string {\r\n\t    color: #da5; }\r\n\t  .json-err-hl.monokai-theme .json-err-hl__line-text .string_v {\r\n\t    color: #da5; }\r\n\t  .json-err-hl.monokai-theme .json-err-hl__line-text .slashed {\r\n\t    color: #98f; }\r\n\t  .json-err-hl.monokai-theme .json-err-hl__line-text .number {\r\n\t    color: #98f; }\r\n\t  .json-err-hl.monokai-theme .json-err-hl__line-text .bool {\r\n\t    color: #98f; }\r\n\t  .json-err-hl.monokai-theme .json-err-hl__line-text ._null {\r\n\t    color: #e48; }\r\n\r\n\t.json-err-hl.monokai-clarified-theme .json-err-hl__line-text .string_n {\r\n\t  color: #3bd; }\r\n\r\n\t.json-err-hl.monokai-clarified-theme .json-err-hl__line-text .string {\r\n\t  color: #da5; }\r\n\r\n\t.json-err-hl.monokai-clarified-theme .json-err-hl__line-text .string_v {\r\n\t  color: #da5; }\r\n\r\n\t.json-err-hl.monokai-clarified-theme .json-err-hl__line-text .slashed {\r\n\t  color: #98f; }\r\n\r\n\t.json-err-hl.monokai-clarified-theme .json-err-hl__line-text .number {\r\n\t  color: #98f; }\r\n\r\n\t.json-err-hl.monokai-clarified-theme .json-err-hl__line-text .bool {\r\n\t  color: #98f; }\r\n\r\n\t.json-err-hl.monokai-clarified-theme .json-err-hl__line-text ._null {\r\n\t  color: #e48; }\r\n\r\n\t `.replaceAll(/json-err-hl/g, clPref);\r\n\r\n\tconst styleClassName = `${clPref}__theme-style`;\r\n\r\n\tconst styleAlreadyExists = [].some.call(\r\n\t\tdocument.querySelectorAll(`style.${styleClassName}`), \r\n\t\t(v) => v.textContent === cssCode\r\n\t);\r\n\r\n\tif (! styleAlreadyExists) {\r\n\t\tconst style = eHTML(`<style class=\"${styleClassName}\"></style>`);\r\n\t\tstyle.textContent = cssCode;\r\n\t\tdocument.head.appendChild(style);\r\n\t}\r\n}\r\n\r\n\r\nfunction eHTML(code, shell=null) {\r\n\tconst _shell = \r\n\t\t! shell                  ? document.createElement(\"div\") :\r\n\t\ttypeof shell == \"string\" ? document.createElement(shell) :\r\n\t\ttypeof shell == \"object\" ? shell :\r\n\t\t\tnull;\r\n\t_shell.innerHTML = code;\r\n\treturn _shell.children[0];\r\n}","import describeAPI from \"./describeAPI.js\";\r\nimport Highlighter from \"./Highlighter.js\";\r\n\r\nexport default {\r\n\tversion: \"5.2.3\",\r\n\tdescribeAPI,\r\n\tHighlighter,\r\n};","export  default {\r\n\ttoken,\r\n\tnToken,\r\n\tspToken,\r\n\trule,\r\n\tdomain,\r\n\tseq,\r\n\talter,\r\n\tq,\r\n\tnot,\r\n\tspWrap,\r\n\terror,\r\n\tdeb,\r\n};\r\n\r\nconst Analyzer_proto = {\r\n\tq : function (quanto, sepCallb=undefined) {\r\n\t\tif (quanto == \"*/\" || quanto == \"+/\")\r\n\t\t\tchekToAnalyzer(\"analyzer.q\", 2, sepCallb);\r\n\t\treturn q(this, quanto, sepCallb);\r\n\t},\r\n\tin : function (name) {\r\n\t\treturn domain(name, this);\r\n\t},\r\n\tand : function (callb) {\r\n\t\tchekToAnalyzer(\"analyzer.and\", 1, callb);\r\n\t\treturn seq(this, callb);\r\n\t},\r\n\tor : function (callb) {\r\n\t\tchekToAnalyzer(\"analyzer.or\", 1, callb);\r\n\t\treturn alter(this, callb);\r\n\t},\r\n\tbreak : function (...args) {\r\n\t\tfor (let [k, callb] of args.entries())\r\n\t\t\tchekToAnalyzer(\"analyzer.break\", k + 1, callb);\r\n\t\tlet message = \"\";\r\n\t\tconst _break_ = (pc) => {\r\n\t\t\tif(this(pc)) {\r\n\t\t\t\tseq(...args).or(undefinedError(message))(pc);\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t\tObject.setPrototypeOf(_break_, Analyzer_proto);\r\n\t\t_break_.msg = function(msg) {\r\n\t\t\tmessage = msg;\r\n\t\t\treturn this;\r\n\t\t}\r\n\t\treturn _break_;\r\n\t},\r\n\tcatch : function (msg) {\r\n\t\tconst _catch_ = (pc) => {\r\n\t\t\treturn alter(\r\n\t\t\t\tthis,\r\n\t\t\t\terror(msg)\r\n\t\t\t)(pc);\r\n\t\t}\r\n\t\tObject.setPrototypeOf(_catch_, Analyzer_proto);\r\n\t\treturn _catch_;\r\n\t},\r\n\tdeb : function (i0=0, i1=0) {\r\n\t\treturn deb(this, i0, i1);\r\n\t},\r\n};\r\n\r\nObject.setPrototypeOf(Analyzer_proto, Function);\r\n\r\nfunction seq(...callbs) {\r\n\tfor (let [k, callb] of callbs.entries())\r\n\t\tchekToAnalyzer(\"seq\", k + 1, callb);\r\n\tfunction _seq_(pc) {\r\n\t\tconst hpc = pc.createHypo();\r\n\t\tfor (let [k, callb] of callbs.entries()) {\r\n\t\t\tconst res = callb(hpc);\r\n\t\t\tif (res || pc.errC.eFlag) \r\n\t\t\t\tcontinue;\r\n\t\t\telse \r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t\tpc.acceptHypo(hpc);\r\n\t\treturn true;\r\n\t}\r\n\tObject.setPrototypeOf(_seq_, Analyzer_proto);\r\n\treturn _seq_;\r\n}\r\n\r\nfunction alter(...callbs) {\r\n\tfor (let [k, callb] of callbs.entries())\r\n\t\tchekToAnalyzer(\"alter\", k + 1, callb);\r\n\tfunction _alter_(pc) {\r\n\t\tlet res;\r\n\t\tfor (let [k, callb] of callbs.entries()) {\r\n\t\t\tconst res = callb(pc);\r\n\t\t\tif (res)\r\n\t\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\tObject.setPrototypeOf(_alter_, Analyzer_proto);\r\n\treturn _alter_;\r\n}\r\n\r\nfunction q(callb, quanto, callb2=undefined) {\r\n\tchekToAnalyzer(\"q\", 1, callb);\r\n\tlet _q_;\r\n\tif (quanto == \"*\") {\r\n\t\t_q_ = function _q_zero_or_many_(pc) {\r\n\t\t\twhile (pc.text[pc.i]) {\r\n\t\t\t\tlet i0 = pc.i, status;\r\n\t\t\t\tstatus = callb(pc);\r\n\t\t\t\tif (status) {\r\n\t\t\t\t\tif (i0 != pc.i) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Not strict variant. Mismatches allowed throw error message in console.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\tconsole.error(`(!)`, `i0 == pc.i`, \r\n\t\t\t\t\t\t\t\"\\n\\tpc.i :\", pc.i, \"\\n\\tpc.monitor :\", pc.monitor); \r\n\t\t\t\t\t\tpc.i ++;\r\n\t\t\t\t\t\treturn true;\r\n\r\n\t\t\t\t\t\t/**\r\n\t\t\t\t\t\t * Strict variant. Mismatches forbidden. Script will stoped.\r\n\t\t\t\t\t\t */\r\n\t\t\t\t\t\t// console.error(`(!)`, `i0 == pc.i`, pc); debugger; throw new Error();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else \r\n\t\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t}\r\n\t} else if (quanto == \"+\") {\r\n\t\t_q_ = function _q_one_or_many_(pc) {\r\n\t\t\treturn callb(pc) && q(callb, \"*\")(pc);\r\n\t\t}\r\n\t} else if (quanto == \"?\") {\r\n\t\t_q_ = function _q_zero_or_one_(pc) {\r\n\t\t\treturn callb(pc) || true;\r\n\t\t}\r\n\t} else if (quanto == \"*/\") {\r\n\t\tchekToAnalyzer(\"q\", 3, callb2);\r\n\t\t_q_ = function _q_zero_or_many_sep_(pc) {\r\n\t\t\tseq(\r\n\t\t\t\tcallb,\r\n\t\t\t\tseq(callb2, callb).q(\"*\")\r\n\t\t\t)(pc);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t} else if (quanto == \"+/\") {\r\n\t\tchekToAnalyzer(\"q\", 3, callb2);\r\n\t\t_q_ = function _q_one_or_many_sep_(pc) {\r\n\t\t\treturn seq(\r\n\t\t\t\t\tcallb,\r\n\t\t\t\t\tseq(callb2, callb).q(\"*\")\r\n\t\t\t\t)(pc);\r\n\t\t}\r\n\t} else {\r\n\t\tconsole.error(`(!)`, `Invalid quantifier`, `'${quanto}'`); debugger; throw new Error();\r\n\t}\r\n\r\n\tObject.setPrototypeOf(_q_, Analyzer_proto);\r\n\treturn _q_;\r\n}\r\n\r\nfunction not(callb) {\r\n\tchekToAnalyzer(\"not\", 1, callb);\r\n\tconst _not_ = function _not_(pc) {\r\n\t\tconst hpc = pc.createHypo();\r\n\t\tconst res = callb(hpc);\r\n\t\tif (! res) {\r\n\t\t\tpc.match(pc.text[pc.i]);\r\n\t\t\treturn true;\r\n\t\t} else \r\n\t\t\treturn false;\r\n\t}\r\n\tObject.setPrototypeOf(_not_, Analyzer_proto);\r\n\treturn _not_;\r\n}\r\n\r\nfunction domain(name, callb, msg=null) {\r\n\tconst _domain_ = function _domain_(pc) {\r\n\t\tconst\r\n\t\t\tchpc = pc.createChildHypo(name),\r\n\t\t\tstatus = callb(chpc)\r\n\t\tif (msg) \r\n\t\t\tchpc.msg = msg;\r\n\t\tif (status || pc.errC.eFlag) \r\n\t\t\tpc.acceptChildHypo(chpc);\r\n\t\treturn !! status;\r\n\t}\r\n\t_domain_.msg = function (text) {\r\n\t\treturn domain(name, callb, text);\r\n\t}\r\n\t_domain_.as = function(otherName, msg=null) {\r\n\t\treturn domain(otherName, callb);\r\n\t}\r\n\tObject.setPrototypeOf(_domain_, Analyzer_proto);\r\n\treturn _domain_;\r\n}\r\n\r\nfunction rule(callb) {\r\n\tconst _rule_ = function _rule_(pc) {\r\n\t\tconst \r\n\t\t\thpc    = pc.createHypo(),\r\n\t\t\tstatus = callb(hpc);\r\n\t\tif (status || pc.errC.eFlag) \r\n\t\t\tpc.acceptHypo(hpc);\r\n\t\treturn !! status;\r\n\t}\r\n\tObject.setPrototypeOf(_rule_, Analyzer_proto);\r\n\treturn _rule_;\r\n}\r\n\r\nfunction token(templ) {\r\n\tconst _token_ = function _token_(pc) {\r\n\t\treturn pc.match(templ);\r\n\t}\r\n\tObject.setPrototypeOf(_token_, Analyzer_proto);\r\n\treturn _token_;\r\n}\r\n\r\nfunction nToken(templ) {\r\n\tconst _notToken_ = function _notToken_(pc) {\r\n\t\treturn pc.notMatch(templ);\r\n\t}\r\n\tObject.setPrototypeOf(_notToken_, Analyzer_proto);\r\n\treturn _notToken_;\r\n}\r\n\r\nfunction spToken(templ) {\r\n\tconst _space_wrapped_token_ = function(pc) {\r\n\t\treturn seq(token(/\\s+/y).q(\"*\"), token(templ), token(/\\s+/y).q(\"*\"),)(pc);\r\n\t}\r\n\tObject.setPrototypeOf(_space_wrapped_token_, Analyzer_proto);\r\n\treturn _space_wrapped_token_;\r\n}\r\n\r\nfunction spWrap(callb) {\r\n\tchekToAnalyzer(\"spWrap\", 1, callb);\r\n\tconst _space_wrapped_ = function(pc) {\r\n\t\treturn seq(token(/\\s+/y).q(\"*\"), callb, token(/\\s+/y).q(\"*\"),)(pc);\r\n\t}\r\n\tObject.setPrototypeOf(_space_wrapped_, Analyzer_proto);\r\n\treturn _space_wrapped_;\r\n}\r\n\r\nfunction error(msg) {\r\n\tconst _error_ = function(pc) {\r\n\t\tdomain(\"error\", token(/\\s*.*/y), msg)(pc);\r\n\t\tpc.errC.eFlag = true;\r\n\t\tdomain(\"after-error\", token(/\\s+|\\S+/y), msg).q(\"*\")(pc);\r\n\t\treturn true;\r\n\t}\r\n\tObject.setPrototypeOf(_error_, Analyzer_proto);\r\n\treturn _error_;\r\n}\r\n\r\nfunction undefinedError(msg) {\r\n\tconst _undefined_error_ = function(pc) {\r\n\t\treturn error(\"Undefined error. \"+msg)(pc);\r\n\t}\r\n\tObject.setPrototypeOf(_undefined_error_, Analyzer_proto);\r\n\treturn _undefined_error_;\r\n}\r\n\r\nfunction deb(callb, a=0, b=0) {\r\n\tchekToAnalyzer(\"deb\", 1, callb);\r\n\tfunction _deb_(pc) {\r\n\t\tb = b || pc.text.length;\r\n\t\tif (a <= pc.i && pc.i <= b) {\r\n\t\t\tdebugger;\r\n\t\t\tconst res = callb(pc);\r\n\t\t\tconsole.log(`res`, res);\r\n\t\t\tdebugger;\r\n\t\t\treturn res;\r\n\t\t}\r\n\t}\r\n\tObject.setPrototypeOf(_deb_, Analyzer_proto);\r\n\treturn _deb_;\r\n}\r\n\r\nfunction chekToAnalyzer(fName, argN, callb) {\r\n\tif (! callb || callb instanceof Analyzer_proto) {\r\n\t\tconsole.error(`Argument`, argN, `(from 1) of function '${fName}()' is not Analiser. There is: \\n`, callb?.toString ? callb.toString() : callb);\r\n\t\tthrow new Error(`Invalid callback. \\n\\tArgument ${argN} of function '${fName}()' is not Analiser. \\n`);\r\n\t} else\r\n\t\treturn true;\r\n}","import ParseContext from \"./ParseContext.js\";\r\n\r\nexport default class HighlightAPI {\r\n\r\n\tconstructor (mainRule, clPref=\"syntax-hl-fk\") {\r\n\t\tthis.mainRule = mainRule;\r\n\t\tthis.clPref   = clPref  ;\r\n\t\t_setCSS(this);\r\n\t}\r\n\r\n\t/**\r\n\t * getHighlighted       (template, firstLineNum, cssClasses)\r\n\t * highlightTextContent (el)\r\n\t * scrollToFirstError   (el)\r\n\t * highlight            (el, template, firstLineNum)\r\n\t * setMainRule          (rule)\r\n\t */\r\n\r\n\tgetHighlighted       (...args) { return getHighlighted       (this, ...args); }\r\n\thighlightTextContent (...args) { return highlightTextContent (this, ...args); }\r\n\tscrollToFirstError   (...args) { return scrollToFirstError   (this, ...args); }\r\n\thighlight            (...args) { return highlight            (this, ...args); }\r\n\tsetMainRule          (...args) { return setMainRule          (this, ...args); }\r\n}\r\n\r\n\r\nfunction getHighlighted(self, text, firstLineNum=1, cssClasses=\"\") {\r\n\tconst el = document.createElement(\"div\");\r\n\tif (typeof cssClasses == \"string\")\r\n\t\tel.className += \" \" + cssClasses;\r\n\telse if (cssClasses instanceof Array) \r\n\t\tel.classList.add(...cssClasses);\r\n\telse \r\n\t\tthrow new Error([\r\n\t\t\t\"(!) getHighlighted(). \",\r\n\t\t\t\"Argument #3 must be a string, an array of strings, or undefined.\",\r\n\t\t\t\"\",\r\n\t\t\tcssClasses+\" given.\",\r\n\t\t\t\"\"\r\n\t\t].join(\"\\n\"));\r\n\thighlight(self, el, text, firstLineNum);\r\n\treturn el;\r\n}\r\n\r\nfunction highlightTextContent(self, el) {\r\n\treturn highlight(self, el, el.textContent, getFirstLineNum(el));\r\n}\r\n\r\nfunction scrollToFirstError(self, el) {\r\n\tconst errEl = el.querySelector(\".error\");\r\n\tif (errEl) {\r\n\t\t// errEl.scrollIntoView();\r\n\t\tconst \r\n\t\t\ttop = errEl.getBoundingClientRect().top - el.getBoundingClientRect().top,\r\n\t\t\tvpH = el.clientHeight,\r\n\t\t\tdeltaScroll = top - vpH / 2;\r\n\t\tel.scrollTop = deltaScroll;\r\n\t}\r\n}\r\n\r\nfunction highlight(self, contentEl, text, firstLineNum=1) {\r\n\tif (! (contentEl instanceof HTMLElement))\r\n\t\tthrow new Error([\r\n\t\t\t\"(!) highlight(). Argument #1 must be a HTMLElement.\",\r\n\t\t\t\"\",\r\n\t\t\tcontentEl + \" given.\",\r\n\t\t\t\"\"\r\n\t\t].join(\"\\n\"));\r\n\r\n\tif ([\"executing\", \"executed\", \"exec-error\"].some((v) => contentEl.classList.contains(v)))\r\n\t\tthrow new Error([\r\n\t\t\t\"(!) Highlighter. Already handled.\", \r\n\t\t\t\"\",\r\n\t\t\tcontentEl\r\n\t\t].join(\"\\n\"));\r\n\t\r\n\tcontentEl.classList.add(self.clPref);\r\n\tcontentEl.classList.add(\"executing\");\r\n\tcontentEl.innerHTML = \"\";\r\n\r\n\tif (typeof text != \"string\")\r\n\t\tthrow new Error([\r\n\t\t\t\"(!) highlight(). Argument #2 must be a string.\",\r\n\t\t\t\"\",\r\n\t\t\ttext + \" given.\",\r\n\t\t\t\"\"\r\n\t\t].join(\"\\n\"));\r\n\r\n\ttry {\r\n\t\tconst\r\n\t\t\tmodel    = _buildModel(self, text),\r\n\t\t\tcontents = _renderToHighlight(self, model, firstLineNum);\r\n\t\tcontents.forEach((lineOb) => lineOb.appendTo(contentEl));\r\n\t\tcontentEl.classList.remove(\"executing\");\r\n\t\tcontentEl.classList.add(\"executed\");\r\n\t} catch (e) {\r\n\t\tconsole.error(`(!)-CATCHED`, e);\r\n\t\tconst lines = text.split(\"\\n\");\r\n\t\tlines.forEach((line, i, a) => {\r\n\t\t\tlet lineOb = _makeLine(self, firstLineNum + i);\r\n\t\t\tlet m = line.match(/^(\\s*)(.*)/);\r\n\t\t\t[lineOb.indent.textContent, lineOb.content.textContent] = [m[1], m[2]];\r\n\t\t\tif (i < a.length - 1)\r\n\t\t\t\tlineOb.setEol();\r\n\t\t\tlineOb.appendTo(contentEl);\r\n\t\t});\r\n\t\tcontentEl.classList.remove(\"executing\");\r\n\t\tcontentEl.classList.add(\"exec-error\");\r\n\t}\r\n}\r\n\r\nfunction setMainRule(self, rule) {\r\n\tself.mainRule = rule;\r\n}\r\n\r\nfunction _buildModel(self, text) {\r\n\tconst mSlot = [];\r\n\tself.mainRule(new ParseContext({\r\n\t\ttext, \r\n\t\ti: 0, \r\n\t\tmSlot, \r\n\t\tdStack: []\r\n\t}));\r\n\treturn mSlot;\r\n}\r\n\r\nfunction _renderToHighlight (self, model, firstLineNum=1) {\r\n\tconst content = [], nodeStack = [];\r\n\tlet lNum = firstLineNum, indentZoneFlag = true, lastLine;\r\n\tnodeStack.last = () => nodeStack[nodeStack.length - 1];\r\n\tcontent.push(lastLine = _makeLine(self, lNum ++));\r\n\trecur(model);\r\n\treturn content;\r\n\tfunction recur(sb) {\r\n\t\tif (sb instanceof Array) {\r\n\t\t\tsb.forEach(recur);\r\n\t\t} else if (typeof sb == \"object\") {\r\n\t\t\tsb.parent = nodeStack.last() || null;\r\n\r\n\t\t\tnodeStack.push(sb);\r\n\t\t\trecur(sb.ch);\r\n\t\t\tnodeStack.pop();\r\n\r\n\t\t} else if (typeof sb == \"string\") {\r\n\t\t\tif (sb == \"\\n\") {\r\n\t\t\t\tlastLine.setEol();\r\n\t\t\t\tcontent.push(lastLine = _makeLine(self, lNum ++));\r\n\t\t\t\tindentZoneFlag = true;\r\n\t\t\t} else if (indentZoneFlag && sb.match(/^\\s+$/)) {\r\n\t\t\t\tlastLine.indent.innerHTML += sb;\r\n\t\t\t} else {\r\n\t\t\t\tlet _sb = sb;\r\n\t\t\t\tif (indentZoneFlag) {\r\n\t\t\t\t\tconst m = sb.match(/^(\\s*)(.*)/);\r\n\t\t\t\t\tif (! m)\r\n\t\t\t\t\t\tthrow new Error(`sb not matched with /^(\\\\s+)(.*)/. sb = ${sb}`)\r\n\t\t\t\t\tconst\r\n\t\t\t\t\t\tindent = m[1],\r\n\t\t\t\t\t\ttheText = m[2];\r\n\t\t\t\t\tlastLine.indent.innerHTML += indent;\r\n\t\t\t\t\t_sb = theText;\r\n\t\t\t\t\tindentZoneFlag = false;\r\n\t\t\t\t}\r\n\t\t\t\tconst \r\n\t\t\t\t\tlastDomainNode = nodeStack.last(),\r\n\t\t\t\t\tclassName = nodeStack.map(v => v.name).filter(v => v).join(\"- \"),\r\n\t\t\t\t\tel = _evaluate(`<span class=\"${className || \"\"}\"></span>`);\r\n\t\t\t\tif (nodeStack.last()?.name == \"error\") {\r\n\t\t\t\t\tlastLine.guter.classList.add(\"error\");\r\n\t\t\t\t\tlastLine.guter.title = nodeStack.last()?.msg;\r\n\t\t\t\t}\r\n\t\t\t\tif (nodeStack.last()?.name == \"after-error\") {\r\n\t\t\t\t\tlastLine.guter.classList.add(\"after-error\");\r\n\t\t\t\t\tlastLine.guter.title = nodeStack.last()?.msg;\r\n\t\t\t\t}\r\n\t\t\t\tlastLine.content.appendChild(el);\r\n\t\t\t\tel.textContent = _sb;\r\n\t\t\t\tel.astNode = nodeStack.last();\r\n\t\t\t\tconst msgStr = nodeStack.reduce((a,v) => {\r\n\t\t\t\t\tif (v.msg) \r\n\t\t\t\t\t\ta += `${v.name} : ${v.msg} \\n`;\r\n\t\t\t\t\treturn a;\r\n\t\t\t\t}, \"\");\r\n\t\t\t\tif (msgStr) {\r\n\t\t\t\t\tel.title = msgStr;\r\n\t\t\t\t\tel.style.cursor = \"pointer\";\r\n\t\t\t\t}\r\n\t\t\t\tif (lastDomainNode) {\r\n\t\t\t\t\tel.dataset.region = `${lastDomainNode.i0}:${lastDomainNode.i1}`;\r\n\t\t\t\t\tel.domain = lastDomainNode;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tconsole.error(\"Invalid model node\", sb);\r\n\t\t\tthrow new Error(\"Invalid model node.\")\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction _makeLine(self, num) {\r\n\treturn Object.setPrototypeOf(\r\n\t\t{\r\n\t\t\tline: _evaluate(\r\n\t\t\t\t`<span class=\"${self.clPref}__line\">`+\r\n\t\t\t\t\t`<span class=\"${self.clPref}__line-number\" data-line-number=\"${num}\"></span>`+\r\n\t\t\t\t\t`<span class=\"${self.clPref}__line-indent\"></span>`+\r\n\t\t\t\t\t`<span class=\"${self.clPref}__line-text\"  ></span>`+\r\n\t\t\t\t`</span>`\r\n\t\t\t),\r\n\t\t\teol: null,\r\n\t\t\tget guter  () {return this.line.children[0]},\r\n\t\t\tget indent () {return this.line.children[1]},\r\n\t\t\tget content() {return this.line.children[2]},\r\n\t\t},\r\n\t\t{\r\n\t\t\tappendTo: function(parent) {\r\n\t\t\t\tparent.appendChild(this.line);\r\n\t\t\t\tif (this.eol)\r\n\t\t\t\t\tparent.appendChild(this.eol);\r\n\t\t\t},\r\n\t\t\tsetEol: function() {this.eol = _evaluate(`<span>\\n</span>`);}\r\n\t\t}\r\n\t) \r\n}\r\n\r\nfunction _setCSS(self) {\r\n\t\r\n\tconst cssCode = `\r\n\t\t.syntax-hl-fk {\r\n\t\t  text-align: left;\r\n\t\t  white-space: pre;\r\n\t\t  background-color: #444;\r\n\t\t  color: #ccc;\r\n\t\t  -moz-tab-size: 4;\r\n\t\t  tab-size: 4;\r\n\t\t  overflow: auto;\r\n\t\t  max-height: 500px;\r\n\t\t  padding: 20px;\r\n\t\t  font-family: consolas, monospace; }\r\n\t\t  .syntax-hl-fk *::selection {\r\n\t\t    background-color: #000;\r\n\t\t    background-color: rgba(120, 120, 120, 0.5); }\r\n\t\t  .syntax-hl-fk .syntax-hl-fk__line {\r\n\t\t    margin-left: -20px; }\r\n\t\t    .syntax-hl-fk .syntax-hl-fk__line > * {\r\n\t\t      display: table-cell; }\r\n\t\t    .syntax-hl-fk .syntax-hl-fk__line .syntax-hl-fk__line-number {\r\n\t\t      width: 50px;\r\n\t\t      min-width: 50px;\r\n\t\t      max-width: 50px;\r\n\t\t      text-align: right;\r\n\t\t      background-color: #333;\r\n\t\t      padding-right: 10px;\r\n\t\t      margin-right: 5px;\r\n\t\t      transition: all .2s; }\r\n\t\t      .syntax-hl-fk .syntax-hl-fk__line .syntax-hl-fk__line-number:before {\r\n\t\t        content: attr(data-line-number) \"\"; }\r\n\t\t    .syntax-hl-fk .syntax-hl-fk__line span.syntax-hl-fk__line-number.error {\r\n\t\t      color: #fff;\r\n\t\t      background-color: #e48; }\r\n\t\t    .syntax-hl-fk .syntax-hl-fk__line .syntax-hl-fk__line-indent {\r\n\t\t      padding-left: 5px; }\r\n\t\t    .syntax-hl-fk .syntax-hl-fk__line .syntax-hl-fk__line-text {\r\n\t\t      padding-left: 20px;\r\n\t\t      white-space: pre-wrap;\r\n\t\t      word-break: break-word; }\r\n\t\t      .syntax-hl-fk .syntax-hl-fk__line .syntax-hl-fk__line-text .error {\r\n\t\t        color: #fff;\r\n\t\t        background-color: #e48;\r\n\t\t        box-shadow: inset 0 0 2px #fff; }\r\n\t\t      .syntax-hl-fk .syntax-hl-fk__line .syntax-hl-fk__line-text:before {\r\n\t\t        content: \"\";\r\n\t\t        margin-left: -20px; }\r\n\r\n\t`.replace(/syntax-hl-fk/g, self.clPref);\r\n\r\n\tconst styleClassName = `${self.clPref}__base-style`;\r\n\r\n\tconst styleAlreadyExists = [].some.call(\r\n\t\tdocument.querySelectorAll(`style.${styleClassName}`), \r\n\t\t(v) => v.textContent === cssCode\r\n\t);\r\n\r\n\tif (! styleAlreadyExists) {\r\n\t\tconst style = _evaluate(`<style class=\"${styleClassName}\"></style>`);\r\n\t\tstyle.textContent = cssCode;\r\n\t\tdocument.head.appendChild(style);\r\n\t}\r\n}\r\n\r\nfunction _evaluate (code) {\r\n\tconst shell = document.createElement(\"div\");\r\n\tshell.innerHTML = code;\r\n\treturn shell.children[0];\r\n}\r\n\r\n\r\nfunction getFirstLineNum(el) {\r\n\tconst dln = parseInt(el.dataset.lineNum);\r\n\tif (! dln)\r\n\t\treturn 1;\r\n\telse if (el.nodeName == \"PRE\")\r\n\t\treturn dln + 1;\r\n\telse \r\n\t\treturn dln;\r\n}","import ModelNode    from \"./ModelNode.js\";\r\n\r\nexport default class ParseContext {\r\n\tconstructor(pc) {\r\n\t\tObject.defineProperties(this,{\r\n\t\t\ttext:   {value: pc.text},\r\n\t\t\tmSlot:  {value: pc.mSlot},\r\n\t\t\tdStack: {value: pc.dStack},\r\n\t\t\tlFStack: {value: pc.lFStack},\r\n\t\t\terrC: {value: pc.errC || {eFlag: false}},\r\n\t\t});\r\n\t\tthis.i = pc.i;\r\n\t\tthis.i0 = pc.i0;\r\n\t\tthis.selfMN = pc.selfMN;\r\n\t\tthis.monitor = pc.monitor;\r\n\t\t// this.debugDomain = pc.debugDomain;\r\n\t}\r\n\tmatch (templ) {\r\n\t\tconst {mSubstr, len} = this._getMatchSubstr(templ);\r\n\r\n\t\tif (mSubstr) {\r\n\t\t\tthis.i += len;\r\n\t\t\tpush(this.mSlot, mSubstr);\r\n\t\t\tthis.monitor = this.i+ \" : \"+this.text.substr(this.i, 20)\r\n\t\t\treturn mSubstr;\r\n\t\t} else\r\n\t\t\treturn \"\";\r\n\t}\r\n\tnotMatch (templ) {\r\n\t\tconst {mSubstr, len} = this._getMatchSubstr(templ);\r\n\r\n\t\tif (mSubstr) {\r\n\t\t\treturn false;\r\n\t\t} else {\r\n\t\t\tconst simbol = this.text[this.i];\r\n\t\t\tpush(this.mSlot, simbol);\r\n\t\t\tthis.i += 1;\r\n\t\t\tthis.monitor = this.i+ \" : \"+this.text.substr(this.i, 20);\r\n\t\t\treturn simbol;\r\n\t\t}\r\n\r\n\r\n\t\tconst hpc = this.createHypo();\r\n\t\tif (! hpc.match(templ)) {\r\n\t\t\tthis.match(this.text[this.i]);\r\n\t\t\treturn true;\r\n\t\t} else\r\n\t\t\treturn false;\r\n\t}\r\n\tcreateHypo () {\r\n\t\tconst \r\n\t\t\t{text, i, mSlot, dStack, errC} = this,\r\n\t\t\thpc = {text, i, mSlot: [], dStack, errC};\r\n\t\treturn new ParseContext(hpc);\r\n\t}\r\n\tacceptHypo (hpc) {\r\n\t\tthis.i = hpc.i;\r\n\t\tthis.monitor = hpc.monitor;\r\n\t\t// this.mSlot.push(...hpc.mSlot);\r\n\t\thpc.mSlot.forEach((v) => push(this.mSlot, v));\r\n\t\treturn true;\r\n\t}\r\n\tcreateChildHypo (name) {\r\n\t\tconst \r\n\t\t\t{text, i, dStack, errC} = this,\r\n\t\t\tmSlot = [],\r\n\t\t\tmn = new ModelNode(name, mSlot),\r\n\t\t\thpc = {text, i, i0: i, mSlot, selfMN: mn, dStack, errC};\r\n\t\tmn.i0 = i;\r\n\t\treturn new ParseContext(hpc);\r\n\t}\r\n\tacceptChildHypo (hpc) {\r\n\t\tthis.i = this.i1 = hpc.i;\r\n\t\tpush(this.mSlot, hpc.selfMN);\r\n\t\thpc.selfMN.i1 = hpc.i;\r\n\t\tif (hpc.msg)\r\n\t\t\thpc.selfMN.msg = hpc.msg;\r\n\t\thpc.selfMN = null;\r\n\t\treturn true;\r\n\t}\r\n\t_getMatchSubstr (templ) {\r\n\t\tlet mSubstr = \"\", len;\r\n\t\tif (typeof templ == \"string\") {\r\n\t\t\tlen = templ.length;\r\n\t\t\tconst substr = this.text.substr(this.i, len);\r\n\t\t\tif (substr === templ)\r\n\t\t\t\tmSubstr = substr;\r\n\t\t\t\r\n\t\t} else if (templ instanceof RegExp) {\r\n\t\t\ttempl.lastIndex = this.i;\r\n\t\t\tconst mOb    = this.text.match(templ);\r\n\t\t\tmSubstr =  mOb && mOb[0] || \"\";\r\n\t\t\tlen = mSubstr.length;\r\n\t\t}\r\n\r\n\t\treturn {mSubstr, len};\r\n\t}\r\n}\r\n\r\n\r\n\r\nfunction push(arr, subj) {\r\n\tif (typeof subj == \"string\") {\r\n\t\tlet lines = subj.split(\"\\n\");\r\n\t\tfor (let [k, line] of lines.entries()) {\r\n\t\t\tif (k)\r\n\t\t\t\tarr.push(\"\\n\");\r\n\t\t\tif (line)\r\n\t\t\t\tpushOneLineText(arr, line);\r\n\t\t}\r\n\t} else \r\n\t\tarr.push(subj);\r\n}\r\n\r\nfunction pushOneLineText(arr, subj) {\r\n\tlet i = arr.length - 1;\r\n\tif (\r\n\t\ttypeof arr[i] == \"string\" \r\n\t\t&& typeof subj == \"string\" \r\n\t\t&& arr[i] !== \"\\n\" \r\n\t\t&& subj !== \"\\n\"\r\n\t\t&& (\r\n\t\t\tsubj.match(/^\\s+$/) && arr[i].match(/^\\s+$/) \r\n\t\t\t||\r\n\t\t\t! subj.match(/^\\s+$/) && ! arr[i].match(/^\\s+$/) \r\n\t\t)\r\n\t)\r\n\t\tarr[i] += subj;\r\n\telse\r\n\t\tarr.push(subj);\r\n}","export default class ModelNode {\r\n\tconstructor (name, ch) {\r\n\t\tObject.defineProperties(this,{\r\n\t\t\tname: {value: name},\r\n\t\t\tch  : {value: ch},\r\n\t\t});\r\n\t}\r\n\r\n\tget text () {\r\n\t\tlet res = \"\";\r\n\t\trecur(this.ch);\r\n\t\treturn res;\r\n\t\tfunction recur(sb) {\r\n\t\t\tif (sb instanceof Array) {\r\n\t\t\t\tsb.forEach(recur);\r\n\t\t\t} else if (typeof sb == \"object\") {\r\n\t\t\t\trecur(sb.ch);\r\n\t\t\t} else {\r\n\t\t\t\tres += sb;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}","export default function setStyle(clPref) {\r\n\r\n\tconst cssCode = `\r\n\t\t.line-format-diagram {\r\n\t\t  font-size: 14px;\r\n\t\t  white-space: nowrap;\r\n\t\t  color: #333;\r\n\t\t  margin: 20px 5px;\r\n\t\t  padding: 20px 5px;\r\n\t\t  user-select: none;\r\n\t\t  font-family: consolas, courier, monospace;\r\n\t\t  /*&.executed *{\r\n\r\n\t\t\t\tdisplay: inline-block;\r\n\r\n\t\t\t\ttext-align: center;\r\n\r\n\t\t\t}*/\r\n\t\t  /*&:not(.executed) {\r\n\r\n\t\t\t\tfont-family: monospace;\r\n\r\n\t\t\t\twhite-space: pre;\r\n\r\n\t\t\t\ttext-align: left;\r\n\r\n\t\t\t}*/ }\r\n\t\t  .line-format-diagram .line-format-diagram-part {\r\n\t\t    display: inline-block;\r\n\t\t    text-align: center;\r\n\t\t    border-right: 1px solid transparent;\r\n\t\t    border-left: 1px solid transparent;\r\n\t\t    margin-right: -1px; }\r\n\t\t    .line-format-diagram .line-format-diagram-part .line-format-diagram-grid-v-liner {\r\n\t\t      margin: 0 1px;\r\n\t\t      display: flex;\r\n\t\t      align-items: center;\r\n\t\t      justify-content: center;\r\n\t\t      height: 50px; }\r\n\t\t    .line-format-diagram .line-format-diagram-part .line-format-diagram-description:hover {\r\n\t\t      user-select: text; }\r\n\t\t    .line-format-diagram .line-format-diagram-part .line-format-diagram-top-descr .line-format-diagram-h-line {\r\n\t\t      border-top: 1px solid #999;\r\n\t\t      flex-grow: 10; }\r\n\t\t    .line-format-diagram .line-format-diagram-part .line-format-diagram-top-descr .line-format-diagram-td-block {\r\n\t\t      flex-grow: 1; }\r\n\t\t    .line-format-diagram .line-format-diagram-part .line-format-diagram-line-text {\r\n\t\t      font-size: 20px;\r\n\t\t      font-weight: bold;\r\n\t\t      color: #333;\r\n\t\t      white-space: pre;\r\n\t\t      background-clip: padding-box;\r\n\t\t      border-left: 1px solid transparent;\r\n\t\t      border-right: 1px solid transparent;\r\n\t\t      margin: -1px;\r\n\t\t      margin-top: 5px;\r\n\t\t      font-family: consolas, courier, monospace;\r\n\t\t      user-select: text; }\r\n\t\t    .line-format-diagram .line-format-diagram-part .line-format-diagram-bottom-rel-wr {\r\n\t\t      border-left: 1px solid transparent;\r\n\t\t      border-right: 1px solid transparent;\r\n\t\t      border-color: #999;\r\n\t\t      padding: 5px 1px;\r\n\t\t      margin: -1px;\r\n\t\t      display: block; }\r\n\t\t      .line-format-diagram .line-format-diagram-part .line-format-diagram-bottom-rel-wr .line-format-diagram-bottom-rel {\r\n\t\t        text-align: center;\r\n\t\t        display: block;\r\n\t\t        position: relative;\r\n\t\t        border-bottom: 1px solid #999; }\r\n\t\t        .line-format-diagram .line-format-diagram-part .line-format-diagram-bottom-rel-wr .line-format-diagram-bottom-rel > .line-format-diagram-rel-line {\r\n\t\t          display: inline-block;\r\n\t\t          position: absolute;\r\n\t\t          width: 10px;\r\n\t\t          border-left: 1px solid #999;\r\n\t\t          border-bottom: 1px solid #999;\r\n\t\t          padding-bottom: calc(5px + .5em); }\r\n\t\t          .line-format-diagram .line-format-diagram-part .line-format-diagram-bottom-rel-wr .line-format-diagram-bottom-rel > .line-format-diagram-rel-line > .line-format-diagram-bottom-descr {\r\n\t\t            position: absolute;\r\n\t\t            left: 100%;\r\n\t\t            white-space: pre;\r\n\t\t            border: 1px solid #999;\r\n\t\t            text-align: left; }\r\n\t\t  .line-format-diagram .line-format-diagram-part.show-borders {\r\n\t\t    border-color: #999; }\r\n\t\t    .line-format-diagram .line-format-diagram-part.show-borders .sps-line-text {\r\n\t\t      border-color: #999; }\r\n\t\t  .line-format-diagram .line-format-diagram-grid-v-liner + .line-format-diagram-part {\r\n\t\t    margin-left: -1px; }\r\n\t\t  .line-format-diagram .line-format-diagram-grid-bv-liner {\r\n\t\t    padding: 5px;\r\n\t\t    border: 4px solid transparent;\r\n\t\t    display: block; }\r\n\r\n\t\t.line-format-diagram.top-lines .line-format-diagram-part .line-format-diagram-grid-v-liner {\r\n\t\t  margin-top: 5px;\r\n\t\t  border-top: 1px solid transparent; }\r\n\r\n\t\t.line-format-diagram.top-lines .line-format-diagram-part .line-format-diagram-top-descr {\r\n\t\t  border-top: 1px solid #999;\r\n\t\t  align-items: flex-start; }\r\n\t\t  .line-format-diagram.top-lines .line-format-diagram-part .line-format-diagram-top-descr .line-format-diagram-h-line {\r\n\t\t    border: none; }\r\n\r\n\t\t.line-format-diagram.bottom-lines .line-format-diagram-part .line-format-diagram-grid-v-liner {\r\n\t\t  margin-bottom: 5px;\r\n\t\t  border-bottom: 1px solid transparent; }\r\n\r\n\t\t.line-format-diagram.bottom-lines .line-format-diagram-part .line-format-diagram-top-descr {\r\n\t\t  border-bottom: 1px solid #999;\r\n\t\t  margin-top: -5px;\r\n\t\t  align-items: flex-end; }\r\n\t\t  .line-format-diagram.bottom-lines .line-format-diagram-part .line-format-diagram-top-descr .line-format-diagram-h-line {\r\n\t\t    border: none; }\r\n\r\n\t`.replace(/\\bline-format-diagram/g, clPref);\r\n\r\n\tconst styleClassName = `${clPref}__theme-style`;\r\n\r\n\tconst styleAlreadyExists = [].some.call(\r\n\t\tdocument.querySelectorAll(`style.${styleClassName}`), \r\n\t\t(v) => v.textContent === cssCode\r\n\t);\r\n\r\n\tif (! styleAlreadyExists) {\r\n\t\tconst style = eHTML(`<style class=\"${styleClassName}\"></style>`);\r\n\t\tstyle.textContent = cssCode;\r\n\t\tconst firstEl = document.head.children[0];\r\n\t\tif (firstEl)\r\n\t\t\tdocument.head.insertBefore(style, firstEl);\r\n\t\telse\r\n\t\t\tdocument.head.appendChild(style);\r\n\t}\r\n}\r\n\r\n\r\nfunction eHTML(code, shell=null) {\r\n\tconst _shell = \r\n\t\t! shell                  ? document.createElement(\"div\") :\r\n\t\ttypeof shell == \"string\" ? document.createElement(shell) :\r\n\t\ttypeof shell == \"object\" ? shell :\r\n\t\t\tnull;\r\n\t_shell.innerHTML = code;\r\n\treturn _shell.children[0];\r\n}","import * as lib from \"./lib.js\";\nimport JsonEHl  from \"./json-err-hl/json-err-hl.js\";\n\nexport default function buildDiagram(self, elem, tOb) {\n\telem.classList.add(self.clPref);\n\tconst opts = Object.assign({\n\t\tstyle:  \"\",\n\t\tbdColor: \"\",\n\t\tlineNum: 0,\n\t}, elem.dataset);\n\n\topts.bdColor = opts.bdColor &&= ` border-color: ${opts.bdColor}; `;\n\n\tconst {tLevels, bLevels} = _getLevels(tOb);\n\tconst htmlStr = _getHtmlStr(tOb, opts, tLevels, bLevels, self.clPref) \n\t\t+ _getLinersHtmlStr(bLevels, self.clPref);\n\n\telem.innerHTML = htmlStr;\n}\n\nfunction _getLevels(tOb) {\n\tconst \n\t\ttLevels = [],\n\t\tbLevels = [];\n\n\trecursive(tOb, 0);\n\tbLevels.push(1);\n\treturn {tLevels, bLevels};\n\n\tfunction recursive(tOb, level=0) {\n\t\ttLevels[level] ||= 0;\n\n\t\tif (tOb instanceof Array) {\n\n\t\t\tfor (let node of tOb) \n\t\t\t\trecursive(node, level);\n\n\t\t} else if (tOb.ch) {\n\n\t\t\tconst node = tOb;\n\n\t\t\tif (\"td\" in node) {\n\t\t\t\tconst \n\t\t\t\t\tlines = node.td.split(\"\\n\"),\n\t\t\t\t\tn = lines.length;\n\t\t\t\tif (tLevels[level] < n)\n\t\t\t\t\ttLevels[level] = n;\n\t\t\t\tnode.topDescr = lines.join(\"<br/>\");\n\t\t\t}\n\n\t\t\tif (node.ch)\n\t\t\t\tif (typeof node.ch != \"string\")\n\t\t\t\t\trecursive(node.ch, level + 1);\n\n\t\t\tif (node.bd)\n\t\t\t\tif (typeof node.ch == \"string\") {\n\t\t\t\t\tconst \n\t\t\t\t\t\tlines = node.bd.split(\"\\n\"),\n\t\t\t\t\t\tn = lines.length;\n\t\t\t\t\tbLevels.push(n);\n\t\t\t\t\tnode.bottomDescr = lines.join(\"<br/>\");\n\t\t\t\t} else {\n\t\t\t\t\tnode.bottomDescr = null;\n\t\t\t\t\tnode.errors = node.errors || [];\n\t\t\t\t\tnode.errors.push(\"'node.bd' is deleted.\");\n\t\t\t\t}\n\t\t}\n\t}\n}\n\nfunction _getHtmlStr(templ, opts, tLevels, _bLevels, clPref) {\n\tlet \n\t\tbLevels = _bLevels.map(v => v),\n\t\tstr     = \"\",\n\t\tserialN = -1;\n\n\trecursive(templ, 0);\n\treturn str;\n\n\tfunction recursive(templ, level=0, inheritStyle=\"\") {\n\t\tif (templ instanceof Array) {\n\t\t\tfor (let node of templ) \n\t\t\t\trecursive(node, level, inheritStyle);\n\t\t} else if (templ.ch) {\n\n\t\t\tconst node = Object.assign({\n\t\t\t\ttbStyle: \"\",\n\t\t\t\ttdStyle: \"\",\n\t\t\t\tstyle  : \"\",\n\t\t\t\tbbStyle: \"\",\n\t\t\t\tbdStyle: \"\",\n\t\t\t\tclass  : \"\",\n\t\t\t}, templ);\n\n\t\t\tconst hFZ = _getHFZ(tLevels[level]);\n\n\t\t\tlet \n\t\t\t\tlocalBdColor = \"border-color: transparent;\",\n\t\t\t\tshowBdsClass = \"\";\n\n\t\t\tif (\"topDescr\" in node) {\n\t\t\t\tshowBdsClass = \"show-borders\";\n\t\t\t\tlocalBdColor = opts.bdColor;\n\t\t\t} else {}\n\n\t\t\tstr += `<div class=\"${clPref}-part ${showBdsClass} ${node.class}\" ` + \n\t\t\t\t`style=\"${localBdColor}\" data-serial-n=\"${++ serialN}\">`;\n\t\t\t\n\t\t\tif (\"topDescr\" in node)\n\t\t\t\tstr += [\n\t\t\t\t\t`<div `,\n\t\t\t\t\t\t`class=\"`,\n\t\t\t\t\t\t\t`${clPref}-top-descr `,\n\t\t\t\t\t\t\t`${clPref}-description `,\n\t\t\t\t\t\t\t`${clPref}-grid-v-liner `,\n\t\t\t\t\t\t\t`${node.class}`,\n\t\t\t\t\t\t`\" `,\n\t\t\t\t\t\t`style=\"`,\n\t\t\t\t\t\t\t`\\n/* Autogenerated*/  ${hFZ}`,\n\t\t\t\t\t\t\t`\\n/*Common bdColor*/  ${opts.bdColor}`,\n\t\t\t\t\t\t`\"`,\n\t\t\t\t\t`>`,\n\n\t\t\t\t\t\t`<div `,\n\t\t\t\t\t\t\t`class=\"${clPref}-h-line ${node.class}\" `,\n\t\t\t\t\t\t\t`style=\"`,\n\t\t\t\t\t\t\t\t`\\n/*Common bdColor*/  ${opts.bdColor} `,\n\t\t\t\t\t\t\t\t`\\n/* Local tbStyle*/  ${node.tbStyle}\"`,\n\t\t\t\t\t\t`></div>`,\n\n\t\t\t\t\t\t`<div `,\n\t\t\t\t\t\t\t`class=\"${clPref}-td-block ${node.class}\" `,\n\t\t\t\t\t\t\t`style=\"/*Local tdStyle*/  ${node.tdStyle}\"`,\n\t\t\t\t\t\t`>`,\n\t\t\t\t\t\t\t\t`${node.topDescr}`,\n\t\t\t\t\t\t`</div>`,\n\n\t\t\t\t\t\t`<div `,\n\t\t\t\t\t\t\t`class=\"${clPref}-h-line ${node.class}\" `,\n\t\t\t\t\t\t\t`style=\"`,\n\t\t\t\t\t\t\t\t`\\n/*Common bdColor*/  ${opts.bdColor} `,\n\t\t\t\t\t\t\t\t`\\n/* Local tbStyle*/  ${node.tbStyle}\"`,\n\t\t\t\t\t\t`></div>`,\n\n\t\t\t\t\t`</div>`,\n\t\t\t\t].join(\"\");\n\t\t\telse \n\t\t\t\tstr += `<div \n\t\t\t\t\tclass=\"${clPref}-grid-v-liner\" \n\t\t\t\t\tstyle=\"/*Autogenerated*/  ${hFZ}\"\n\t\t\t\t></div>`;\n\n\t\t\tif (node.ch)\n\t\t\t\tif (typeof node.ch == \"string\") {\n\n\t\t\t\t\tfor (let i = level + 1; i < tLevels.length; i++) {\n\t\t\t\t\t\tlet hFZ = _getHFZ(tLevels[i]);\n\t\t\t\t\t\tstr += `<div class=\"${clPref}-grid-v-liner\" style=\"${hFZ}\"></div>`; \n\t\t\t\t\t}\n\n\t\t\t\t\tstr += [\n\t\t\t\t\t\t`<div `,\n\t\t\t\t\t\t\t`class=\"${clPref}-line-text ${node.class}\" `,\n\t\t\t\t\t\t\t`style=\"`,\n\t\t\t\t\t\t\t\t`\\n/*  Autogenerated*/  ${localBdColor}`,\n\t\t\t\t\t\t\t\t`\\n/*   Common style*/  ${opts.style}`,\n\t\t\t\t\t\t\t\t`\\n/*Inherited style*/  ${inheritStyle}`,\n\t\t\t\t\t\t\t\t`\\n/*      Own style*/  ${node.style}`,\n\t\t\t\t\t\t\t`\"`,\n\t\t\t\t\t\t`>${node.ch}</div>`\n\t\t\t\t\t].join(\"\");\n\n\t\t\t\t} else if (typeof node.ch == \"object\" && \"length\" in node.ch) {\n\t\t\t\t\trecursive(node.ch, level + 1, inheritStyle+node.style);\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(`(!) \"ch\" must be a string or an array.`);\n\t\t\t\t}\n\n\t\t\tif (node.bottomDescr) {\n\n\t\t\t\tlet strCount = bLevels.shift();\n\t\t\t\tstr += [\n\t\t\t\t\t`<div class=\"${clPref}-bottom-rel-wr ${node.class}\" `,\n\t\t\t\t\t\t`style=\"/*Common bdColor*/  ${opts.bdColor}\">`,\n\n\t\t\t\t\t\t`<div class=\"${clPref}-bottom-rel ${node.class}\" `,\n\t\t\t\t\t\t\t`style=\"`,\n\t\t\t\t\t\t\t\t`\\n/*Common bdColor*/  ${opts.bdColor}`,\n\t\t\t\t\t\t\t\t`\\n/* Local bbStyle*/  ${(node.bbStyle)}`,\n\t\t\t\t\t\t\t`\">`,\n\n\t\t\t\t\t\t\t`<div class=\"${clPref}-rel-line ${node.class}\" `,\n\t\t\t\t\t\t\t\t`style=\"`,\n\t\t\t\t\t\t\t\t\t`\\n/*Common bdColor*/  ${opts.bdColor}`,\n\t\t\t\t\t\t\t\t\t`\\n/* Local bbStyle*/  ${(node.bbStyle)}`,\n\t\t\t\t\t\t\t\t`\">`\n\t\t\t\t].join(\"\");\n\n\t\t\t\tbLevels.forEach((node) => {\n\t\t\t\t\tstr += [\n\t\t\t\t\t\t`<div class=\"${clPref}-grid-bv-liner\" `,\n\t\t\t\t\t\t\t`style=\"/*Autogenerated*/  height: ${node * 1.2}em\"></div>`\n\t\t\t\t\t].join(\"\");\n\t\t\t\t});\n\n\t\t\t\tstr += [\n\t\t\t\t\t\t\t\t`<div `,\n\t\t\t\t\t\t\t\t\t`class=\"`,\n\t\t\t\t\t\t\t\t\t\t`${clPref}-bottom-descr `,\n\t\t\t\t\t\t\t\t\t\t`${clPref}-description `,\n\t\t\t\t\t\t\t\t\t\t`${clPref}-grid-bv-liner `,\n\t\t\t\t\t\t\t\t\t\t`${node.class}`,\n\t\t\t\t\t\t\t\t\t`\" `,\n\t\t\t\t\t\t\t\t\t`style=\"`,\n\t\t\t\t\t\t\t\t\t\t`\\n/*Autogenerated*/  height: ${strCount * 1.2}em; `,\n\t\t\t\t\t\t\t\t\t\t`\\n/*Common bdColor*/  ${opts.bdColor}`,\n\t\t\t\t\t\t\t\t\t\t`\\n/* Local bdStyle*/  ${(node.bdStyle)}`,\n\t\t\t\t\t\t\t\t\t`\"`,\n\t\t\t\t\t\t\t\t`>`,\n\t\t\t\t\t\t\t\t\t`${node.bottomDescr}`,\n\t\t\t\t\t\t\t\t`</div>`,\n\t\t\t\t\t\t\t`</div>`,\n\t\t\t\t\t\t`</div>`,\n\t\t\t\t\t`</div>`,\n\t\t\t\t].join(\"\");\n\t\t\t}\n\n\t\t\t\n\n\t\t\tstr += `</div>`; // .${clPref}-part\n\t\t}\n\t}\n}\nfunction _getLinersHtmlStr(bLevels, clPref) {\n\tlet str = \"\";\n\tfor (let i = bLevels.length - 1; 0 <= i; i --) \n\t\tstr += `<div class=\"${clPref}-grid-bv-liner\" `+\n\t\t\t`style=\"/*Autogenerated*/  height: ${bLevels[i] * 1.3}em\"></div>`;\n\t\n\treturn str;\n}\n\nfunction _getHFZ(lineCount) {\n\treturn `height: ${lineCount * 1.5}em; font-size: 1em; `;\n}\n\n/*function _tryParseJSON (json) {\n\ttry {\n\t\treturn {\n\t\t\tobject: JSON.parse(json)\n\t\t};\n\t} catch (err) {\n\t\treturn {\n\t\t\ttext: json,\n\t\t\terror: err,\n\t\t}\n\t}\n}*/\n\n/*function _tryParseJSON (json) {\n\ttry {\n\t\tconst object = _fromJson(json)\n\t\treturn {object};\n\t} catch (err) {\n\t\treturn {\n\t\t\ttext: json,\n\t\t\terror: err,\n\t\t}\n\t}\n}\n\nfunction _fromJson(json) {\n\treturn JSON.parse(json, function(k, v) {\n\t\tif (typeof (k * 1) == \"number\" && typeof v == \"object\" && \"ch\" in v) {\n\t\t\tconst node = new Node(v);\n\t\t\tif (node.ch instanceof Array)\n\t\t\t\tnode.ch.forEach(v => v.parent = node);\n\t\t\treturn node;\n\t\t} else\n\t\t\treturn v;\n\t});\n}*/\n\n\n/*function eHTML(code, shell=null) {\n\tconst _shell = \n\t\t! shell                  ? document.createElement(\"div\") :\n\t\ttypeof shell == \"string\" ? document.createElement(shell) :\n\t\ttypeof shell == \"object\" ? shell :\n\t\t\tnull;\n\t_shell.innerHTML = code;\n\treturn _shell.children[0];\n}*/\n","import * as lib          from \"./lib.js\";\r\nimport buildDiagram      from \"./buildDiagram.js\";\r\nimport JsonEHl           from \"./json-err-hl/json-err-hl.js\";\r\nimport setSelectionEvent from \"./selection-event.js\";\r\n\r\nexport default class DiagramEditor {\r\n\tconstructor (clPref, elem, tOb) { constructor(this, clPref, elem, tOb);}\r\n\r\n\r\n}\r\n\r\nfunction constructor(self, clPref, elem, tOb) {\r\n\telem.innerHTML = \"\";\r\n\r\n\tself.clPref      = clPref;\r\n\tself.tOb         = tOb;\r\n\tself.editPanel   = _getEditPanelDom(self);\r\n\tself.codeEditBlock = _getCodeEditBlockDom(self);\r\n\tself.editButtons = self.editPanel.querySelector(`.${self.clPref}-edit-buttons`);\r\n\tself.navButtons  = self.editPanel.querySelector(`.${self.clPref}-nav-buttons`);\r\n\tself.diagram     = lib.eHTML(`<div class=\"\"><div>`);\r\n\tself.codeField   = self.codeEditBlock.querySelector(`.${self.clPref}-code-field`);\r\n\tself.editStage   = {\r\n\t\t\ttOb:     tOb.clone,\r\n\t\t};\r\n\tself.history   = [];\r\n\tself.history.i = -1;\r\n\r\n\r\n\telem.append(\r\n\t\tself.editPanel, \r\n\t\tself.diagram, \r\n\t\tself.codeEditBlock,\r\n\t);\r\n\r\n\tconsole.log(`self.codeEditBlock`, self.codeEditBlock);\r\n\r\n\teditLoop.commit(self);\r\n\r\n\tsetSelectionEvent(self);\r\n\r\n}\r\n\r\neditLoop.commit = commit;\r\n\r\nfunction commit(self) {\r\n\tconst {editStage, history} = self;\r\n\tthis(self);\r\n\r\n\thistory.i ++;\r\n\thistory[history.i] = editStage.tOb.clone;\r\n\thistory.splice(history.i + 1, Infinity);\r\n\r\n\tsetBtnEnableDisable(self);\r\n\tconsole.log(`self.history`, self.history);\r\n}\r\n\r\nfunction editLoop(self) {\r\n\tbuildDiagram(self, self.diagram, self.editStage.tOb);\r\n\tself.codeField.textContent = _stringify(self.editStage.tOb);\r\n}\r\n\r\nfunction setBtnEnableDisable(self) {\r\n\tconst {clPref :pr, history :hist, editPanel :pane} = self;\r\n\r\n\tpane.querySelector(`.${pr}-nav-undo`)[\r\n\t\t(hist.i <= 0) ? \"setAttribute\" : \"removeAttribute\"\r\n\t](\"disabled\", true);\r\n\r\n\tpane.querySelector(`.${pr}-nav-redo`)[\r\n\t\t(hist.i == hist.length - 1) ? \"setAttribute\" : \"removeAttribute\"\r\n\t](\"disabled\", true);\r\n}\r\n\r\nfunction _getEditPanelDom(self) {\r\n\tconst pr = self.clPref;\r\n\t\r\n\tconst dom = lib.eHTML(`\r\n\t\t<div class=\"${pr}-edit-panel\" style=\"white-space: normal;\">\r\n\t\t\t<div class=\"${pr}-edit-panel__btn-block ${pr}-history-buttons\" style=\"float: left;\">\r\n\t\t\t\t<button class=\"${pr}-nav-undo\" ></button>\r\n\t\t\t\t<button class=\"${pr}-nav-redo\" ></button>\r\n\t\t\t\t&nbsp;&nbsp;\r\n\t\t\t</div>\r\n\t\t\t<div class=\"${pr}-edit-panel__btn-block ${pr}-nav-buttons\" style=\"float: left;\">\r\n\t\t\t\t<button class=\"${pr}-nav-left\" ></button>\r\n\t\t\t\t<button class=\"${pr}-nav-up\"   ></button>\r\n\t\t\t\t<button class=\"${pr}-nav-right\"></button>\r\n\t\t\t\t<button class=\"${pr}-nav-down\" ></button>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"${pr}-edit-panel__btn-block ${pr}-edit-buttons\" style=\"float: right;\">\r\n\t\t\t\t<button class=\"${pr}-edit-split\"     >split</button>\r\n\t\t\t\t<button class=\"${pr}-edit-sub-div\"   >subDiv</button>\r\n\t\t\t\t<button class=\"${pr}-edit-strip\"     >strip</button>\r\n\t\t\t\t<button class=\"${pr}-edit-join\"      >join</button>\r\n\t\t\t</div>\r\n\t\t\t<div style=\"clear: both;\"></div>\r\n\t\t</div>\r\n\t`);\r\n\r\n\tdom.querySelector(`.${pr}-edit-buttons`).onclick = function(ev) {\r\n\t\tconst {rootNode, a, b} = self.editStage.selArgs;\r\n\t\tconst tClass = ev.target.classList.contains.bind(ev.target.classList);\r\n\r\n\t\tif (tClass(`${pr}-edit-split`)) {\r\n\t\t\trootNode.split(a, b);\r\n\t\t} else \r\n\t\tif (ev.target.classList.contains(`${pr}-edit-sub-div`)) {\r\n\t\t\trootNode.subDiv(a, b);\r\n\t\t} else \r\n\t\tif (tClass(`${pr}-edit-strip`)) {\r\n\t\t\trootNode.strip(a, b);\r\n\t\t} else \r\n\t\tif (tClass(`${pr}-edit-join`)) {\r\n\t\t\trootNode.join(a, b);\r\n\t\t}  \r\n\t\teditLoop.commit(self);\r\n\t};\r\n\r\n\tdom.querySelector(`.${pr}-history-buttons`).onclick = function (ev) {\r\n\t\tconst {editStage, history} = self;\r\n\t\tconst tClass = ev.target.classList.contains.bind(ev.target.classList);\r\n\r\n\t\tif        (tClass(`${pr}-nav-undo`)) {\r\n\t\t\tconsole.log(\"OK\");\r\n\t\t\tif (history[history.i - 1]) {\r\n\t\t\t\teditStage.tOb = history[-- history.i].clone;\r\n\t\t\t\tsetBtnEnableDisable(self);\r\n\t\t\t\teditLoop(self);\r\n\t\t\t}\r\n\t\t} else if (tClass(`${pr}-nav-redo`)) {\r\n\t\t\tconsole.log(\"OK\");\r\n\t\t\tif (history[history.i + 1]) {\r\n\t\t\t\teditStage.tOb = history[++ history.i].clone;\r\n\t\t\t\tsetBtnEnableDisable(self);\r\n\t\t\t\teditLoop(self);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t};\r\n\r\n\tdom.querySelector(`.${pr}-nav-buttons`).onclick = function (ev) {\r\n\t\tconst tClass = ev.target.classList.contains.bind(ev.target.classList);\r\n\r\n\t\tif        (tClass(`${pr}-nav-left`)) {\r\n\t\t\t// ...\r\n\t\t} else if (tClass(`${pr}-nav-up`)) {\r\n\t\t\t// ...\r\n\t\t} else if (tClass(`${pr}-nav-right`)) {\r\n\t\t\t// ...\r\n\t\t} else if (tClass(`${pr}-nav-down`)) {\r\n\t\t\t// ...\r\n\t\t}\r\n\r\n\t};\r\n\treturn dom;\r\n}\r\n\r\nfunction _getCodeEditBlockDom(self) {\r\n\tconst pr = self.clPref;\r\n\tconst dom = lib.eHTML(`\r\n\t\t<div class=\"${pr}-code-edit-block\">\r\n\t\t\t<div class=\"${pr}-code-edit-panel\">\r\n\t\t\t\t<div style=\"float: left;\">\r\n\t\t\t\t\t<button class=\"${pr}-new-blank\">New Blank</button>\r\n\t\t\t\t\t<button class=\"${pr}-apply\">Apply</button>\r\n\t\t\t\t\t<button class=\"${pr}-discard\">Discard</button>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style=\"float: right;\">\r\n\t\t\t\t\t<button class=\"${pr}-to-clipboard\">To Clipboard</button>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div style=\"clear: both;\"></div>\r\n\t\t\t</div>\r\n\t\t\t<pre class=\"${pr}-code-field\" contenteditable=\"true\"></pre>\r\n\t\t</div>\r\n\t`);\r\n\r\n\tdom.onclick = function (ev) {\r\n\t\tconst tClass = ev.target.classList.contains.bind(ev.target.classList);\r\n\r\n\t\tif        (tClass(`${pr}-new-blank`)) {\r\n\t\t\tconst str = [\r\n\t\t\t\t`{`,\r\n\t\t\t\t`    \"ch\": [`,\r\n\t\t\t\t`        {`,\r\n\t\t\t\t`            \"td\": \"main\",`,\r\n\t\t\t\t`            \"ch\": \"\"`,\r\n\t\t\t\t`        }`,\r\n\t\t\t\t`    ]`,\r\n\t\t\t\t`}`,\r\n\t\t\t].join(\"\\n\");\r\n\t\t\tself.codeField.textContent = str;\r\n\t\t\tself.editStage.tOb = JSON.parse(str);\r\n\t\t\teditLoop.commit(self);\r\n\t\t} else if (tClass(`${pr}-apply`)) {\r\n\t\t\tconst {object, error, text} = \r\n\t\t\t\tlib.tryParseJSON(self.codeField.textContent);\r\n\t\t\tif (object) {\r\n\t\t\t\tself.editStage.tOb = object.clone;\r\n\t\t\t\teditLoop.commit(self);\r\n\t\t\t} else if (error) {\r\n\t\t\t\tconst \r\n\t\t\t\t\thl = new JsonEHl(\"e-s-json-err-hl\"),\r\n\t\t\t\t\tcodeField = hl.getHighlighted(text);\r\n\t\t\t\tself.diagram.innerHTML = \"\";\r\n\t\t\t\tself.diagram.appendChild(codeField);\r\n\t\t\t\thl.scrollToFirstError(codeField);\r\n\t\t\t\tconsole.error(`(!) \\n`, self.diagram, \"\\n\", jsonError);\r\n\r\n\t\t\t}\r\n\t\t} else if (tClass(`${pr}-discard`)) {\r\n\t\t\tself.codeField.textContent = _stringify(self.editStage.tOb);\r\n\t\t} else if (tClass(`${pr}-to-clipboard`)) {\r\n\t\t\tconst str = self.codeField.textContent;\r\n\r\n\t\t\tconst tA = document.createElement(\"textarea\");\r\n\t\t\ttA.value = str;\r\n\t\t\tdocument.body.appendChild(tA);\r\n\t\t\ttA.select();\r\n\t\t\tdocument.execCommand(\"copy\");\r\n\t\t\tdocument.body.removeChild(tA);\r\n\t\t}\r\n\r\n\t};\r\n\r\n\treturn dom;\r\n}\r\n\r\n\r\nfunction _stringify(tOb) {\r\n\treturn JSON.stringify(tOb, null, 4);\r\n}","import * as lib     from \"./lib.js\";\r\n\r\nexport default function setSelectionEvent(self) {\r\n\t// document.onselectionchange = function (ev) {\r\n\tdocument.addEventListener(\"selectionchange\", function (ev) {\r\n\r\n\t\tdefineSelArgs(self);\r\n\t});\r\n}\r\n\r\nfunction defineSelArgs(self) {\r\n\tconst $el = $elem(self);\r\n\tconst \r\n\t\tsel = window.getSelection(),\r\n\t\trange = sel.getRangeAt(0),\r\n\t\t{\r\n\t\t\tcommonAncestorContainer :rootEl ,\r\n\t\t\tstartContainer          :startEl,\r\n\t\t\tendContainer            :endEl  ,\r\n\t\t} = range;\r\n\r\n\tconst \r\n\t\trootPart = $el(rootEl).part,\r\n\t\trootNode = self.editStage.tOb.getBySerial(rootPart.dataset.serialN);\r\n\r\n\tlet a, b, aEl, bEl;\r\n\r\n\tif (startEl == endEl) {\r\n\t\ta = range.startOffset;\r\n\t\tb = range.endOffset;\r\n\t} else {\r\n\t\taEl = (function () {\r\n\t\t\tlet el = startEl;\r\n\t\t\tdo {\r\n\t\t\t\tif (el.parentElement == rootPart)\r\n\t\t\t\t\treturn el;\r\n\t\t\t} while (el = el.parentElement);\r\n\t\t})();\r\n\t\tbEl = (function () {\r\n\t\t\tlet el = endEl;\r\n\t\t\tdo {\r\n\t\t\t\tif (el.parentElement == rootPart)\r\n\t\t\t\t\treturn el;\r\n\t\t\t} while (el = el.parentElement);\r\n\t\t})();\r\n\r\n\t\ta = $el(aEl).chIndex;\r\n\t\tb = $el(bEl).chIndex;\r\n\t}\r\n\tself.editStage.selArgs = {\r\n\t\trootNode,\r\n\t\trootPart,\r\n\t\taEl,\r\n\t\tbEl,\r\n\t\ta,\r\n\t\tb,\r\n\t}\r\n\r\n\tself.diagram.querySelectorAll(`.${self.clPref}-part`).forEach((v) => {\r\n\t\tv.style.boxShadow = \"\";\r\n\t});\r\n\trootPart.style.boxShadow = \"inset 0 0 5px #777, 0 0 5px #777\";\r\n\tconsole.log(`self.editStage`, self.editStage);\r\n}\r\n\r\nfunction $elem(self) {\r\n\treturn function $el (elA) {\r\n\t\treturn {\r\n\t\t\t$el,\r\n\t\t\tisAncestorOf: function(elB) {\r\n\t\t\t\treturn recur(elB);\r\n\t\t\t\tfunction recur(el) {\r\n\t\t\t\t\tif (elA == el) \r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\tif (el.parentElement)\r\n\t\t\t\t\t\treturn recur(el.parentElement);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tisDecendantOf: function(elB) {\r\n\t\t\t\treturn recur(elA);\r\n\t\t\t\tfunction recur(el) {\r\n\t\t\t\t\tif (elB == el) \r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\tif (el.parentElement)\r\n\t\t\t\t\t\treturn recur(el.parentElement);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tiheritsTo: function(elB) {\r\n\t\t\t\treturn recur(elA);\r\n\t\t\t\tfunction recur(el) {\r\n\t\t\t\t\tif (elB == el) \r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\tif (el.parentElement)\r\n\t\t\t\t\t\treturn recur(el.parentElement);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tpathTo: function(elB) {\r\n\t\t\t\tconst path = [];\r\n\t\t\t\tif (recur(elB))\r\n\t\t\t\t\treturn path;\r\n\t\t\t\telse \r\n\t\t\t\t\treturn null;\r\n\t\t\t\tfunction recur(el) {\r\n\t\t\t\t\tpath.unshift(el);\r\n\t\t\t\t\tif (el == elA)\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\telse if (el.parentElement)\r\n\t\t\t\t\t\treturn recur(el.parentElement);\r\n\t\t\t\t\telse\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tenableClass: function(...args) {elA.classList.add(...args)},\r\n\t\t\tdisableClass: function(...args) {elA.classList.remove(...args)},\r\n\t\t\tsetClass: function(className, status=true) {\r\n\t\t\t\tstatus ? elA.classList.add(className) : elA.classList.remove(className);\r\n\t\t\t},\r\n\t\t\thasClass: function(...args) {return elA.classList.contains(...args)},\r\n\t\t\tget isPart() { return elA.classList?.contains(`${self.clPref}-part`); },\r\n\t\t\tget part() {\r\n\t\t\t\tconst self = this;\r\n\t\t\t\treturn recur(elA);\r\n\t\t\t\tfunction recur(el) {\r\n\t\t\t\t\tif (self.$el(el).isPart) \r\n\t\t\t\t\t\treturn el;\r\n\t\t\t\t\tif (el.parentElement)\r\n\t\t\t\t\t\treturn recur(el.parentElement);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tget chIndex() {\r\n\t\t\t\tconst \r\n\t\t\t\t\tpEl = elA.parentElement,\r\n\t\t\t\t\tlen = pEl.children.length;\r\n\t\t\t\tfor (let i = 0; i < len; i ++)\r\n\t\t\t\t\tif (pEl.children[i] == elA)\r\n\t\t\t\t\t\treturn i;\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(0);\n"],"sourceRoot":""}